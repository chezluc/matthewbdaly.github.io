<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0"><meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog..."><link href="/favicon.ico" rel="icon"><link href="http://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet" type="text/css"><link rel="stylesheet" type="text/css" href="/static/bower_components/sass-bootstrap/dist/css/bootstrap.min.css" media="all"><link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><title>Django Blog Tutorial - the Next Generation - Part 9 - Matthew Daly&#x27;s Blog</title></head><body><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script><header><div class="container headercontainer"><div class="jumbotron"><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></div></div><div class="container headercontainer"><nav class="navbar navbar-inverse navbar-static-top"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#header-nav"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="header-nav"><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href="/blog/archives/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="/rss.xml">RSS</a></li></ul><form action="http://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded" class="navbar-form navbar-right"><div class="form-group"><input id="search" type="search" name="q" placeholder="Search..." maxlength="200" class="form-control"><ul class="searchresults"></ul></div></form></div></div></nav></div></header><div class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">28th September 2014 8:51 pm</p><h1>Django Blog Tutorial - the Next Generation - Part 9</h1><p>Yes, I know the eight instalment was meant to be the last one! Within 24 hours of that post going live, Django 1.7 was released, so naturally I’d like to show you how to upgrade to it.</p><p>The biggest change is that Django 1.7 introduces its own migration system, which means South is now surplus to requirements. We therefore need to switch from South to Django’s native migrations. Fortunately, this is fairly straightforward.</p><p>First of all, activate your virtualenv:</p><pre><code class="hljs lang-bash singleline">$ virtualenv venv</code></pre><p>Then make sure your migrations are up to date:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py syncdb
<span class="linenos">2</span>	$ python manage.py migrate</code></pre><p>Then, upgrade your Django version and uninstall South:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ pip install Django --upgrade
<span class="linenos">2</span>	$ pip uninstall South
<span class="linenos">3</span>	$ pip freeze &gt; requirements.txt</code></pre><p>Next, remove South from <code>INSTALLED_APPS</code> in <code>django_tutorial_blog_ng/settings.py</code>.</p><p>You now need to delete all of the numbered migration files in <code>blogengine/migrations/</code>, and the relevant <code>.pyc</code> files, but NOT the directory or the <code>__init__.py</code> file. You can do so with this command on Linux or OS X:</p><pre><code class="hljs lang-bash singleline">$ rm blogengine/migrations/<span class="hljs-number">00</span>*</code></pre><p>Next, we recreate our migrations with the following command:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py makemigrations
<span class="linenos">2</span>	Migrations <span class="hljs-keyword">for</span> <span class="hljs-string">'blogengine'</span>:
<span class="linenos">3</span>	  <span class="hljs-number">0001</span>_initial.py:
<span class="linenos">4</span>	    - Create model Category
<span class="linenos">5</span>	    - Create model Post
<span class="linenos">6</span>	    - Create model Tag
<span class="linenos">7</span>	    - Add field tags to post</code></pre><p>Then we run the migrations:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py migrate
<span class="linenos">2</span>	Operations to perform:
<span class="linenos">3</span>	  Synchronize unmigrated apps: sitemaps, django_jenkins, debug_toolbar
<span class="linenos">4</span>	  Apply all migrations: sessions, admin, sites, flatpages, contenttypes, auth, blogengine
<span class="linenos">5</span>	Synchronizing apps without migrations:
<span class="linenos">6</span>	  Creating tables...
<span class="linenos">7</span>	  Installing custom SQL...
<span class="linenos">8</span>	  Installing indexes...
<span class="linenos">9</span>	Running migrations:
<span class="linenos">10</span>	  Applying contenttypes.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">11</span>	  Applying auth.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">12</span>	  Applying admin.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">13</span>	  Applying sites.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">14</span>	  Applying blogengine.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">15</span>	  Applying flatpages.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">16</span>	  Applying sessions.<span class="hljs-number">0001</span>_initial... FAKED</code></pre><p>Don’t worry too much if the output doesn’t look exactly the same as this - as long as it works, that’s the main thing.</p><p>Let’s run our test suite to ensure it works:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py jenkins
<span class="linenos">2</span>	Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>	....FF.F.FFFFFF..............
<span class="linenos">4</span>	======================================================================
<span class="linenos">5</span>	FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
<span class="linenos">6</span>	----------------------------------------------------------------------
<span class="linenos">7</span>	Traceback (most recent call last):
<span class="linenos">8</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">385</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
<span class="linenos">9</span>	    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">10</span>	AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">11</span>	
<span class="linenos">12</span>	======================================================================
<span class="linenos">13</span>	FAIL: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
<span class="linenos">14</span>	----------------------------------------------------------------------
<span class="linenos">15</span>	Traceback (most recent call last):
<span class="linenos">16</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">417</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
<span class="linenos">17</span>	    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">18</span>	AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">19</span>	
<span class="linenos">20</span>	======================================================================
<span class="linenos">21</span>	FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
<span class="linenos">22</span>	----------------------------------------------------------------------
<span class="linenos">23</span>	Traceback (most recent call last):
<span class="linenos">24</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">278</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
<span class="linenos">25</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">26</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">27</span>	
<span class="linenos">28</span>	======================================================================
<span class="linenos">29</span>	FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
<span class="linenos">30</span>	----------------------------------------------------------------------
<span class="linenos">31</span>	Traceback (most recent call last):
<span class="linenos">32</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">346</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
<span class="linenos">33</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">34</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">35</span>	
<span class="linenos">36</span>	======================================================================
<span class="linenos">37</span>	FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
<span class="linenos">38</span>	----------------------------------------------------------------------
<span class="linenos">39</span>	Traceback (most recent call last):
<span class="linenos">40</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">255</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
<span class="linenos">41</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">42</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">43</span>	
<span class="linenos">44</span>	======================================================================
<span class="linenos">45</span>	FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
<span class="linenos">46</span>	----------------------------------------------------------------------
<span class="linenos">47</span>	Traceback (most recent call last):
<span class="linenos">48</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">447</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
<span class="linenos">49</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">50</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">51</span>	
<span class="linenos">52</span>	======================================================================
<span class="linenos">53</span>	FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
<span class="linenos">54</span>	----------------------------------------------------------------------
<span class="linenos">55</span>	Traceback (most recent call last):
<span class="linenos">56</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">323</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
<span class="linenos">57</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">58</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">59</span>	
<span class="linenos">60</span>	======================================================================
<span class="linenos">61</span>	FAIL: <span class="hljs-built_in">test</span>_login (blogengine.tests.AdminTest)
<span class="linenos">62</span>	----------------------------------------------------------------------
<span class="linenos">63</span>	Traceback (most recent call last):
<span class="linenos">64</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">183</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_login
<span class="linenos">65</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">66</span>	AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">67</span>	
<span class="linenos">68</span>	======================================================================
<span class="linenos">69</span>	FAIL: <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span> (blogengine.tests.AdminTest)
<span class="linenos">70</span>	----------------------------------------------------------------------
<span class="linenos">71</span>	Traceback (most recent call last):
<span class="linenos">72</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">214</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span>
<span class="linenos">73</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">74</span>	AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">75</span>	
<span class="linenos">76</span>	----------------------------------------------------------------------
<span class="linenos">77</span>	Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.383</span>s
<span class="linenos">78</span>	
<span class="linenos">79</span>	FAILED (failures=<span class="hljs-number">9</span>)
<span class="linenos">80</span>	Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>We have an issue here. A load of the tests for the admin interface now fail. If we now try running the dev server, we see this error:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py runserver
<span class="linenos">2</span>	Performing system checks...
<span class="linenos">3</span>	
<span class="linenos">4</span>	System check identified no issues (<span class="hljs-number">0</span> silenced).
<span class="linenos">5</span>	September <span class="hljs-number">28</span>, <span class="hljs-number">2014</span> - <span class="hljs-number">20</span>:<span class="hljs-number">16</span>:<span class="hljs-number">47</span>
<span class="linenos">6</span>	Django version <span class="hljs-number">1.7</span>, using settings <span class="hljs-string">'django_tutorial_blog_ng.settings'</span>
<span class="linenos">7</span>	Starting development server at http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span>/
<span class="linenos">8</span>	Quit the server with CONTROL-C.
<span class="linenos">9</span>	Unhandled exception <span class="hljs-keyword">in</span> thread started by &lt;<span class="hljs-keyword">function</span> wrapper at <span class="hljs-number">0</span>x1024a5ed8&gt;
<span class="linenos">10</span>	Traceback (most recent call last):
<span class="linenos">11</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/autoreload.py"</span>, line <span class="hljs-number">222</span>, <span class="hljs-keyword">in</span> wrapper
<span class="linenos">12</span>	    fn(*args, **kwargs)
<span class="linenos">13</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="hljs-number">132</span>, <span class="hljs-keyword">in</span> inner_run
<span class="linenos">14</span>	    handler = self.get_handler(*args, **options)
<span class="linenos">15</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/staticfiles/management/commands/runserver.py"</span>, line <span class="hljs-number">25</span>, <span class="hljs-keyword">in</span> get_handler
<span class="linenos">16</span>	    handler = super(Command, self).get_handler(*args, **options)
<span class="linenos">17</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="hljs-number">48</span>, <span class="hljs-keyword">in</span> get_handler
<span class="linenos">18</span>	    <span class="hljs-built_in">return</span> get_internal_wsgi_application()
<span class="linenos">19</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py"</span>, line <span class="hljs-number">66</span>, <span class="hljs-keyword">in</span> get_internal_wsgi_application
<span class="linenos">20</span>	    sys.exc_info()[<span class="hljs-number">2</span>])
<span class="linenos">21</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py"</span>, line <span class="hljs-number">56</span>, <span class="hljs-keyword">in</span> get_internal_wsgi_application
<span class="linenos">22</span>	    <span class="hljs-built_in">return</span> import_string(app_path)
<span class="linenos">23</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/module_loading.py"</span>, line <span class="hljs-number">26</span>, <span class="hljs-keyword">in</span> import_string
<span class="linenos">24</span>	    module = import_module(module_path)
<span class="linenos">25</span>	  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.8_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/importlib/__init__.py"</span>, line <span class="hljs-number">37</span>, <span class="hljs-keyword">in</span> import_module
<span class="linenos">26</span>	    __import__(name)
<span class="linenos">27</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/django_tutorial_blog_ng/wsgi.py"</span>, line <span class="hljs-number">14</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
<span class="linenos">28</span>	    from dj_static import Cling
<span class="linenos">29</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/dj_static.py"</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
<span class="linenos">30</span>	    from django.core.handlers.base import get_path_info
<span class="linenos">31</span>	django.core.exceptions.ImproperlyConfigured: WSGI application <span class="hljs-string">'django_tutorial_blog_ng.wsgi.application'</span> could not be loaded; Error importing module: <span class="hljs-string">'cannot import name get_path_info'</span></code></pre><p>Fortunately, the error above is easy to fix by upgrading <code>dj_static</code>:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ pip install dj_static --upgrade
<span class="linenos">2</span>	$ pip freeze &gt; requirements.txt</code></pre><p>That resolves the error in serving static files, but not the error with the admin. If you run the dev server, you’ll be able to see that the admin actually works fine. The problem is caused by the test client not following redirects in the admin. We can easily run just the admin tests with the following command:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py <span class="hljs-built_in">test</span> blogengine.tests.AdminTest
<span class="linenos">2</span>	Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>	.FF.F.FFFFFF
<span class="linenos">4</span>	======================================================================
<span class="linenos">5</span>	FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
<span class="linenos">6</span>	----------------------------------------------------------------------
<span class="linenos">7</span>	Traceback (most recent call last):
<span class="linenos">8</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">385</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
<span class="linenos">9</span>	    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">10</span>	AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">11</span>	
<span class="linenos">12</span>	======================================================================
<span class="linenos">13</span>	FAIL: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
<span class="linenos">14</span>	----------------------------------------------------------------------
<span class="linenos">15</span>	Traceback (most recent call last):
<span class="linenos">16</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">417</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
<span class="linenos">17</span>	    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">18</span>	AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">19</span>	
<span class="linenos">20</span>	======================================================================
<span class="linenos">21</span>	FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
<span class="linenos">22</span>	----------------------------------------------------------------------
<span class="linenos">23</span>	Traceback (most recent call last):
<span class="linenos">24</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">278</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
<span class="linenos">25</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">26</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">27</span>	
<span class="linenos">28</span>	======================================================================
<span class="linenos">29</span>	FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
<span class="linenos">30</span>	----------------------------------------------------------------------
<span class="linenos">31</span>	Traceback (most recent call last):
<span class="linenos">32</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">346</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
<span class="linenos">33</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">34</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">35</span>	
<span class="linenos">36</span>	======================================================================
<span class="linenos">37</span>	FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
<span class="linenos">38</span>	----------------------------------------------------------------------
<span class="linenos">39</span>	Traceback (most recent call last):
<span class="linenos">40</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">255</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
<span class="linenos">41</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">42</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">43</span>	
<span class="linenos">44</span>	======================================================================
<span class="linenos">45</span>	FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
<span class="linenos">46</span>	----------------------------------------------------------------------
<span class="linenos">47</span>	Traceback (most recent call last):
<span class="linenos">48</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">447</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
<span class="linenos">49</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">50</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">51</span>	
<span class="linenos">52</span>	======================================================================
<span class="linenos">53</span>	FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
<span class="linenos">54</span>	----------------------------------------------------------------------
<span class="linenos">55</span>	Traceback (most recent call last):
<span class="linenos">56</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">323</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
<span class="linenos">57</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">58</span>	AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">59</span>	
<span class="linenos">60</span>	======================================================================
<span class="linenos">61</span>	FAIL: <span class="hljs-built_in">test</span>_login (blogengine.tests.AdminTest)
<span class="linenos">62</span>	----------------------------------------------------------------------
<span class="linenos">63</span>	Traceback (most recent call last):
<span class="linenos">64</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">183</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_login
<span class="linenos">65</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">66</span>	AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">67</span>	
<span class="linenos">68</span>	======================================================================
<span class="linenos">69</span>	FAIL: <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span> (blogengine.tests.AdminTest)
<span class="linenos">70</span>	----------------------------------------------------------------------
<span class="linenos">71</span>	Traceback (most recent call last):
<span class="linenos">72</span>	  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">214</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span>
<span class="linenos">73</span>	    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">74</span>	AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">75</span>	
<span class="linenos">76</span>	----------------------------------------------------------------------
<span class="linenos">77</span>	Ran <span class="hljs-number">12</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.283</span>s
<span class="linenos">78</span>	
<span class="linenos">79</span>	FAILED (failures=<span class="hljs-number">9</span>)
<span class="linenos">80</span>	Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Let’s commit our changes so far first:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ git add django_tutorial_blog_ng/ requirements.txt blogengine/
<span class="linenos">2</span>	$ git commit -m <span class="hljs-string">'Upgraded to Django 1.7'</span></code></pre><p>Now let’s fix our tests. Here’s the amended version of the <code>AdminTest</code> class:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>	<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
<span class="linenos">2</span>	    fixtures = [<span class="hljs-string">'users.json'</span>]
<span class="linenos">3</span>	
<span class="linenos">4</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">5</span>	        <span class="hljs-comment"># Get login page</span>
<span class="linenos">6</span>	        response = self.client.get(<span class="hljs-string">'/admin/'</span>, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">7</span>	
<span class="linenos">8</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">9</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>	
<span class="linenos">11</span>	        <span class="hljs-comment"># Check 'Log in' in response</span>
<span class="linenos">12</span>	        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">13</span>	
<span class="linenos">14</span>	        <span class="hljs-comment"># Log the user in</span>
<span class="linenos">15</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">16</span>	
<span class="linenos">17</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">18</span>	        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
<span class="linenos">19</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">20</span>	
<span class="linenos">21</span>	        <span class="hljs-comment"># Check 'Log out' in response</span>
<span class="linenos">22</span>	        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">23</span>	
<span class="linenos">24</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">25</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">26</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">27</span>	
<span class="linenos">28</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">29</span>	        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
<span class="linenos">30</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">31</span>	
<span class="linenos">32</span>	        <span class="hljs-comment"># Check 'Log out' in response</span>
<span class="linenos">33</span>	        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">34</span>	
<span class="linenos">35</span>	        <span class="hljs-comment"># Log out</span>
<span class="linenos">36</span>	        self.client.logout()
<span class="linenos">37</span>	
<span class="linenos">38</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">39</span>	        response = self.client.get(<span class="hljs-string">'/admin/'</span>, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">40</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">41</span>	
<span class="linenos">42</span>	        <span class="hljs-comment"># Check 'Log in' in response</span>
<span class="linenos">43</span>	        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">44</span>	
<span class="linenos">45</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">46</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">47</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">48</span>	
<span class="linenos">49</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">50</span>	        response = self.client.get(<span class="hljs-string">'/admin/blogengine/category/add/'</span>)
<span class="linenos">51</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">52</span>	
<span class="linenos">53</span>	        <span class="hljs-comment"># Create the new category</span>
<span class="linenos">54</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/add/'</span>, {
<span class="linenos">55</span>	            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
<span class="linenos">56</span>	            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">57</span>	            },
<span class="linenos">58</span>	            follow=<span class="hljs-keyword">True</span>
<span class="linenos">59</span>	        )
<span class="linenos">60</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">61</span>	
<span class="linenos">62</span>	        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">63</span>	        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">64</span>	
<span class="linenos">65</span>	        <span class="hljs-comment"># Check new category now in database</span>
<span class="linenos">66</span>	        all_categories = Category.objects.all()
<span class="linenos">67</span>	        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
<span class="linenos">68</span>	
<span class="linenos">69</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_category</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">70</span>	        <span class="hljs-comment"># Create the category</span>
<span class="linenos">71</span>	        category = CategoryFactory()
<span class="linenos">72</span>	
<span class="linenos">73</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">74</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">75</span>	
<span class="linenos">76</span>	        <span class="hljs-comment"># Edit the category</span>
<span class="linenos">77</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/'</span> + str(category.pk) + <span class="hljs-string">'/'</span>, {
<span class="linenos">78</span>	            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
<span class="linenos">79</span>	            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
<span class="linenos">80</span>	            }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">81</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">82</span>	
<span class="linenos">83</span>	        <span class="hljs-comment"># Check changed successfully</span>
<span class="linenos">84</span>	        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">85</span>	
<span class="linenos">86</span>	        <span class="hljs-comment"># Check category amended</span>
<span class="linenos">87</span>	        all_categories = Category.objects.all()
<span class="linenos">88</span>	        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
<span class="linenos">89</span>	        only_category = all_categories[<span class="hljs-number">0</span>]
<span class="linenos">90</span>	        self.assertEquals(only_category.name, <span class="hljs-string">'perl'</span>)
<span class="linenos">91</span>	        self.assertEquals(only_category.description, <span class="hljs-string">'The Perl programming language'</span>)
<span class="linenos">92</span>	
<span class="linenos">93</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_category</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">94</span>	        <span class="hljs-comment"># Create the category</span>
<span class="linenos">95</span>	        category = CategoryFactory()
<span class="linenos">96</span>	
<span class="linenos">97</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">98</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">99</span>	
<span class="linenos">100</span>	        <span class="hljs-comment"># Delete the category</span>
<span class="linenos">101</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/'</span> + str(category.pk) + <span class="hljs-string">'/delete/'</span>, {
<span class="linenos">102</span>	            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
<span class="linenos">103</span>	        }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">104</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">105</span>	
<span class="linenos">106</span>	        <span class="hljs-comment"># Check deleted successfully</span>
<span class="linenos">107</span>	        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">108</span>	
<span class="linenos">109</span>	        <span class="hljs-comment"># Check category deleted</span>
<span class="linenos">110</span>	        all_categories = Category.objects.all()
<span class="linenos">111</span>	        self.assertEquals(len(all_categories), <span class="hljs-number">0</span>)
<span class="linenos">112</span>	
<span class="linenos">113</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">114</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">115</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">116</span>	
<span class="linenos">117</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">118</span>	        response = self.client.get(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>)
<span class="linenos">119</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">120</span>	
<span class="linenos">121</span>	        <span class="hljs-comment"># Create the new tag</span>
<span class="linenos">122</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>, {
<span class="linenos">123</span>	            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
<span class="linenos">124</span>	            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">125</span>	            },
<span class="linenos">126</span>	            follow=<span class="hljs-keyword">True</span>
<span class="linenos">127</span>	        )
<span class="linenos">128</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">129</span>	
<span class="linenos">130</span>	        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">131</span>	        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">132</span>	
<span class="linenos">133</span>	        <span class="hljs-comment"># Check new tag now in database</span>
<span class="linenos">134</span>	        all_tags = Tag.objects.all()
<span class="linenos">135</span>	        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
<span class="linenos">136</span>	
<span class="linenos">137</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">138</span>	        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">139</span>	        tag = TagFactory()
<span class="linenos">140</span>	
<span class="linenos">141</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">142</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">143</span>	
<span class="linenos">144</span>	        <span class="hljs-comment"># Edit the tag</span>
<span class="linenos">145</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/'</span> + str(tag.pk) + <span class="hljs-string">'/'</span>, {
<span class="linenos">146</span>	            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
<span class="linenos">147</span>	            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
<span class="linenos">148</span>	            }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">149</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">150</span>	
<span class="linenos">151</span>	        <span class="hljs-comment"># Check changed successfully</span>
<span class="linenos">152</span>	        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">153</span>	
<span class="linenos">154</span>	        <span class="hljs-comment"># Check tag amended</span>
<span class="linenos">155</span>	        all_tags = Tag.objects.all()
<span class="linenos">156</span>	        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
<span class="linenos">157</span>	        only_tag = all_tags[<span class="hljs-number">0</span>]
<span class="linenos">158</span>	        self.assertEquals(only_tag.name, <span class="hljs-string">'perl'</span>)
<span class="linenos">159</span>	        self.assertEquals(only_tag.description, <span class="hljs-string">'The Perl programming language'</span>)
<span class="linenos">160</span>	
<span class="linenos">161</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">162</span>	        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">163</span>	        tag = TagFactory()
<span class="linenos">164</span>	
<span class="linenos">165</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">166</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">167</span>	
<span class="linenos">168</span>	        <span class="hljs-comment"># Delete the tag</span>
<span class="linenos">169</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/'</span> + str(tag.pk) + <span class="hljs-string">'/delete/'</span>, {
<span class="linenos">170</span>	            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
<span class="linenos">171</span>	        }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">172</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">173</span>	
<span class="linenos">174</span>	        <span class="hljs-comment"># Check deleted successfully</span>
<span class="linenos">175</span>	        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">176</span>	
<span class="linenos">177</span>	        <span class="hljs-comment"># Check tag deleted</span>
<span class="linenos">178</span>	        all_tags = Tag.objects.all()
<span class="linenos">179</span>	        self.assertEquals(len(all_tags), <span class="hljs-number">0</span>)
<span class="linenos">180</span>	
<span class="linenos">181</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">182</span>	        <span class="hljs-comment"># Create the category</span>
<span class="linenos">183</span>	        category = CategoryFactory()
<span class="linenos">184</span>	
<span class="linenos">185</span>	        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">186</span>	        tag = TagFactory()
<span class="linenos">187</span>	
<span class="linenos">188</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">189</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">190</span>	
<span class="linenos">191</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">192</span>	        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
<span class="linenos">193</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">194</span>	
<span class="linenos">195</span>	        <span class="hljs-comment"># Create the new post</span>
<span class="linenos">196</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
<span class="linenos">197</span>	            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
<span class="linenos">198</span>	            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
<span class="linenos">199</span>	            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
<span class="linenos">200</span>	            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
<span class="linenos">201</span>	            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
<span class="linenos">202</span>	            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
<span class="linenos">203</span>	            <span class="hljs-string">'category'</span>: str(category.pk),
<span class="linenos">204</span>	            <span class="hljs-string">'tags'</span>: str(tag.pk)
<span class="linenos">205</span>	        },
<span class="linenos">206</span>	        follow=<span class="hljs-keyword">True</span>
<span class="linenos">207</span>	        )
<span class="linenos">208</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">209</span>	
<span class="linenos">210</span>	        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">211</span>	        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">212</span>	
<span class="linenos">213</span>	        <span class="hljs-comment"># Check new post now in database</span>
<span class="linenos">214</span>	        all_posts = Post.objects.all()
<span class="linenos">215</span>	        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">216</span>	
<span class="linenos">217</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post_without_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">218</span>	        <span class="hljs-comment"># Create the category</span>
<span class="linenos">219</span>	        category = CategoryFactory()
<span class="linenos">220</span>	
<span class="linenos">221</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">222</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">223</span>	
<span class="linenos">224</span>	        <span class="hljs-comment"># Check response code</span>
<span class="linenos">225</span>	        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
<span class="linenos">226</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">227</span>	
<span class="linenos">228</span>	        <span class="hljs-comment"># Create the new post</span>
<span class="linenos">229</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
<span class="linenos">230</span>	            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
<span class="linenos">231</span>	            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
<span class="linenos">232</span>	            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
<span class="linenos">233</span>	            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
<span class="linenos">234</span>	            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
<span class="linenos">235</span>	            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
<span class="linenos">236</span>	            <span class="hljs-string">'category'</span>: str(category.pk)
<span class="linenos">237</span>	        },
<span class="linenos">238</span>	        follow=<span class="hljs-keyword">True</span>
<span class="linenos">239</span>	        )
<span class="linenos">240</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">241</span>	
<span class="linenos">242</span>	        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">243</span>	        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">244</span>	
<span class="linenos">245</span>	        <span class="hljs-comment"># Check new post now in database</span>
<span class="linenos">246</span>	        all_posts = Post.objects.all()
<span class="linenos">247</span>	        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">248</span>	
<span class="linenos">249</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">250</span>	        <span class="hljs-comment"># Create the post</span>
<span class="linenos">251</span>	        post = PostFactory()
<span class="linenos">252</span>	
<span class="linenos">253</span>	        <span class="hljs-comment"># Create the category</span>
<span class="linenos">254</span>	        category = CategoryFactory()
<span class="linenos">255</span>	
<span class="linenos">256</span>	        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">257</span>	        tag = TagFactory()
<span class="linenos">258</span>	        post.tags.add(tag)
<span class="linenos">259</span>	
<span class="linenos">260</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">261</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">262</span>	
<span class="linenos">263</span>	        <span class="hljs-comment"># Edit the post</span>
<span class="linenos">264</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/'</span> + str(post.pk) + <span class="hljs-string">'/'</span>, {
<span class="linenos">265</span>	            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
<span class="linenos">266</span>	            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
<span class="linenos">267</span>	            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
<span class="linenos">268</span>	            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
<span class="linenos">269</span>	            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
<span class="linenos">270</span>	            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
<span class="linenos">271</span>	            <span class="hljs-string">'category'</span>: str(category.pk),
<span class="linenos">272</span>	            <span class="hljs-string">'tags'</span>: str(tag.pk)
<span class="linenos">273</span>	        },
<span class="linenos">274</span>	        follow=<span class="hljs-keyword">True</span>
<span class="linenos">275</span>	        )
<span class="linenos">276</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">277</span>	
<span class="linenos">278</span>	        <span class="hljs-comment"># Check changed successfully</span>
<span class="linenos">279</span>	        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">280</span>	
<span class="linenos">281</span>	        <span class="hljs-comment"># Check post amended</span>
<span class="linenos">282</span>	        all_posts = Post.objects.all()
<span class="linenos">283</span>	        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">284</span>	        only_post = all_posts[<span class="hljs-number">0</span>]
<span class="linenos">285</span>	        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
<span class="linenos">286</span>	        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)
<span class="linenos">287</span>	
<span class="linenos">288</span>	    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">289</span>	        <span class="hljs-comment"># Create the post</span>
<span class="linenos">290</span>	        post = PostFactory()
<span class="linenos">291</span>	
<span class="linenos">292</span>	        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">293</span>	        tag = TagFactory()
<span class="linenos">294</span>	        post.tags.add(tag)
<span class="linenos">295</span>	
<span class="linenos">296</span>	        <span class="hljs-comment"># Check new post saved</span>
<span class="linenos">297</span>	        all_posts = Post.objects.all()
<span class="linenos">298</span>	        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">299</span>	
<span class="linenos">300</span>	        <span class="hljs-comment"># Log in</span>
<span class="linenos">301</span>	        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">302</span>	
<span class="linenos">303</span>	        <span class="hljs-comment"># Delete the post</span>
<span class="linenos">304</span>	        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/'</span> + str(post.pk) + <span class="hljs-string">'/delete/'</span>, {
<span class="linenos">305</span>	            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
<span class="linenos">306</span>	        }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">307</span>	        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">308</span>	
<span class="linenos">309</span>	        <span class="hljs-comment"># Check deleted successfully</span>
<span class="linenos">310</span>	        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">311</span>	
<span class="linenos">312</span>	        <span class="hljs-comment"># Check post deleted</span>
<span class="linenos">313</span>	        all_posts = Post.objects.all()
<span class="linenos">314</span>	        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)</code></pre><p>There are two main issues here. The first is that when we try to edit or delete an existing item, or refer to it when creating something else, we can no longer rely on the number representing the primary key being set to 1. So we need to specifically obtain this, rather than hard-coding it to 1. Therefore, whenever we pass through a number to represent an item (with the exception of the site, but including tags, categories and posts), we need to instead fetch its primary key and return it. So, above where we try to delete a post, we replace <code>1</code> with <code>str(post.pk)</code>. This will solve a lot of the problems. As there’s a lot of them, I won’t go through each one, but you can see the entire class above for reference, and if you’ve followed along so far, you shouldn’t have any problems.</p><p>The other issue we need to fix is the login and logout tests. We simply add <code>follow=True</code> to these to ensure that the test client follows the redirects.</p><p>Let’s run our tests to make sure they pass:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ python manage.py jenkins
<span class="linenos">2</span>	Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>	.............................
<span class="linenos">4</span>	----------------------------------------------------------------------
<span class="linenos">5</span>	Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">8.210</span>s
<span class="linenos">6</span>	
<span class="linenos">7</span>	OK
<span class="linenos">8</span>	Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>With that done, you can commit your changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>	$ git add blogengine/tests.py
<span class="linenos">2</span>	$ git commit -m <span class="hljs-string">'Fixed broken tests'</span></code></pre><p>Don’t forget to deploy your changes:</p><pre><code class="hljs lang-bash singleline">$ fab deploy</code></pre><p>Our blog has now been happily migrated over to Django 1.7!</p><ul class="categorylist"><li><a href="/blog/categories/tdd/">tdd</a></li><li><a href="/blog/categories/python/">python</a></li><li><a href="/blog/categories/django/">django</a></li></ul><div class="addthis_sharing_toolbox"></div><section class="comments"><div id="disqus_thread"></div><script type="text/javascript">window.disqus_identifier="http://matthewdaly.co.uk/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/";
                    window.disqus_url="http://matthewdaly.co.uk/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/";
                    window.disqus_title="Django Blog Tutorial - the Next Generation - Part 9";</script><script type="text/javascript" src="http://disqus.com/forums/matthewdaly/embed.js"></script><noscript><a href="http://matthewdaly.disqus.com/?url=ref">View the discussion thread.</a></noscript></section></article></div><div class="col-md-4"><h1>Recent Posts</h1><p><a href="/blog/2015/05/03/my-static-site-generator-post-on-sitepoint/">My Static Site Generator Post on Sitepoint</a></p><p><a href="/blog/2015/04/18/how-i-added-search-to-my-site-with-lunr-dot-js/">How I Added Search to My Site With Lunr.js</a></p><p><a href="/blog/2015/04/04/adding-a-new-search-engine-to-my-site/">Adding a New Search Engine to My Site</a></p><p><a href="/blog/2015/03/02/syntax-highlighting-in-fenced-code-blocks-in-vim/">Syntax Highlighting in Fenced Code Blocks in Vim</a></p><p><a href="/blog/2015/03/02/extending-our-node-dot-js-and-redis-chat-server/">Extending Our Node.js and Redis Chat Server</a></p><section id="github-profile"></section><h4>My GitHub repositories</h4><ul id="github-repos"><li>Loading repositories...</li></ul></div></div><div class="row"><div class="col-md-12"><ul class="pager"><li><a href="/blog/2014/10/05/introducing-generator-simple-static-blog/">Introducing Generator-simple-static-blog</a></li><li><a href="/blog/2014/09/28/changing-date-format-from-dd-slash-mm-slash-yyyy-to-yyyy-mm-dd-in-vim/">Changing Date Format from DD/MM/YYYY to YYYY-MM-DD in Vim</a></li></ul></div></div></div><footer><div class="container footercontainer"><div class="col-md-12"><p class="copyright">Copyright &copy; Matthew Daly 2015.</p></div></div></footer><script type="text/javascript" src="/static/js/all.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');</script></body></html>