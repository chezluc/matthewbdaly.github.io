<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0"><meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog..."><meta name="keywords" content="tdd,python,django"><link href="/favicon.ico" rel="icon"><link href="http://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet" type="text/css"><link rel="stylesheet" type="text/css" href="/static/bower_components/sass-bootstrap/dist/css/bootstrap.min.css" media="all"><link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="http://feeds.feedburner.com/MatthewDalysBlog"><title>Django Blog Tutorial - the Next Generation - Part 9 - Matthew Daly&#x27;s Blog</title></head><body><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script><header><div class="container headercontainer"><div class="jumbotron"><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></div></div><div class="container headercontainer"><nav class="navbar navbar-inverse navbar-static-top"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#header-nav"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="header-nav"><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href="/blog/archives/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://feeds.feedburner.com/MatthewDalysBlog">RSS</a></li></ul><form action="http://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded" class="navbar-form navbar-right"><div class="form-group"><input id="search" type="search" name="q" placeholder="Search..." maxlength="200" autocomplete="off" class="form-control"><ul class="searchresults"></ul></div></form></div></div></nav></div></header><div class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">28th September 2014 8:51 pm</p><h1>Django Blog Tutorial - the Next Generation - Part 9</h1><p>Yes, I know the eight instalment was meant to be the last one! Within 24 hours of that post going live, Django 1.7 was released, so naturally I’d like to show you how to upgrade to it.</p><p>The biggest change is that Django 1.7 introduces its own migration system, which means South is now surplus to requirements. We therefore need to switch from South to Django’s native migrations. Fortunately, this is fairly straightforward.</p><p>First of all, activate your virtualenv:</p><pre><code class="hljs lang-bash">$ virtualenv venv
</code></pre><p>Then make sure your migrations are up to date:</p><pre><code class="hljs lang-bash">$ python manage.py syncdb
$ python manage.py migrate
</code></pre><p>Then, upgrade your Django version and uninstall South:</p><pre><code class="hljs lang-bash">$ pip install Django --upgrade
$ pip uninstall South
$ pip freeze &gt; requirements.txt
</code></pre><p>Next, remove South from <code>INSTALLED_APPS</code> in <code>django_tutorial_blog_ng/settings.py</code>.</p><p>You now need to delete all of the numbered migration files in <code>blogengine/migrations/</code>, and the relevant <code>.pyc</code> files, but NOT the directory or the <code>__init__.py</code> file. You can do so with this command on Linux or OS X:</p><pre><code class="hljs lang-bash">$ rm blogengine/migrations/<span class="hljs-number">00</span>*
</code></pre><p>Next, we recreate our migrations with the following command:</p><pre><code class="hljs lang-bash">$ python manage.py makemigrations
Migrations <span class="hljs-keyword">for</span> <span class="hljs-string">'blogengine'</span>:
  <span class="hljs-number">0001</span>_initial.py:
    - Create model Category
    - Create model Post
    - Create model Tag
    - Add field tags to post
</code></pre><p>Then we run the migrations:</p><pre><code class="hljs lang-bash">$ python manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: sitemaps, django_jenkins, debug_toolbar
  Apply all migrations: sessions, admin, sites, flatpages, contenttypes, auth, blogengine
Synchronizing apps without migrations:
  Creating tables...
  Installing custom SQL...
  Installing indexes...
Running migrations:
  Applying contenttypes.<span class="hljs-number">0001</span>_initial... FAKED
  Applying auth.<span class="hljs-number">0001</span>_initial... FAKED
  Applying admin.<span class="hljs-number">0001</span>_initial... FAKED
  Applying sites.<span class="hljs-number">0001</span>_initial... FAKED
  Applying blogengine.<span class="hljs-number">0001</span>_initial... FAKED
  Applying flatpages.<span class="hljs-number">0001</span>_initial... FAKED
  Applying sessions.<span class="hljs-number">0001</span>_initial... FAKED
</code></pre><p>Don’t worry too much if the output doesn’t look exactly the same as this - as long as it works, that’s the main thing.</p><p>Let’s run our test suite to ensure it works:</p><pre><code class="hljs lang-bash">$ python manage.py jenkins
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
....FF.F.FFFFFF..............
======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">385</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">417</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">278</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">346</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">255</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">447</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">323</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_login (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">183</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_login
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span> (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">214</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span>
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.383</span>s

FAILED (failures=<span class="hljs-number">9</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>We have an issue here. A load of the tests for the admin interface now fail. If we now try running the dev server, we see this error:</p><pre><code class="hljs lang-bash">$ python manage.py runserver
Performing system checks...

System check identified no issues (<span class="hljs-number">0</span> silenced).
September <span class="hljs-number">28</span>, <span class="hljs-number">2014</span> - <span class="hljs-number">20</span>:<span class="hljs-number">16</span>:<span class="hljs-number">47</span>
Django version <span class="hljs-number">1.7</span>, using settings <span class="hljs-string">'django_tutorial_blog_ng.settings'</span>
Starting development server at http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span>/
Quit the server with CONTROL-C.
Unhandled exception <span class="hljs-keyword">in</span> thread started by &lt;<span class="hljs-keyword">function</span> wrapper at <span class="hljs-number">0</span>x1024a5ed8&gt;
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/autoreload.py"</span>, line <span class="hljs-number">222</span>, <span class="hljs-keyword">in</span> wrapper
    fn(*args, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="hljs-number">132</span>, <span class="hljs-keyword">in</span> inner_run
    handler = self.get_handler(*args, **options)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/staticfiles/management/commands/runserver.py"</span>, line <span class="hljs-number">25</span>, <span class="hljs-keyword">in</span> get_handler
    handler = super(Command, self).get_handler(*args, **options)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="hljs-number">48</span>, <span class="hljs-keyword">in</span> get_handler
    <span class="hljs-built_in">return</span> get_internal_wsgi_application()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py"</span>, line <span class="hljs-number">66</span>, <span class="hljs-keyword">in</span> get_internal_wsgi_application
    sys.exc_info()[<span class="hljs-number">2</span>])
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py"</span>, line <span class="hljs-number">56</span>, <span class="hljs-keyword">in</span> get_internal_wsgi_application
    <span class="hljs-built_in">return</span> import_string(app_path)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/module_loading.py"</span>, line <span class="hljs-number">26</span>, <span class="hljs-keyword">in</span> import_string
    module = import_module(module_path)
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.8_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/importlib/__init__.py"</span>, line <span class="hljs-number">37</span>, <span class="hljs-keyword">in</span> import_module
    __import__(name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/django_tutorial_blog_ng/wsgi.py"</span>, line <span class="hljs-number">14</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    from dj_static import Cling
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/dj_static.py"</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    from django.core.handlers.base import get_path_info
django.core.exceptions.ImproperlyConfigured: WSGI application <span class="hljs-string">'django_tutorial_blog_ng.wsgi.application'</span> could not be loaded; Error importing module: <span class="hljs-string">'cannot import name get_path_info'</span>
</code></pre><p>Fortunately, the error above is easy to fix by upgrading <code>dj_static</code>:</p><pre><code class="hljs lang-bash">$ pip install dj_static --upgrade
$ pip freeze &gt; requirements.txt
</code></pre><p>That resolves the error in serving static files, but not the error with the admin. If you run the dev server, you’ll be able to see that the admin actually works fine. The problem is caused by the test client not following redirects in the admin. We can easily run just the admin tests with the following command:</p><pre><code class="hljs lang-bash">$ python manage.py <span class="hljs-built_in">test</span> blogengine.tests.AdminTest
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.FF.F.FFFFFF
======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">385</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">417</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">278</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">346</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">255</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">447</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">323</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_login (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">183</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_login
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span> (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">214</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span>
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">12</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.283</span>s

FAILED (failures=<span class="hljs-number">9</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>Let’s commit our changes so far first:</p><pre><code class="hljs lang-bash">$ git add django_tutorial_blog_ng/ requirements.txt blogengine/
$ git commit -m <span class="hljs-string">'Upgraded to Django 1.7'</span>
</code></pre><p>Now let’s fix our tests. Here’s the amended version of the <code>AdminTest</code> class:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    fixtures = [<span class="hljs-string">'users.json'</span>]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Get login page</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>, follow=<span class="hljs-keyword">True</span>)

        <span class="hljs-comment"># Check response code</span>
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log in' in response</span>
        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Log the user in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log out' in response</span>
        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log out' in response</span>
        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Log out</span>
        self.client.logout()

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log in' in response</span>
        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/category/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/add/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
            },
            follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new category now in database</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = CategoryFactory()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/'</span> + str(category.pk) + <span class="hljs-string">'/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
            }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check category amended</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
        only_category = all_categories[<span class="hljs-number">0</span>]
        self.assertEquals(only_category.name, <span class="hljs-string">'perl'</span>)
        self.assertEquals(only_category.description, <span class="hljs-string">'The Perl programming language'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = CategoryFactory()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/'</span> + str(category.pk) + <span class="hljs-string">'/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check category deleted</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">0</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
            },
            follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new tag now in database</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = TagFactory()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/'</span> + str(tag.pk) + <span class="hljs-string">'/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
            }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check tag amended</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
        only_tag = all_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_tag.name, <span class="hljs-string">'perl'</span>)
        self.assertEquals(only_tag.description, <span class="hljs-string">'The Perl programming language'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = TagFactory()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/'</span> + str(tag.pk) + <span class="hljs-string">'/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check tag deleted</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">0</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = CategoryFactory()

        <span class="hljs-comment"># Create the tag</span>
        tag = TagFactory()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: str(category.pk),
            <span class="hljs-string">'tags'</span>: str(tag.pk)
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post_without_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = CategoryFactory()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: str(category.pk)
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the post</span>
        post = PostFactory()

        <span class="hljs-comment"># Create the category</span>
        category = CategoryFactory()

        <span class="hljs-comment"># Create the tag</span>
        tag = TagFactory()
        post.tags.add(tag)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/'</span> + str(post.pk) + <span class="hljs-string">'/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: str(category.pk),
            <span class="hljs-string">'tags'</span>: str(tag.pk)
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the post</span>
        post = PostFactory()

        <span class="hljs-comment"># Create the tag</span>
        tag = TagFactory()
        post.tags.add(tag)

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/'</span> + str(post.pk) + <span class="hljs-string">'/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post deleted</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)
</code></pre><p>There are two main issues here. The first is that when we try to edit or delete an existing item, or refer to it when creating something else, we can no longer rely on the number representing the primary key being set to 1. So we need to specifically obtain this, rather than hard-coding it to 1. Therefore, whenever we pass through a number to represent an item (with the exception of the site, but including tags, categories and posts), we need to instead fetch its primary key and return it. So, above where we try to delete a post, we replace <code>1</code> with <code>str(post.pk)</code>. This will solve a lot of the problems. As there’s a lot of them, I won’t go through each one, but you can see the entire class above for reference, and if you’ve followed along so far, you shouldn’t have any problems.</p><p>The other issue we need to fix is the login and logout tests. We simply add <code>follow=True</code> to these to ensure that the test client follows the redirects.</p><p>Let’s run our tests to make sure they pass:</p><pre><code class="hljs lang-bash">$ python manage.py jenkins
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.............................
----------------------------------------------------------------------
Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">8.210</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>With that done, you can commit your changes:</p><pre><code class="hljs lang-bash">$ git add blogengine/tests.py
$ git commit -m <span class="hljs-string">'Fixed broken tests'</span>
</code></pre><p>Don’t forget to deploy your changes:</p><pre><code class="hljs lang-bash">$ fab deploy
</code></pre><p>Our blog has now been happily migrated over to Django 1.7!</p><ul class="categorylist"><li><a href="/blog/categories/tdd/">tdd</a></li><li><a href="/blog/categories/python/">python</a></li><li><a href="/blog/categories/django/">django</a></li></ul><div class="addthis_sharing_toolbox"></div><section class="comments"><div id="disqus_thread"></div><script type="text/javascript">window.disqus_identifier="http://matthewdaly.co.uk/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/";
                    window.disqus_url="http://matthewdaly.co.uk/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/";
                    window.disqus_title="Django Blog Tutorial - the Next Generation - Part 9";</script><script type="text/javascript" src="http://disqus.com/forums/matthewdaly/embed.js"></script><noscript><a href="http://matthewdaly.disqus.com/?url=ref">View the discussion thread.</a></noscript></section></article></div><div class="col-md-4"><h1>Recent Posts</h1><p><a href="/blog/2015/05/03/my-static-site-generator-post-on-sitepoint/">My Static Site Generator Post on Sitepoint</a></p><p><a href="/blog/2015/04/18/how-i-added-search-to-my-site-with-lunr-dot-js/">How I Added Search to My Site With Lunr.js</a></p><p><a href="/blog/2015/04/04/adding-a-new-search-engine-to-my-site/">Adding a New Search Engine to My Site</a></p><p><a href="/blog/2015/03/02/syntax-highlighting-in-fenced-code-blocks-in-vim/">Syntax Highlighting in Fenced Code Blocks in Vim</a></p><p><a href="/blog/2015/03/02/extending-our-node-dot-js-and-redis-chat-server/">Extending Our Node.js and Redis Chat Server</a></p><section id="github-profile"></section><h4>My GitHub repositories</h4><ul id="github-repos"><li>Loading repositories...</li></ul></div></div><div class="row"><div class="col-md-12"><ul class="pager"><li><a href="/blog/2014/10/05/introducing-generator-simple-static-blog/">Introducing Generator-simple-static-blog</a></li><li><a href="/blog/2014/09/28/changing-date-format-from-dd-slash-mm-slash-yyyy-to-yyyy-mm-dd-in-vim/">Changing Date Format from DD/MM/YYYY to YYYY-MM-DD in Vim</a></li></ul></div></div></div><footer><div class="container footercontainer"><div class="col-md-12"><p class="copyright">Copyright &copy; Matthew Daly 2015.</p></div></div></footer><script type="text/javascript" src="/static/js/all.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');</script></body></html>