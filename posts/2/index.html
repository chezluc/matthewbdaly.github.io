
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Matthew Daly's Blog</title>
  <meta name="author" content="Matthew Daly">

  
  <meta name="description" content="Hello again! I was originally planning to cover implementing a search system, adding more feeds, and tidying up the front end in this instalment. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://matthewdaly.co.uk/posts/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Matthew Daly's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17043630-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Matthew Daly's Blog</a></h1>
  
    <h2>I'm a web developer in Norfolk. This is my blog...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:matthewdaly.co.uk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/24/django-blog-tutorial-the-next-generation-part-5/">Django Blog Tutorial - the Next Generation - Part 5</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-05-24T20:15:54+01:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:15 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello again! I was originally planning to cover implementing a search system, adding more feeds, and tidying up the front end in this instalment. However, I felt it was time for a change of pace, so instead, we&rsquo;re going to look at:</p>

<ul>
<li>Checking code coverage and getting it to 100%</li>
<li>Using continuous integration</li>
<li>Deploying to Heroku</li>
</ul>


<p>Don&rsquo;t worry, the original lesson isn&rsquo;t going anywhere. We&rsquo;ll still be implementing all of that later on, but today is the day we get your Django blog up and running on the web. That way, you can get a better idea of how Django works in the wild, and you have something concrete to show for your efforts.</p>

<h1>Continuous integration</h1>

<p>If you&rsquo;re not familiar with continuous integration, it&rsquo;s basically a process that carries out some tasks automatically when you push a new commit to the repository. These tasks may include running unit tests, linting your code, and checking it to see what percentage of the code base is covered by the tests (after all, if your tests don&rsquo;t actually cover every scenario, then there&rsquo;s more of a chance that something might slip through the net. It&rsquo;s also possible to implement hooks to automatically deploy your application only if the tests pass.</p>

<p>Typically, you will have a continuous integration server running somewhere that regularly polls your Git repository for changes, and when it finds a new commit, will check it out and run the tests (or whatever other task you configure it to). One of the most popular continuous integration servers around is <a href="http://jenkins-ci.org/">Jenkins</a> - I use it at work and can highly recommend it. However, we aren&rsquo;t going to cover using Jenkins here because setting it up is quite a big deal and it really is best kept on a server of its own (although feel free to use it if you prefer). Instead, we&rsquo;re going to use <a href="https://travis-ci.org/">Travis CI</a>, which integrates nicely with GitHub and is free for open source projects. If you don&rsquo;t mind your code being publicly available on GitHub, then Travis is a really great way to dip your toe into continuous integration.</p>

<p>NB: You don&rsquo;t have to use continuous integration at all if you don&rsquo;t want to - this isn&rsquo;t a big project so you don&rsquo;t really need it. If you don&rsquo;t want to put your code on GitHub, then feel free to just follow along and not bother pushing your code to GitHub and configuring Travis.</p>

<h1>Code coverage</h1>

<p>As mentioned above, code coverage is a measure of the percentage of the code that is covered by tests. While not infallible, it&rsquo;s a fairly good guide to how comprehensive your tests are. If you have 100% code coverage, you can be fairly confident that your tests are comprehensive enough to catch most errors, so it&rsquo;s a good rule of thumb to aim for 100% test coverage on a project.</p>

<p>So how do we check our test coverage? The <code>coverage</code> Python module is the most common tool for this. There&rsquo;s also a handy Django module called <code>django-jenkins</code>, which is designed to work with Jenkins, but can be used with any continuous integration server, that can not only run your tests, but also check code coverage at the same time. So, make sure your virtualenv is up and running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>Then, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install coverage django-jenkins
</span></code></pre></td></tr></table></div></figure>


<p>Once that&rsquo;s done, add these to our requirements file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>We now need to configure our Django project to use <code>django-jenkins</code>. Add the following to the bottom of the settings file:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;django_jenkins&#39;</span><span class="p">,)</span>
</span><span class='line'><span class="n">JENKINS_TASKS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;django_jenkins.tasks.run_pylint&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django_jenkins.tasks.with_coverage&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="n">PROJECT_APPS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;blogengine&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This adds <code>django-jenkins</code> to our installed apps and tells it to include two additional tasks, besides running the tests. The first task runs Pylint to check our code quality (but we aren&rsquo;t really concerned about that at this point). The second checks the coverage. Finally, we tell <code>django-jenkins</code> that the <code>blogengine</code> app is the only one to be tested.</p>

<p>You&rsquo;ll also want to add the following lines to your <code>.gitignore</code>:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>reports/
</span><span class='line'>htmlcov/
</span></code></pre></td></tr></table></div></figure>


<p>These are the reports generated by <code>django-jenkins</code>, and should not be kept under version control. With that done, it&rsquo;s time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore django_tutorial_blog_ng/ requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Added coverage checking using django-jenkins&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s run our tests. From now on, you&rsquo;ll use the following command to run your tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins
</span></code></pre></td></tr></table></div></figure>


<p>This ensures we check the coverage at the same time. Now, you&rsquo;ll notice that the <code>reports</code> folder has been created, and it will contain three files, including one called <code>coverage.xml</code>. However, XML isn&rsquo;t a very friendly format. Happily, we can easily generate reports in HTML instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Running this command will create another folder called <code>htmlcov/</code>, and in here you will find your report, nicely formatted as HTML. Open up <code>index.html</code> in your web browser and you should see a file-by-file breakdown of your code coverage. Nice, huh?</p>

<p>Now, if your code so far is largely identical to mine, you&rsquo;ll notice that the model and view files don&rsquo;t have 100% coverage yet. If you click on each one, you&rsquo;ll see a handy line-by-line breakdown of the test coverage for each file. You&rsquo;ll notice that in the views file, the areas of the code for when tags and categories don&rsquo;t exist are highlighted in pink - this tells you that these lines of code are never executed during the tests. So let&rsquo;s fix that.</p>

<p>First, our template needs to be able to handle empty lists.</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/blogengine/post_list.html
</span><span class='line'>git commit -m <span class="s1">&#39;Added a &quot;No posts found&quot; message to post list template&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to write tests to check that we get a &ldquo;No posts found&rdquo; message when we view a tag or category that does not exist. Add the following methods to the class <code>PostViewTest()</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_nonexistent_category_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="n">category_url</span> <span class="o">=</span> <span class="s">&#39;/category/blah/&#39;</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;No posts found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_nonexistent_tag_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="n">tag_url</span> <span class="o">=</span> <span class="s">&#39;/tag/blah/&#39;</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;No posts found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Assuming they all pass as expected, then your coverage reports will be regenerated. If you reload the coverage report, you should see that your views now have 100% test coverage. Let&rsquo;s commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py
</span><span class='line'>git commit -m <span class="s1">&#39;Views file now has 100% coverage&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, our models still don&rsquo;t have 100% coverage yet. If you look at the breakdown for <code>models.py</code>, you&rsquo;ll see that the line <code>if not self.slug:</code> has only partial coverage, because we missed out setting a slug for the categories and tags in our test. So, let&rsquo;s fix that. In <code>PostTest()</code>, amend the <code>test_create_category()</code> and <code>test_create_tag()</code> methods as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add attributes</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add attributes</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Then refresh your coverage page, and we should have hit 100% coverage. Excellent news! This means that we can be confident that if any problems get introduced in future, we can pick them up easily. To demonstrate this, let&rsquo;s upgrade our Django install to the latest version and check everything still works as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install Django --upgrade
</span></code></pre></td></tr></table></div></figure>


<p>This will upgrade the copy of Django in our virtualenv to the latest version. Then we can run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Our tests should still pass, indicating that the upgrade to our Django version does not appear to have broken any functionality. Let&rsquo;s update our <code>requirements.txt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span><span class='line'>git add requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Upgraded Django version&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Preparing our web app for deployment to Heroku</h1>

<p>As mentioned previously, I&rsquo;m going to assume you plan to deploy your site on <a href="https://www.heroku.com/">Heroku</a>. It has good Django support, and you can quite happily host a blog there using their free tariff. If you&rsquo;d prefer to use another hosting provider, then you should be able to adapt these instructions accordingly.</p>

<p>Now, so far we&rsquo;ve used SQLite as our database for development purposes. However, SQLite isn&rsquo;t really suitable for production purposes. Heroku provide a Postgresql database for each web app, so we will use that. To configure it, open up <code>settings.py</code> and amend the database configuration section to look like this:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, add the following at the end of the file:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Heroku config</span>
</span><span class='line'><span class="c"># Parse database configuration from $DATABASE_URL</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">dj_database_url</span>
</span><span class='line'><span class="n">DATABASES</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">dj_database_url</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;sqlite:///db.sqlite3&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Honor the &#39;X-Forwarded-Proto&#39; header for request.is_secure()</span>
</span><span class='line'><span class="n">SECURE_PROXY_SSL_HEADER</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="p">,</span> <span class="s">&#39;https&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Allow all host headers</span>
</span><span class='line'><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Static asset configuration</span>
</span><span class='line'><span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="s">&#39;staticfiles&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>A little explanation is called for. Remember when we first started out, we installed the <code>django-toolbelt</code> package, which included <code>dj-database-url</code>? Well, here we use the <code>dj_database_url</code> module to get the database from an environment variable set on Heroku. We set a default value so as to fall back to SQLite when that variable is not set. The other settings are required by Heroku.</p>

<p>You may want to run your tests again to ensure everything is still working before committing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Amended settings to work on desktop and Heroku&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Setting up Continuous Integration and coverage</h1>

<p>Now, as mentioned previously, I&rsquo;ll be demonstrating how to set up Travis CI for our project. Travis CI is only free for open-source projects, so if you don&rsquo;t want to make your code publicly accessible, you may want to use Jenkins instead. I&rsquo;ll leave setting that up and running it as an exercise for the reader, but I recommend a plugin called Cobertura which allows you to publish details of your code&rsquo;s test coverage.</p>

<p>Unfortunately, Travis CI doesn&rsquo;t have the capability to publish your coverage results. Fortunately, you can use <a href="https://coveralls.io/">Coveralls.io</a> to pick up the slack. Like Travis, it&rsquo;s free for open-source projects, and if you host your code on GitHub, it&rsquo;s pretty easy to use.</p>

<p>You can find instructions on setting up a project on Travis CI <a href="http://docs.travis-ci.com/user/getting-started/">here</a>. Once you&rsquo;ve configured it, you&rsquo;ll need to set up your <code>.travis.yml</code> file. This is a simple text file that tells Travis CI how to run your tests. Put the following content in the file:</p>

<figure class='code'><figcaption><span>.travis.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">language</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">python</span>
</span><span class='line'><span class="l-Scalar-Plain">python</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="s">&quot;2.7&quot;</span>
</span><span class='line'><span class="c1"># command to install dependencies</span>
</span><span class='line'><span class="l-Scalar-Plain">install</span><span class="p-Indicator">:</span> <span class="s">&quot;pip</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">-r</span><span class="nv"> </span><span class="s">requirements.txt&quot;</span>
</span><span class='line'><span class="c1"># command to run tests</span>
</span><span class='line'><span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">coverage run --include=&quot;blogengine/*&quot; --omit=&quot;blogengine/migrations/*&quot; manage.py test blogengine</span>
</span><span class='line'><span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">coveralls</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, this tells Travis that this is a Python application, and we should be using Python 2.7. Please note you can test against multiple versions of Python if you wish - just add another line with the Python version you want to test against.</p>

<p>Then, we see that we use Pip to install our requirements. Finally we run our tests with Coverage, in order to generate coverage data, and afterwards call <code>coveralls</code> to pass the coverage data to Coveralls.io.</p>

<p>We also need to install the <code>coveralls</code> module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install coveralls
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>And we need to keep our coverage data out of version control:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>env/
</span><span class='line'>*.pyc
</span><span class='line'>db.sqlite3
</span><span class='line'>blogengine/static/bower_components/
</span><span class='line'>reports/
</span><span class='line'>htmlcov/
</span><span class='line'>.coverage
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll also want to set up your project on Coveralls, as described <a href="https://coveralls.io/docs">here</a> - please note that this requires your project be in a public GitHub repository.</p>

<p>With that done, let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore .travis.yml requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Added Travis config file and Coveralls support&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, assuming you have Travis CI and Coveralls configured, and your code is already hosted on GitHub, then you should be able to just push your code up to trigger the build:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push origin master
</span></code></pre></td></tr></table></div></figure>


<p>If you keep an eye on Travis in your browser, you can watch what happens as your tests are run. If for any reason the build fails, then it shouldn&rsquo;t be too hard to figure out what has gone wrong using the documentation for Travis and Coveralls - both services are pretty easy to use.</p>

<p>Congratulations - you&rsquo;re now using Continuous Integration! That wasn&rsquo;t so hard, was it? Now, every time you push to GitHub, Travis will run your tests, and you&rsquo;ll get an email if they fail, giving you early warning of any problems, and you can check your coverage at the same time. Both Travis and Coveralls offer badges that you can place in your README file on GitHub to show off your coverage and build status - feel free to add these to your repo.</p>

<p>You may want to try making a change that breaks your tests and committing it, then pushing it up, so that you can see what happens when the build breaks.</p>

<h1>Deploying to Heroku</h1>

<p>Our final task today is deploying our blog to Heroku so we can see it in action. First of all, if you don&rsquo;t already have an account with Heroku, you&rsquo;ll need to sign up <a href="https://www.heroku.com/">here</a>. You should also be prompted to install the Heroku toolbelt. Once that&rsquo;s done, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku login
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll be prompted for your credentials - enter these and you should be able to log in successfully.</p>

<p>Now, in order to run our Django app on Heroku, we&rsquo;ll need to add a <code>Procfile</code> to tell Heroku what command to run in order to start your app. In this case, we will be using Gunicorn as our web server. Assuming our project is called <code>django_tutorial_blog_ng</code>, this is what you need to put in this file:</p>

<figure class='code'><figcaption><span>Procfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>web: gunicorn django_tutorial_blog_ng.wsgi
</span></code></pre></td></tr></table></div></figure>


<p>That tells Heroku that the file we need to run for this application is <code>django_tutorial_blog_ng/wsgi.py</code>. To test it, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>foreman start
</span></code></pre></td></tr></table></div></figure>


<p>That will start our web server on port 5000, using Gunicorn rather than the Django development server. You should be able to see it in action <a href="http://127.0.0.1:5000/">here</a>, but you&rsquo;ll notice a very serious issue - namely that the static files aren&rsquo;t being served. Now, Django has a command called <code>collectstatic</code> that collects all the static files and drops them into one convenient folder. Heroku will run this command automatically, so we need to ensure our static files are available. Amend your <code>.gitignore</code> file so it no longer excludes our static files:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>venv/
</span><span class='line'>*.pyc
</span><span class='line'>db.sqlite3
</span><span class='line'>reports/
</span><span class='line'>htmlcov/
</span><span class='line'>.coverage
</span></code></pre></td></tr></table></div></figure>


<p>We also need to amend our wsgi.py to serve static files:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/wsgi.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s">&quot;django_tutorial_blog_ng.settings&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.core.wsgi</span> <span class="kn">import</span> <span class="n">get_wsgi_application</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">dj_static</span> <span class="kn">import</span> <span class="n">Cling</span>
</span><span class='line'>
</span><span class='line'><span class="n">application</span> <span class="o">=</span> <span class="n">Cling</span><span class="p">(</span><span class="n">get_wsgi_application</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should solve our problem. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/wsgi.py Procfile blogengine/static/ .gitignore
</span><span class='line'>git commit -m <span class="s1">&#39;Configured app for deployment on Heroku&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;re ready to deploy our app!</p>

<h1>Deployment</h1>

<p>Every Heroku app needs a unique name. If you don&rsquo;t specify one, then Heroku will generate one for you. Your app will have the domain name <code>appname.herokuapp.com</code> - however, if you already have a domain name lined up for your blog, you can point that domain name at the Heroku app if you wish. I&rsquo;m going to deploy mine with the name <code>blog-shellshocked-info</code>.</p>

<p>You also need to consider where you want to deploy it. Heroku has two regions - North America and EU. By default it will deploy to North America, but as I&rsquo;m in the EU, that&rsquo;s where I want to deploy my app to - obviously if you&rsquo;re in the Americas, you may be better off sticking with North America.</p>

<p>So, let&rsquo;s create our app. Here&rsquo;s the command you need to run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku apps:create blog-shellshocked-info --region eu
</span></code></pre></td></tr></table></div></figure>


<p>You will want to change the app name, or remove it entirely if you&rsquo;re happy for Heroku to generate one for you. If you want to host it in North America, drop the <code>--region eu</code> section.</p>

<p>Once completed, this will have created your new app, and added a Git remote for it, but will not have deployed it. To deploy your app, run this command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>That will push your code up to Heroku. Please note that building the app may take a little while. Once it&rsquo;s done, you can run <code>heroku open</code> to open it in your web browser. You should see an error message stating that the relation <code>blogengine_post</code> does not exist. That&rsquo;s because we need to create our database structure. Heroku allows you to easily run commands on your app with <code>heroku run</code>, so let&rsquo;s create our database and run our migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku run python manage.py syncdb
</span><span class='line'>heroku run python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>These are exactly the same commands you would run locally to create your database, but prefaced with <code>heroku run</code> so that they get run by Heroku. As usual, you will be prompted to create a superuser - you&rsquo;ll want to do this so you can log into the admin.</p>

<p>That&rsquo;s all for today! We&rsquo;ve finally got our site up and running on Heroku, and set up continuous integration so our tests will get run for us. You can see an example of the site working <a href="http://blog.shellshocked.info/">here</a>. As usual, you can check out the latest version of the code with <code>git checkout lesson-5</code>. If you&rsquo;d like a homework assignment, then take a look at <a href="http://docs.travis-ci.com/user/deployment/heroku/">automating deployment to Heroku on successful builds</a> and see if you can get it set up successfully.</p>

<p>Next time around, we&rsquo;ll get back to implementing our search and tidying up the front end. See you then!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/15/django-blog-tutorial-the-next-generation-part-4/">Django Blog Tutorial - the Next Generation - Part 4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-15T17:45:00+00:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:45 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello again! As promised, in this instalment we&rsquo;ll implement categories and tags, as well as an RSS feed.</p>

<p>As usual, we need to switch into our virtualenv:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<h2>Categories</h2>

<p>It&rsquo;s worth taking a little time at this point to set out what we mean by categories and tags in this case, as the two can be very similar. In this case, we&rsquo;ll use the following criteria:</p>

<ul>
<li>A post can have only one category, or none, but a category can be applied to any number of posts</li>
<li>A post can have any number of tags, and a tag can be applied to any number of posts</li>
</ul>


<p>If you&rsquo;re not too familiar with relational database theory, the significance of this may not be apparent, so here&rsquo;s a quick explanation. Because the categories are limited to one per post, the relationship between a post and a category is known as <em>one-to-many</em>. In other words, one post can only have one category, but one category can have many posts. You can therefore define the categories in one table in your database, and refer to them by their ID (the reference to the category in the post table is referred to as a <em>foreign key</em>).</p>

<p>As usual, we will write a test first. Open up <code>blogengine/tests.py</code> and edit the line importing the <code>Post</code> model as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also, add the following method before <code>test_create_post</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add attributes</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This test checks that we can create categories. But categories aren&rsquo;t much use unless we can actually apply them to our posts. So we need to edit our <code>Post</code> model as well, and to do so we need to have a test in place first. Edit the <code>test_create_post</code> method as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Set the attributes</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>What we&rsquo;re doing here is adding a <code>category</code> attribute to the posts. This attribute contains a reference to a <code>Category</code> object.</p>

<p>Now, we also want to test adding, editing, and deleting a category from the admin interface. Add this code to the <code>AdminTest</code> class:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new category now in database</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;perl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check category amended</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check category deleted</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is very similar to the prior code for the posts, and just checks we can create categories via the admin. We also need to check we can apply these categories to posts, and that they don&rsquo;t break the existing tests:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post now in database</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post amended</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post deleted</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we basically take our existing post tests in the admin interface and add the category to them. Finally, we edit the <code>PostViewTest</code> class to include categories:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now it&rsquo;s time to run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="nv">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: blogengine.tests <span class="o">(</span>unittest.loader.ModuleImportFailure<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>ImportError: Failed to import <span class="nb">test </span>module: blogengine.tests
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 254, in _find_tests
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> self._get_module_from_name<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 232, in _get_module_from_name
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 3, in &lt;module&gt;
</span><span class='line'>    from blogengine.models import Post, Category
</span><span class='line'>ImportError: cannot import name Category
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.000s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>This is the expected result. We need to create our Category model. So let&rsquo;s do that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we add <code>Category</code> before <code>Post</code> - this is because <code>Category</code> is a foreign key in <code>Post</code>, and must be defined in order to be used. Also, note that we add the <code>category</code> attribute as a <code>ForeignKey</code> field, like <code>User</code> and <code>Site</code>, indicating that it is an item in another table being references.</p>

<p>We also allow for <code>category</code> to be blank or null, so the user does not have to apply a category if they don&rsquo;t wish to.</p>

<p>If we run our tests, they should still fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>EEFEEEEE...EE
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_category <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 20, in test_create_category
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 37, in test_create_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 215, in test_create_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 192, in test_delete_category
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 304, in test_delete_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 165, in test_edit_category
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 250, in test_edit_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 353, in test_index
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 403, in test_post_page
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 142, in test_create_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">13</span> tests in 3.393s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1, <span class="nv">errors</span><span class="o">=</span>9<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>The category table hasn&rsquo;t yet been created, so we need to use South to create and run the migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>If we then run our tests again, some of them will still fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..F.F.F......
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 142, in test_create_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 201, in test_delete_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 175, in test_edit_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">13</span> tests in 4.047s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s because we haven&rsquo;t registered the categories in the admin. So, that&rsquo;s our next job:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,)}</span>
</span><span class='line'>    <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Category</span><span class="p">)</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we try again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.............
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">13</span> tests in 4.092s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>It passes! Let&rsquo;s do a quick sense check before committing. Run the server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py runserver
</span></code></pre></td></tr></table></div></figure>


<p>If you visit the <a href="http://127.0.0.1:8000/admin/">admin</a>, you&rsquo;ll see the text for category is <code>Categorys</code>, which is incorrect. We also don&rsquo;t have a good representation of the category in the admin. Let&rsquo;s fix that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;categories&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented categories&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, as yet our categories don&rsquo;t actually do all that much. We would like to be able to:</p>

<ul>
<li>List all posts under a category</li>
<li>Show the post category at the base of the post</li>
</ul>


<p>So, let&rsquo;s implement that. First, as usual, we implement tests first:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we do here is assert that for both the post pages and the index, the text from the category name is shown in the response. We also need to check the category-specific route works. Add this method to <code>PostViewTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_category_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get the category URL</span>
</span><span class='line'>    <span class="n">category_url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the category name is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post text is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post date is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is very similar to the previous tests, but fetches the absolute URL for the category, and ensures the category name and post content are shown. Now, let&rsquo;s run our new tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>...........EFF
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_category_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 494, in test_category_page
</span><span class='line'>    <span class="nv">category_url</span> <span class="o">=</span> post.category.get_absolute_url<span class="o">()</span>
</span><span class='line'>AttributeError: <span class="s1">&#39;Category&#39;</span> object has no attribute <span class="s1">&#39;get_absolute_url&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 391, in test_index
</span><span class='line'>    self.assertTrue<span class="o">(</span>post.category.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 446, in test_post_page
</span><span class='line'>    self.assertTrue<span class="o">(</span>post.category.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">14</span> tests in 5.017s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>2, <span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s take a look at why they failed. <code>test_category_page</code> failed because the <code>Category</code> object had no method <code>get_absolute_url</code>. So we need to implement one. To do so, we really need to add a slug field, like the posts already have. Ideally, we want this to be populated automatically, but with the option to create one manually. So, edit the models as follows:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.text</span> <span class="kn">import</span> <span class="n">slugify</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/category/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;categories&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re adding the <code>slug</code> attribute to the <code>Category</code> model here. However, we&rsquo;re also overriding the <code>save</code> method to detect if the slug is set, and if not, to create a slug using the <code>slugify</code> function, and set it as the category&rsquo;s slug. We also define an absolute URL for the category.</p>

<p>Now, if you run the tests, they will fail because we haven&rsquo;t made the changes to the database. So, we use South again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span></code></pre></td></tr></table></div></figure>


<p>Then run the migration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Now, running our tests will show that the tables are in place, but we still have some work to do. The index and post pages don&rsquo;t show our categories, so we&rsquo;ll fix that. First, we&rsquo;ll fix our post list:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Next, we&rsquo;ll take care of our post detail page:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ object.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ object.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;h4&gt;</span>Comments<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-comments&quot;</span> <span class="na">data-href=</span><span class="s">&quot;http://{{ post.site }}{{ post.get_absolute_url }}&quot;</span> <span class="na">data-width=</span><span class="s">&quot;470&quot;</span> <span class="na">data-num-posts=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Note that in both cases we include a link to the category URL.</p>

<p>Now, we should only have one failing test outstanding - the category page. For this, generic views aren&rsquo;t sufficient as we need to limit the queryset to only show those posts with a specific category. Fortunately, we can extend Django&rsquo;s generic views to add this functionality. First, we edit our URLconfs:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note we import a new view from <code>blogengine.views</code> called <code>CategoryListView</code>. Next, we create that listview:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your views here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is quite simple. We import the <code>ListView</code>, as well as our models. Then we extend <code>ListView</code> by getting the slug from the request, fetching the appropriate category, and returning only those posts that have that category. If the category does not exist, we return the empty <code>Post</code> object list. We haven&rsquo;t had to set the template manually as it is inherited from <code>ListView</code>.</p>

<p>If you run the tests, they should now pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..............
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">14</span> tests in 5.083s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Categories are now shown&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Tags</h2>

<p>Tags are fairly similar to categories, but more complex. The relationship they have is called <em>many-to-many</em> - in other words, a tag can be applied to many posts, and one post can have many tags. This is more difficult to model with a relational database. The usual way to do so is to create an intermediate table between the posts and tags, to identify mappings between the two. Fortunately, Django makes this quite easy.</p>

<p>Let&rsquo;s write the tests for our tagging system. As with the categories, we&rsquo;ll write the tests for creating and editing them first, and add in tests for them being visible later. First we&rsquo;ll create a test for creating a new tag object:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add attributes</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we&rsquo;ll amend the test for creating a post to include tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Set the attributes</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add the tag</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check tags</span>
</span><span class='line'>    <span class="n">post_tags</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post_tag</span> <span class="o">=</span> <span class="n">post_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post_tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note the difference in how we apply the tags. Because a post can have more than one tag, we can&rsquo;t just define <code>post.tag</code> in the same way. Instead, we have <code>post.tags</code>, which you can think of as a list, and we use the <code>add</code> method to add a new tag. Note also that the post must already exist before we can add a tag.</p>

<p>We also need to create acceptance tests for creating, editing and deleting tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new tag now in database</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;perl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check tag amended</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check tag deleted</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>These tests are virtually identical to those for the <code>Category</code> objects, as we plan for our <code>Tag</code> objects to be very similar. Finally, we need to amend the acceptance tests for <code>Post</code> objects to include a tag:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post now in database</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post amended</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post deleted</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;re just adding tags to our <code>Post</code> objects.</p>

<p>Now it&rsquo;s time to run our tests to make sure they fail as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="nv">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: blogengine.tests <span class="o">(</span>unittest.loader.ModuleImportFailure<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>ImportError: Failed to import <span class="nb">test </span>module: blogengine.tests
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 254, in _find_tests
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> self._get_module_from_name<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 232, in _get_module_from_name
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 3, in &lt;module&gt;
</span><span class='line'>    from blogengine.models import Post, Category, Tag
</span><span class='line'>ImportError: cannot import name Tag
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.000s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So here we can&rsquo;t import our <code>Tag</code> model, because we haven&rsquo;t created it. So, we&rsquo;ll do that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/tag/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>Tag</code> model is very much like our <code>Category</code> model, but we don&rsquo;t need to change the <code>verbose_name_plural</code> value, and we amend the absolute URL to show it as a tag rather than a category.</p>

<p>We also need to amend our <code>Post</code> model to include a <code>tags</code> field:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>tags</code> is a <code>ManyToManyField</code>, and we pass through the model we wish to use, much like we did with the categories. The difference is that one tag can be applied to many posts and a post can have many tags, so we need an intermediate database table to handle the relationship between the two. With Django&rsquo;s ORM we can handle this quickly and easily.</p>

<p>Run our tests and they should still fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.EE.EF.EE.EE......
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 64, in test_create_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_tag <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 41, in test_create_tag
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 335, in test_create_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 440, in test_delete_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 306, in test_delete_tag
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 377, in test_edit_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 279, in test_edit_tag
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 256, in test_create_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">18</span> tests in 3.981s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1, <span class="nv">errors</span><span class="o">=</span>7<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Again, we can easily see why they failed - the <code>blogengine_tag</code> table is not in place. So let&rsquo;s create and run our migrations to fix that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Now, we run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.....F..F..F......
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 256, in test_create_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 315, in test_delete_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 289, in test_edit_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">18</span> tests in 5.124s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t yet amend our tags in the admin, because we haven&rsquo;t registered them. So we do that next:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,)}</span>
</span><span class='line'>    <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Category</span><span class="p">)</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Tag</span><span class="p">)</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if we run our tests, they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">18</span> tests in 5.444s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Time to commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented tags&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, like with the categories beforehand, we want to be able to show the tags applied to a post at the base of it, and list all posts for a specific tag. So, first of all, we&rsquo;ll amend our <code>PostViewTest</code> class to check for the tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;perl&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post tag is in the response</span>
</span><span class='line'>        <span class="n">post_tag</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post_tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;perl&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post tag is in the response</span>
</span><span class='line'>        <span class="n">post_tag</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post_tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We create a tag near the top, and check for the text in the page (note that to avoid false positives from the categories, we set the name of the tags to something different). We do this on both the index and post pages.</p>

<p>We also need to put a test in place for the tag-specific page:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_tag_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get the tag URL</span>
</span><span class='line'>    <span class="n">tag_url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the tag name is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post text is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post date is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, this is virtually identical to the category page, adjusted to allow for the fact that we need to get a specific tag. If we now run our tests, they should fail as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>................FFF
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 540, in test_index
</span><span class='line'>    self.assertTrue<span class="o">(</span>post_tag.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 607, in test_post_page
</span><span class='line'>    self.assertTrue<span class="o">(</span>post_tag.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_tag_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 714, in test_tag_page
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">19</span> tests in 5.375s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So, we need to implement the following things:</p>

<ul>
<li>Show tags on the index page</li>
<li>Show tags on the post pages</li>
<li>Create a page listing the posts with a specific tag</li>
</ul>


<p>As we have seen already with the categories, this is actually quite simple. First, we&rsquo;ll sort out the tags on the index page:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% for tag in post.tags.all %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>This is quite simple. We retrieve all the tags with <code>post.tags.all</code> and loop through them. We then do basically the same for the individual post pages:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ object.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ object.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% for tag in post.tags.all %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;h4&gt;</span>Comments<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-comments&quot;</span> <span class="na">data-href=</span><span class="s">&quot;http://{{ post.site }}{{ post.get_absolute_url }}&quot;</span> <span class="na">data-width=</span><span class="s">&quot;470&quot;</span> <span class="na">data-num-posts=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>This should resolve two of our outstanding tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..................F
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_tag_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 714, in test_tag_page
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">19</span> tests in 5.440s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>The final test is for the tag pages. As we saw with the categories, we can limit our querysets on specific pages. So we&rsquo;ll extend the <code>ListView</code> generic view again to handle tags:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your views here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TagListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that here, <code>Tag</code> objects have access to their assigned <code>Post</code> objects - we just use <code>post_set</code> to refer to them and get all of the posts associated with that tag. Next we&rsquo;ll add the URLconfs:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tags</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Tag</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We import the <code>Tag</code> model and the <code>TagListView</code> view, and use them to set up the tag page.</p>

<p>If we now run our tests again, they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>...................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">19</span> tests in 5.473s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Well done! Time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/ blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Tags are now shown&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>RSS Feed</h2>

<p>For the final task today, we&rsquo;ll implement an RSS feed for our posts. Django ships with a handy syndication framework that makes it easy to implement this kind of functionality.</p>

<p>As usual, we&rsquo;ll create some tests first. In this case, we won&rsquo;t be adding any new models, so we don&rsquo;t need to test them. Instead we can jump straight into creating acceptance tests for our feed. For now we&rsquo;ll just create one type of feed: a feed of all the blog posts. In a later instalment we&rsquo;ll add feeds for categories and tags.</p>

<p>First of all, we&rsquo;ll implement our test. Now, in order to test our feed, we need to have a solution in place for parsing an RSS feed. Django won&rsquo;t do this natively, so we&rsquo;ll install the <code>feedparser</code> Python module. Run the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install feedparser
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Once that&rsquo;s done, feedparser should be available. You may wish to refer to the <a href="http://pythonhosted.org/feedparser/">documentation</a> as we go to help.</p>

<p>Let&rsquo;s write our test for the RSS feed. First, we import feedparser near the top of the file:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">feedparser</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we define a new class for our feed tests. Put this towards the end of the file - I put it just before the flat page tests:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FeedTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_all_post_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create a post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Add the tag</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the feed</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/feeds/posts/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Parse the feed</span>
</span><span class='line'>        <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check length</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post retrieved is the correct one</span>
</span><span class='line'>        <span class="n">feed_post</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests and you&rsquo;ll see something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..............F.....
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_all_post_feed <span class="o">(</span>blogengine.tests.FeedTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 781, in test_all_post_feed
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">20</span> tests in 6.743s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re getting a 404 error because the post feed isn&rsquo;t implemented. So let&rsquo;s implement it. We&rsquo;re going to use Django&rsquo;s syndication framework, which will make it easy, but we need to enable it. Open up <code>django_tutorial_blog_ng/settings/py</code> and add the following under <code>INSTALLED_APPS</code>:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="s">&#39;django.contrib.syndication&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to enable the URLconf for this RSS feed. Open up <code>blogengine/urls.py and amend the import from</code>blogengine.views` near the top:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span><span class="p">,</span> <span class="n">PostsFeed</span>
</span></code></pre></td></tr></table></div></figure>


<p>Further down, add in the following code to define the URL for the feed:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Post RSS feed</span>
</span><span class='line'><span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/$&#39;</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">()),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we imported the PostsFeed class, but that hasn&rsquo;t yet been defined. So we need to do that. First of all, add this line near the top:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.syndication.views</span> <span class="kn">import</span> <span class="n">Feed</span>
</span></code></pre></td></tr></table></div></figure>


<p>This imports the syndication views - yes, they&rsquo;re another generic view! Our <code>PostsFeed</code> class is going to inherit from <code>Feed</code>. Next, we define the class:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostsFeed</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;RSS feed - posts&quot;</span>
</span><span class='line'>    <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;feeds/posts/&quot;</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;RSS feed - blog posts&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is fairly straightforward. We define our title, link, and description for the feed inside the class definition. We define the <code>items</code> method which sets what items are returned by the RSS feed. We also define the <code>item_title</code> and <code>item_description</code> methods.</p>

<p>Now, if we run our tests, they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>....................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">20</span> tests in 5.933s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ django_tutorial_blog_ng/ requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;RSS feed implemented&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s enough for now. Don&rsquo;t forget, you can get the code for this lesson by cloning the repository from <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">Github</a> and running <code>git checkout lesson-4</code> to switch to this lesson.</p>

<p>Next time we&rsquo;ll:</p>

<ul>
<li>Implement a search system</li>
<li>Add feeds for categories and posts</li>
<li>Tidy up the user interface</li>
</ul>


<p>Hope to see you then!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/25/my-first-yeoman-generator/">My First Yeoman Generator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-25T11:38:40+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:38 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At work I use the <a href="http://www.getskeleton.com/">Skeleton boilerplate</a> a lot - my boss, who handles most of the design work, likes it and generally uses it for his designs. I&rsquo;ve also been using <a href="http://gruntjs.com/">Grunt</a> a lot lately, so it was inevitable that I&rsquo;d probably start to look for a <a href="http://yeoman.io/">Yeoman</a> generator for working with it.</p>

<p>There was an existing Yeoman generator for Skeleton, but it didn&rsquo;t really do what I wanted. I wanted something that:</p>

<ul>
<li>Included jQuery and Modernizr</li>
<li>Automatically concatenates and minifies all the JavaScript and CSS</li>
<li>Will automatically rebuild on changes</li>
<li>Includes LiveReload and a development server</li>
<li>Includes automatic deployment via FTP</li>
</ul>


<p>After looking through the documentation for Yeoman, it was actually quick and easy to throw together my own generator and put it up. It&rsquo;s available <a href="https://npmjs.org/package/generator-skellington">here</a>, and the GitHub repository is <a href="https://github.com/matthewbdaly/generator-skellington">here</a>.</p>

<p>Future plans for it include:</p>

<ul>
<li>Adding auto-prefixing for CSS</li>
<li>Removing redundant CSS rules automatically</li>
<li>Possibly, alternate deployment methods</li>
</ul>


<p>Frustratingly, NPM seems to be playing up at present - it&rsquo;s not picking up the README file, and the Yeoman site isn&rsquo;t pulling it in. Any idea why, anyone?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/03/django-blog-tutorial-the-next-generation-part-3/">Django Blog Tutorial - the Next Generation - Part 3</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-03T12:57:30+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>12:57 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello again! In this instalment, we&rsquo;re going to do the following:</p>

<ul>
<li>Add support for flat pages</li>
<li>Add support for multiple authors</li>
<li>Add a third-party comment system</li>
</ul>


<h2>Flat pages</h2>

<p>Django ships with a number of useful apps - we&rsquo;ve already used the admin interface. The flat pages app is another very handy app that comes with Django, and we&rsquo;ll use it to allow the blog author to create a handful of flat pages.</p>

<p>First of all, you&rsquo;ll need to install the flatpages app. Edit the <code>INSTALLED_APPS</code> setting as follows:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;south&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;blogengine&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.flatpages&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we needed to enable the <code>sites</code> framework as well. You&rsquo;ll also need to set the <code>SITE_ID</code> setting:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, run <code>python manage.py syncdb</code> to create the required database tables. Now, let&rsquo;s use the <code>sqlall</code> command to take a look at the database structure generated for the flat pages:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">BEGIN</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;django_flatpage_sites&quot;</span> <span class="p">(</span>
</span><span class='line'>    <span class="ss">&quot;id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;flatpage_id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;site_id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">REFERENCES</span> <span class="ss">&quot;django_site&quot;</span> <span class="p">(</span><span class="ss">&quot;id&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="k">UNIQUE</span> <span class="p">(</span><span class="ss">&quot;flatpage_id&quot;</span><span class="p">,</span> <span class="ss">&quot;site_id&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;django_flatpage&quot;</span> <span class="p">(</span>
</span><span class='line'>    <span class="ss">&quot;id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;url&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;title&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;content&quot;</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;enable_comments&quot;</span> <span class="n">bool</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;template_name&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;registration_required&quot;</span> <span class="n">bool</span> <span class="k">NOT</span> <span class="k">NULL</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="ss">&quot;django_flatpage_sites_872c4601&quot;</span> <span class="k">ON</span> <span class="ss">&quot;django_flatpage_sites&quot;</span> <span class="p">(</span><span class="ss">&quot;flatpage_id&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="ss">&quot;django_flatpage_sites_99732b5c&quot;</span> <span class="k">ON</span> <span class="ss">&quot;django_flatpage_sites&quot;</span> <span class="p">(</span><span class="ss">&quot;site_id&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="ss">&quot;django_flatpage_c379dc61&quot;</span> <span class="k">ON</span> <span class="ss">&quot;django_flatpage&quot;</span> <span class="p">(</span><span class="ss">&quot;url&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">COMMIT</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As mentioned previously, all models in Django have an <code>id</code> attribute by default. Each flat page also has a URL, title, and content.</p>

<p>Also note the separate <code>django_flatpage_sites</code> table, which maps sites to flat pages. Django can run multiple sites from the same web app, and so flat pages must be allocated to a specific site. This relationship is a many-to-many relationship, so one flat page can appear on more than one site.</p>

<p>The other fields <a href="http://127.0.0.1:8000/admin/flatpages/flatpage/add/">are hidden by default in the admin</a> and can be ignored. Let&rsquo;s have a go with Django&rsquo;s handy shell to explore the flatpage. Run <code>python manage.py shell</code> and you&rsquo;ll be able to interact with your Django application interactively:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="n">Smith</span><span class="p">:</span><span class="n">django_tutorial_blog_ng</span> <span class="n">matthewdaly</span><span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>
</span><span class='line'><span class="n">Python</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">6</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Nov</span> <span class="mi">23</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">45</span><span class="p">)</span>
</span><span class='line'><span class="p">[</span><span class="n">GCC</span> <span class="mf">4.2</span><span class="o">.</span><span class="mi">1</span> <span class="p">(</span><span class="n">Apple</span> <span class="n">Inc</span><span class="o">.</span> <span class="n">build</span> <span class="mi">5666</span><span class="p">)</span> <span class="p">(</span><span class="n">dot</span> <span class="mi">3</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
</span><span class='line'><span class="n">Type</span> <span class="s">&quot;help&quot;</span><span class="p">,</span> <span class="s">&quot;copyright&quot;</span><span class="p">,</span> <span class="s">&quot;credits&quot;</span> <span class="ow">or</span> <span class="s">&quot;license&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
</span><span class='line'><span class="p">(</span><span class="n">InteractiveConsole</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib.flatpages.models</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">FlatPage</span>
</span><span class='line'><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">django</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">flatpages</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">FlatPage</span><span class="s">&#39;&gt;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="n">Site</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, <code>flatpages</code> is a Django app similar to the <code>blogengine</code> one, with its own models, as is <code>sites</code>. You can see that the <code>FlatPage</code> class is a model. We can create an instance of it and save it interactively:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/about/&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;About me&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">&#39;All about me&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that because the relationship between the site and the flat page is a many-to-many relationship, we need to save it first, then use the <code>add</code> method to add the site to the list of sites.</p>

<p>We can retrieve it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="n">FlatPage</span><span class="p">:</span> <span class="o">/</span><span class="n">about</span><span class="o">/</span> <span class="o">--</span> <span class="n">About</span> <span class="n">me</span><span class="o">&gt;</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">FlatPage</span><span class="p">:</span> <span class="o">/</span><span class="n">about</span><span class="o">/</span> <span class="o">--</span> <span class="n">About</span> <span class="n">me</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'><span class="s">u&#39;About me&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This command is often handy for debugging problems with your models interactively. If you now run the server and visit the admin, you should notice that the Flatpages app is now visible there, and the &lsquo;About me&rsquo; flat page is now shown in there.</p>

<p>Let&rsquo;s also take a look at the SQL required for the <code>Site</code> model. Run <code>python manage.py sqlall sites</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">BEGIN</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;django_site&quot;</span> <span class="p">(</span>
</span><span class='line'>    <span class="ss">&quot;id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;domain&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;name&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">COMMIT</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, very simple - just a domain and a name.</p>

<p>So, now that we have a good idea of how the flat page system works, we can write a test for it. We don&rsquo;t need to write unit tests for the model because Django already does that, but we do need to write an acceptance test to ensure we can create flat pages and they will be where we expect them to be. Add the following to the top of the test file:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.flatpages.models</span> <span class="kn">import</span> <span class="n">FlatPage</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, before we write this test, there&rsquo;s some duplication to resolve. We have two tests that subclass <code>LiveServerTestCase</code>, and both have the same method, <code>setUp</code>. We can save ourselves some hassle by creating a new class containing this method and having both these tests inherit from it. We&rsquo;ll do that now because the flat page test can also be based on it. Create the following class just after <code>PostTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">BaseAcceptanceTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then remove the setUp method from each of the two tests based on <code>LiveServerTestCase</code>, and change their parent class to <code>BaseAcceptanceTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, run the tests and they should pass. Commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Added flatpages to installed apps&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can get started in earnest on our test for the flat pages:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FlatPageViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_flat_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create flat page</span>
</span><span class='line'>        <span class="n">page</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="p">()</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/about/&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;About me&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">&#39;All about me&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Add the site</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new page saved</span>
</span><span class='line'>        <span class="n">all_pages</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pages</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_page</span> <span class="o">=</span> <span class="n">all_pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check data correct</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s">&#39;/about/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;About me&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;All about me&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get URL</span>
</span><span class='line'>        <span class="n">page_url</span> <span class="o">=</span> <span class="n">only_page</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check title and content in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;About me&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;All about me&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>......F..
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_flat_page <span class="o">(</span>blogengine.tests.FlatPageViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 272, in test_create_flat_page
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">9</span> tests in 2.760s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see why it&rsquo;s failed - in our flat page test, the status code is 404, indicating the page was not found. This just means we haven&rsquo;t put flat page support into our URLconf. So let&rsquo;s fix that:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Examples:</span>
</span><span class='line'>    <span class="c"># url(r&#39;^$&#39;, &#39;django_tutorial_blog_ng.views.home&#39;, name=&#39;home&#39;),</span>
</span><span class='line'>    <span class="c"># url(r&#39;^blog/&#39;, include(&#39;blog.urls&#39;)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Blog URLs</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;blogengine.urls&#39;</span><span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Flat pages</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;django.contrib.flatpages.urls&#39;</span><span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>......E..
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_flat_page <span class="o">(</span>blogengine.tests.FlatPageViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 276, in test_create_flat_page
</span><span class='line'>    <span class="nv">response</span> <span class="o">=</span> self.client.get<span class="o">(</span>page_url<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/test/client.py&quot;</span>, line 473, in get
</span><span class='line'>    <span class="nv">response</span> <span class="o">=</span> super<span class="o">(</span>Client, self<span class="o">)</span>.get<span class="o">(</span>path, <span class="nv">data</span><span class="o">=</span>data, **extra<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/test/client.py&quot;</span>, line 280, in get
</span><span class='line'>    <span class="k">return</span> self.request<span class="o">(</span>**r<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/test/client.py&quot;</span>, line 444, in request
</span><span class='line'>    six.reraise<span class="o">(</span>*exc_info<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;</span>, line 114, in get_response
</span><span class='line'>    <span class="nv">response</span> <span class="o">=</span> wrapped_callback<span class="o">(</span>request, *callback_args, **callback_kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/flatpages/views.py&quot;</span>, line 45, in flatpage
</span><span class='line'>    <span class="k">return</span> render_flatpage<span class="o">(</span>request, f<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/decorators.py&quot;</span>, line 99, in _wrapped_view
</span><span class='line'>    <span class="nv">response</span> <span class="o">=</span> view_func<span class="o">(</span>request, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/flatpages/views.py&quot;</span>, line 60, in render_flatpage
</span><span class='line'>    <span class="nv">t</span> <span class="o">=</span> loader.get_template<span class="o">(</span>DEFAULT_TEMPLATE<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/template/loader.py&quot;</span>, line 138, in get_template
</span><span class='line'>    template, <span class="nv">origin</span> <span class="o">=</span> find_template<span class="o">(</span>template_name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/template/loader.py&quot;</span>, line 131, in find_template
</span><span class='line'>    raise TemplateDoesNotExist<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>TemplateDoesNotExist: flatpages/default.html
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">9</span> tests in 3.557s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Our test still fails, but we can easily see  why - the template <code>flatpages/default.html</code> doesn&rsquo;t exist. So we create it:</p>

<figure class='code'><figcaption><span>templates/flatpages/default.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ flatpage.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        {{ flatpage.content|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>This template is based on the blog post one, and just changes a handful of variable names. Note that it can still inherit from the blogengine base template, and in this case we&rsquo;re using that for the sake of consistency.</p>

<p>If you run your tests, you should now see that they pass, so we&rsquo;ll commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/ django_tutorial_blog_ng/ blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented flat page support&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Multiple authors</h2>

<p>Next we&rsquo;ll add support for multiple authors. Now, Django already has a User model, and we&rsquo;ll leverage that to represent the authors. But first we&rsquo;ll write our test:</p>

<figure class='code'><figcaption><span>blogengine/tests/py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">LiveServerTestCase</span><span class="p">,</span> <span class="n">Client</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.flatpages.models</span> <span class="kn">import</span> <span class="n">FlatPage</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">markdown</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your tests here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">PostTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Set the attributes</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check attributes</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">BaseAcceptanceTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log out</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post now in database</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Edit the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check changed successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Delete the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check deleted successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">FlatPageViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_flat_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create flat page</span>
</span><span class='line'>        <span class="n">page</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="p">()</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/about/&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;About me&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">&#39;All about me&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Add the site</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new page saved</span>
</span><span class='line'>        <span class="n">all_pages</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pages</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_page</span> <span class="o">=</span> <span class="n">all_pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check data correct</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s">&#39;/about/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;About me&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;All about me&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get URL</span>
</span><span class='line'>        <span class="n">page_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check title and content in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;About me&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;All about me&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we create a <code>User</code> object to represent the author. Note the <code>create_user</code> convenience method for creating new users quickly and easily.</p>

<p>We&rsquo;re going to exclude the author field from the admin - instead it&rsquo;s going to be automatically populated based on the session data, so that when a user creates a post they are automatically set as the author. We therefore don&rsquo;t need to make any changes for the acceptance tests for posts - our changes to the unit tests for the <code>Post</code> model are sufficient.</p>

<p>Run the tests, and they should fail:</p>

<figure class='code'><figcaption><span>blogengine/tests/py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="n">Smith</span><span class="p">:</span><span class="n">django_tutorial_blog_ng</span> <span class="n">matthewdaly</span><span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span>
</span><span class='line'><span class="n">Creating</span> <span class="n">test</span> <span class="n">database</span> <span class="k">for</span> <span class="n">alias</span> <span class="s">&#39;default&#39;</span><span class="o">...</span>
</span><span class='line'><span class="n">E</span><span class="o">........</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'><span class="n">ERROR</span><span class="p">:</span> <span class="n">test_create_post</span> <span class="p">(</span><span class="n">blogengine</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">PostTest</span><span class="p">)</span>
</span><span class='line'><span class="o">----------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">45</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_create_post</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'><span class="ne">AttributeError</span><span class="p">:</span> <span class="s">&#39;Post&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">&#39;author&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">----------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Ran</span> <span class="mi">9</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">3.620</span><span class="n">s</span>
</span><span class='line'>
</span><span class='line'><span class="n">FAILED</span> <span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">Destroying</span> <span class="n">test</span> <span class="n">database</span> <span class="k">for</span> <span class="n">alias</span> <span class="s">&#39;default&#39;</span><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s add the missing <code>author</code> attribute:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, create the migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll be prompted to either quit or provide a default author ID - select option 2 to provide the ID, then enter 1, which should be your own user account ID. Then run the migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.F.F.....
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 118, in test_create_post
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;added successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 154, in test_edit_post
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;changed successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">9</span> tests in 3.390s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>2<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Our test still fails because the author field isn&rsquo;t set automatically. So we&rsquo;ll amend the admin to automatically set the author when the <code>Post</code> object is saved:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,)}</span>
</span><span class='line'>    <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This tells the admin to exclude the <code>author</code> field from any form for a post, and when the model is saved, to set the author to the user making the HTTP request. Now run the tests, and they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.........
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">9</span> tests in 4.086s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Time to commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Added author field&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Comments</h2>

<p>The <a href="http://matthewdaly.co.uk/blog/2012/03/29/yet-another-tutorial-for-building-a-blog-using-python-and-django-part-4/">previous version of this tutorial</a> implemented comments using Django&rsquo;s own comment system. However, this has since been deprecated from Django and turned into <a href="https://github.com/django/django-contrib-comments">a separate project</a>. So we have two options for how to implement comments:</p>

<ul>
<li>We can use <a href="http://django-contrib-comments.readthedocs.org/en/latest/">the comments system</a></li>
<li>We can use a third-party comments system</li>
</ul>


<p>Now, if you want to use the Django comment system, you can do so, and it shouldn&rsquo;t be too hard to puzzle out how to implement it using the documentation and my prior post. However, in my humble opinion, using a third-party comment system is the way to go for blog comments - they make it extremely easy for people to log in with multiple services without you having to write lots of additional code. They also make it significantly easier to moderate comments, and they&rsquo;re generally pretty good at handling comment spam.</p>

<p>Some of the available providers include:</p>

<ul>
<li><a href="http://disqus.com/">Disqus</a></li>
<li><a href="http://intensedebate.com/">IntenseDebate</a></li>
<li><a href="https://developers.facebook.com/docs/plugins/comments/">Facebook</a></li>
</ul>


<p>For demonstration purposes, we&rsquo;ll use Facebook comments, but this shouldn&rsquo;t require much work to adapt it to the other providers.</p>

<p>First of all, we need to include the Facebook JavaScript SDK:</p>

<figure class='code'><figcaption><span>templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>    <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;//connect.facebook.net/en_GB/all.js#xfbml=1&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;btn btn-navbar&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;.nav-collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;brand&quot;</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nav-collapse collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, the Facebook comment system requires that you pass through the absolute page URL when initialising the comments. At present we can&rsquo;t do that without hard-coding the domain name in our template, which we want to avoid. So, we need to add a site field to each post to identify the site it&rsquo;s associated with.</p>

<p>As usual, we update our tests first:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">LiveServerTestCase</span><span class="p">,</span> <span class="n">Client</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.flatpages.models</span> <span class="kn">import</span> <span class="n">FlatPage</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">markdown</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your tests here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">PostTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Set the attributes</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check attributes</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">BaseAcceptanceTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log out</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post now in database</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Edit the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check changed successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Delete the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check deleted successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">FlatPageViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_flat_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create flat page</span>
</span><span class='line'>        <span class="n">page</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="p">()</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/about/&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;About me&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">&#39;All about me&#39;</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Add the site</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'>        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new page saved</span>
</span><span class='line'>        <span class="n">all_pages</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pages</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_page</span> <span class="o">=</span> <span class="n">all_pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check data correct</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s">&#39;/about/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;About me&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;All about me&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get URL</span>
</span><span class='line'>        <span class="n">page_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">only_page</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check title and content in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;About me&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;All about me&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we&rsquo;ve done here is to add the <code>site</code> attribute when creating a new post using the Django database API, and when we create one via the admin, we add an additional <code>site</code> aparameter to the HTTP POST request with a value of 1. Run the tests and they should fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>E........
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 46, in test_create_post
</span><span class='line'>    self.assertEquals<span class="o">(</span>only_post.site.name, <span class="s1">&#39;example.com&#39;</span><span class="o">)</span>
</span><span class='line'>AttributeError: <span class="s1">&#39;Post&#39;</span> object has no attribute <span class="s1">&#39;site&#39;</span>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">9</span> tests in 4.313s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So we need to add the <code>site</code> attribute to the <code>Post</code> model. Let&rsquo;s do that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now create and run the migrations - you&rsquo;ll be prompted to create a default value for the site attribute as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py schemamigration --auto blogengine
</span><span class='line'> ? The field <span class="s1">&#39;Post.site&#39;</span> does not have a default specified, yet is NOT NULL.
</span><span class='line'> ? Since you are adding this field, you MUST specify a default
</span><span class='line'> ? value to use <span class="k">for</span> existing rows. Would you like to:
</span><span class='line'> ?  1. Quit now, and add a default to the field in models.py
</span><span class='line'> ?  2. Specify a one-off value to use <span class="k">for</span> existing columns now
</span><span class='line'> ? Please <span class="k">select</span> a choice: 2
</span><span class='line'> ? Please enter Python code <span class="k">for</span> your one-off default value.
</span><span class='line'> ? The datetime module is available, so you can <span class="k">do</span> e.g. datetime.date.today<span class="o">()</span>
</span><span class='line'> &gt;&gt;&gt; 1
</span><span class='line'> + Added field site on blogengine.Post
</span><span class='line'>Created 0005_auto__add_field_post_site.py. You can now apply this migration with: ./manage.py migrate blogengine
</span><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py migrate
</span><span class='line'>Running migrations <span class="k">for</span> blogengine:
</span><span class='line'> - Migrating forwards to 0005_auto__add_field_post_site.
</span><span class='line'> &gt; blogengine:0005_auto__add_field_post_site
</span><span class='line'> - Loading initial data <span class="k">for</span> blogengine.
</span><span class='line'>Installed <span class="m">0</span> object<span class="o">(</span>s<span class="o">)</span> from <span class="m">0</span> fixture<span class="o">(</span>s<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our tests should then pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.........
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">9</span> tests in 4.261s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Now we can include our full page URL on the post detail page:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;h4&gt;</span>Comments<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-comments&quot;</span> <span class="na">data-href=</span><span class="s">&quot;http://{{ post.site }}{{ post.get_absolute_url }}&quot;</span> <span class="na">data-width=</span><span class="s">&quot;470&quot;</span> <span class="na">data-num-posts=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>If you want to customise the comments, take a look at <a href="https://developers.facebook.com/docs/plugins/comments/">the documentation for Facebook Comments</a>.</p>

<p>With that done, we can commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented Facebook comments&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that wraps up this lesson. As usual, you can easily switch to today&rsquo;s lesson with <code>git checkout lesson-3</code>. Next time we&rsquo;ll implement categories and tags, and create an RSS feed for our blog posts.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/02/django-blog-tutorial-the-next-generation-part-2/">Django Blog Tutorial - the Next Generation - Part 2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-02T11:28:48+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>11:28 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Welcome back! In this lesson, we&rsquo;ll use Twitter Bootstrap to make our blog look nicer, and we&rsquo;ll implement individual pages for each post.</p>

<p>Now, before we get started, don&rsquo;t forget to switch into your virtualenv. From within the directory for the project, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>If you haven&rsquo;t used Bootstrap before, you&rsquo;re in for a treat. With Bootstrap, it&rsquo;s easy to make a good-looking website quickly that&rsquo;s responsive and mobile-friendly. We&rsquo;ll also use HTML5 Boilerplate to get a basic HTML template in place.</p>

<p>Now, to install these easily, we&rsquo;ll use Bower, which requires <a href="http://nodejs.org/">Node.js</a>. Install Node.js first. On most Linux distros, you&rsquo;ll also need to set <code>NODE_PATH</code>, which can be done by pasting the following into your <code>.bashrc</code>:</p>

<figure class='code'><figcaption><span>.bashrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">NODE_PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/lib/node_modules&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, run the following command to install Bower:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo npm install -g bower
</span></code></pre></td></tr></table></div></figure>


<p>Next we need to create a Bower config. First, create the folder <code>blogengine/static</code>. Then create a new file called <code>.bowerrc</code> and paste in the following content:</p>

<figure class='code'><figcaption><span>.bowerrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;directory&quot;</span><span class="p">:</span> <span class="s2">&quot;blogengine/static/bower_components&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This tells Bower where it should put downloaded libraries. Next, run the following command to gener Bower:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bower init
</span></code></pre></td></tr></table></div></figure>


<p>Answer all the questions it asks you - for those with defaults, these should be fine, and everything else should be easy enough. Next, run the following command to install Bootstrap and HTML5 Boilerplate:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bower install bootstrap html5-boilerplate --save
</span></code></pre></td></tr></table></div></figure>


<p>Note that as jQuery is a dependency of Bootstrap, it will also be installed automatically. Now, we need to keep our Bower-installed files out of version control - the <code>bower.json</code> file keeps track of them for us. So add the following to your .gitignore file:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>blogengine/static/bower_components/
</span></code></pre></td></tr></table></div></figure>


<p>All done? Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore .bowerrc bower.json
</span><span class='line'>git commit -m <span class="s1">&#39;Added Bower config&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s make our template nicer. Django&rsquo;s templating system is very powerful and lets one template inherit from another. We&rsquo;re going to create a base template, using HTML5 Boilerplate as a starting point, that all of our web-facing pages will use. First, create a directory to hold the base template:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir templates/blogengine/includes
</span></code></pre></td></tr></table></div></figure>


<p>Then copy the <code>index.html</code> file from HTML5 Boilerplate to this directory as <code>base.html</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cp blogengine/static/bower_components/html5-boilerplate/index.html templates/blogengine/includes/base.html
</span></code></pre></td></tr></table></div></figure>


<p>Now amend this file to look like this:</p>

<figure class='code'><figcaption><span>templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
</span><span class='line'>
</span><span class='line'>        {% load staticfiles %}
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/normalize.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap-theme.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="c">&lt;!--[if lt IE 7]&gt;</span>
</span><span class='line'><span class="c">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span>
</span><span class='line'><span class="c">        &lt;![endif]--&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>        {% block content %}{% endblock %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&quot;{% static &#39;</span><span class="nx">bower_components</span><span class="o">/</span><span class="nx">html5</span><span class="o">-</span><span class="nx">boilerplate</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">jquery</span><span class="o">-</span><span class="mf">1.10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">js</span><span class="s1">&#39; %}&quot;&gt;&lt;\/script&gt;&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/plugins.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/js/bootstrap.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site&#39;s ID. --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span>
</span><span class='line'>            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">GoogleAnalyticsObject</span><span class="o">=</span><span class="nx">l</span><span class="p">;</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">=</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(){(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">l</span><span class="o">=+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">e</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span><span class="nx">r</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//www.google-analytics.com/analytics.js&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">r</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)}(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;ga&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="s1">&#39;UA-XXXXX-X&#39;</span><span class="p">);</span><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note the following:</p>

<ul>
<li>We need to use <code>{% load staticfiles %}</code> to be able to load any static files.</li>
<li>We use the <code>{% static %}</code> template tag to load static files such as CSS and HTML</li>
<li>We define blocks called <code>title</code> and <code>content</code>. Any template that extends this one can override whatever is inside this template.</li>
</ul>


<p>Please note that HTML5 Boilerplate may conceivable change in future, so bear in mind that all you really need to do is load the staticfiles app, use the <code>static</code> tag for any static files that need to be loaded, and define the blocks in the appropriate places.</p>

<p>Next, let&rsquo;s amend our existing template to inherit from this one:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text }}
</span><span class='line'>        {% endfor %}
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Now fire up the server with <code>python manage.py runserver</code> and check everything is working OK. You should see that your new base template is now in use and the CSS and JS files are being loaded correctly. Let&rsquo;s commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Bootstrap and HTML5 Boilerplate for templates&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s use Bootstrap to style our blog a little. First we&rsquo;ll add a navigation bar at the top of our blog. Edit the base template as follows:</p>

<figure class='code'><figcaption><span>templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;btn btn-navbar&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;.nav-collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;brand&quot;</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nav-collapse collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% block header %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;h1&gt;</span>My Django Blog<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endblock %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% block content %}{% endblock %}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;p&gt;</span>Copyright <span class="ni">&amp;copy;</span> {% now &quot;Y&quot; %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note the footer copyright section. Here we output the current year using <code>now</code>. Also note the addition of the header block. This will let us override the page header if necessary.</p>

<p>We&rsquo;ll also wrap the posts in a div:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Amended templates&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Formatting our content</h2>

<p>As it stands right now, we can&rsquo;t do much to format our posts. It is possible to include HTML in our posts with Django, but by default it will strip it out. Also, we don&rsquo;t want users to have to write HTML manually - we want to make our blog user friendly!</p>

<p>There are two possible approaches. One is to embed a rich text editor like TinyMCE in the admin and use that for editing the files, but I&rsquo;ve found things like that to be cumbersome. The alternative is to use some other form of lightweight markup, and that&rsquo;s the approach we&rsquo;ll take here. We&rsquo;re going to use Markdown for editing our posts.</p>

<p>Django has actually dropped support for Markdown, but it&rsquo;s not hard to implement your own version. First, install Markdown and add it to your <code>requirements.txt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install markdown
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Now, we shouldn&rsquo;t write any production code before writing a test, so let&rsquo;s amend our existing post test to check to see that Markdown is working as expected:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll also need to add the following at the top:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">markdown</span>
</span></code></pre></td></tr></table></div></figure>


<p>What we do here is we convert our post text to include a link using Markdown. We also need to render that post in markdown within the test so that what we have in the test matches what will be produced - otherwise our test will be broken. We also check that the link is marked up correctly.</p>

<p>Save the file and run the tests - they should fail. Now, create the following directory and file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir blogengine/templatetags
</span><span class='line'>touch blogengine/templatetags/__init__.py
</span></code></pre></td></tr></table></div></figure>


<p>Note that the <code>__init__.py</code> file is meant to be blank.</p>

<p>Then create the following file and edit it to look like this:</p>

<figure class='code'><figcaption><span>blogengine/templatetags/custom_markdown.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">markdown</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="n">stringfilter</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_unicode</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
</span><span class='line'>
</span><span class='line'><span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@register.filter</span><span class="p">(</span><span class="n">is_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="nd">@stringfilter</span>
</span><span class='line'><span class="k">def</span> <span class="nf">custom_markdown</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span class='line'>    <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;nl2br&quot;</span><span class="p">,</span> <span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span class='line'>                                       <span class="n">extensions</span><span class="p">,</span>
</span><span class='line'>                                       <span class="n">safe_mode</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>                                       <span class="n">enable_attributes</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then just amend the post list template to use it:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s that easy to use a custom markup system with your blog!</p>

<p>Let&rsquo;s commit the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add requirements.txt templates/ blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Added Markdown support&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Pagination</h2>

<p>As at right now, all of our posts are displayed on the index page. We want to fix that by implementing pagination. Fortunately, that&rsquo;s very easy for us because we&rsquo;re using Django&rsquo;s generic views. Go into <code>blogengine/urls.py</code> and amend it as follows:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>That will automatically paginate our posts by 5 - feel free to change the value of <code>paginate_by</code> if you wish. However, we need to place the links in our template as well:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Try adding a few more blog posts, and you&rsquo;ll see the pagination links. But give them a try, and they won&rsquo;t work. Why not? Well, as it turns out there was a bug in the project-wide <code>urls.py</code> file (my bad!). Let&rsquo;s fix that:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Examples:</span>
</span><span class='line'>    <span class="c"># url(r&#39;^$&#39;, &#39;django_tutorial_blog_ng.views.home&#39;, name=&#39;home&#39;),</span>
</span><span class='line'>    <span class="c"># url(r&#39;^blog/&#39;, include(&#39;blog.urls&#39;)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Blog URLs</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;blogengine.urls&#39;</span><span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you try again, you&rsquo;ll see that the <code>blogengine</code> app now happily deals with the paginated posts. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ django_tutorial_blog_ng/ templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented pagination&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Viewing individual posts</h2>

<p>As our last task for today, we&rsquo;ll implement individual pages for each post. We want each post to have a nice, friendly URL that is as human-readable as possible, and also includes the date the post was created.</p>

<p>First of all, we&rsquo;ll implement our test for it, however:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get the post URL</span>
</span><span class='line'>    <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post title is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post text is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post date is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add this method to the <code>PostViewTest</code> class, after <code>test_index</code>. It&rsquo;s very similar to <code>test_index</code>, since it&rsquo;s testing much the same content. However, not that we fetch the post-specific URL using the method <code>get_absolute_url</code>, and we then fetch that page.</p>

<p>Now, if you run the test, it will fail because <code>get_absolute_url</code> isn&rsquo;t implemented. It&rsquo;s often a good idea to have a <code>get_absolute_url</code> method for your models, which defines a single URL scheme for that type of object. So let&rsquo;s create one. However, to implement our URL scheme we need to make some changes. Right now we have the date, but we don&rsquo;t have a text string we can use, known in Django as a <em>slug</em>. So we&rsquo;ll add a slug field, which will be prepopulated based on the post title. Edit your model as follows:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;ve added a slug field to the model, as well as implementing our <code>get_absolute_url</code> method. Note we&rsquo;ve limited the date to year and month, but you can include days if you wish.</p>

<p>While we&rsquo;re in here, we&rsquo;ve also implemented the <code>__unicode__</code> method. Essentially, this sets how Django describes the object in the admin - in this case, the post title is a logical way of describing that <code>Post</code> object, so it returns the post title.</p>

<p>We&rsquo;ve also added the class Meta, with the ordering field. This tells Django that by default any list of posts should return them ordered by <code>pub_date</code> in reverse - in other words, latest first.</p>

<p>To have the slug filled in automatically, we need to customise the admin interface a little as well:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,)}</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, I recommend at this stage going into the admin and deleting all of your posts, because otherwise you&rsquo;ll have problems in migrating them. The issue is that each slug is compulsory and must be unique, and it&rsquo;s not practical to use South to automatically generate new slugs from the title on the fly, so by deleting them at this stage you&rsquo;ll avoid problems. Once that&rsquo;s done, run this command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll be prompted to specify a one-off default value - enter any string you like, such as &ldquo;blah&rdquo;. Then run the migration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.F.F...F
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 103, in test_create_post
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;added successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 132, in test_edit_post
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;changed successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 222, in test_post_page
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">8</span> tests in 2.180s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Whoops! Our tests are broken, because the slug field isn&rsquo;t being filled in. If you take a look at the page for adding a post, you&rsquo;ll notice that the slug is filled in using JavaScript, so our test fails because the test client doesn&rsquo;t interpret JavaScript. So in the tests we have to fill in the slug field manually.</p>

<p>Also, for the unit tests, the slug attribute isn&rsquo;t being created at all, so it can&rsquo;t be saved. Let&rsquo;s remedy that. First, edit the <code>test_create_post</code> method of <code>PostTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Set the attributes</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check attributes</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, let&rsquo;s amend <code>AdminTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log out</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post now in database</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Edit the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check changed successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Delete the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check deleted successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>And <code>PostViewTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>What we&rsquo;re doing here is that every time we create a Post object programmatically, we add the <code>post.slug</code> atttribute to it. Also, when submitting a post via the admin, we pass the <code>slug</code> parameter via HTTP POST, thus emulating how a form would submit this data.</p>

<p>If you run the tests again, you&rsquo;ll see that <code>test_post_page</code> still fails. This is because we haven&rsquo;t yet up the URLs, templates and views to do so. Let&rsquo;s fix that. We&rsquo;ll use another generic view, called a DetailView, to display the posts. Amend <code>blogengine/urls.py</code> as follows:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">rom</span> <span class="n">django</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">urls</span> <span class="kn">import</span> <span class="nn">patterns</span><span class="o">,</span> <span class="nn">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running our tests again will still fail, but now because the template <code>post_detail.html</code> has not been found. So let&rsquo;s create it:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>{% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>If you run your tests again, they should now pass. However, we still need to provide a hyperlink from each post in the index to the post page, so let&rsquo;s do that:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s all for today! We now have individual post pages, we&rsquo;ve styled our blog a bit, and we&rsquo;ve implemented Markdown support. All that remains is to commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented post pages&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As before, I&rsquo;ve tagged the final commit with &lsquo;lesson-2&rsquo;, so if you&rsquo;re following along, you can switch to this point with <code>git checkout lesson-2</code>.</p>

<p>Next time we&rsquo;ll add support for flat pages and multiple authors, as well as adding support for comments via a third-party commenting system.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/28/django-blog-tutorial-the-next-generation-part-1/">Django Blog Tutorial - the Next Generation - Part 1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-28T15:00:32+00:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:00 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My series of Django tutorials for building a blogging engine are by far the most popular posts I&rsquo;ve ever written on here. I&rsquo;ve had a lot of people contact me with questions or just to express their thanks, for which I&rsquo;m very grateful!</p>

<p>However, these tutorials haven&rsquo;t really aged well. I&rsquo;ve since had the opportunity to use Django in a professional capacity, which has significantly improved my understanding of the framework and the whole Python ecosystem, and there&rsquo;s a lot of best practices that I didn&rsquo;t follow and now wish I had. There&rsquo;s also been a few gotchas that have hindered a few people in the past that I&rsquo;d like to have the opportunity to correct.</p>

<p>So, I&rsquo;m therefore creating a brand new series of tutorials to remedy this situation. This series will cover exactly the same basic idea of using Django to build a blogging engine, but will expand on what the original series did in many ways. We will cover such additional topics as:</p>

<ul>
<li>Using Twitter Bootstrap to make your blog look good without too much hassle</li>
<li>Using Virtualenv to sandbox your blog application</li>
<li>Using South to effectively manage changes to your database structure</li>
<li>Writing some simple unit tests</li>
<li>Deploying the finished application to Heroku</li>
</ul>


<p>Ready? Let&rsquo;s get started!</p>

<h2>Getting everything set up</h2>

<p>Now, first of all, I&rsquo;m going to assume you&rsquo;re using some variant of Unix, such as Linux or Mac OS X. I&rsquo;m not saying you can&rsquo;t follow this tutorial with Windows, but you&rsquo;ll have a harder time, because Windows just isn&rsquo;t as developer-friendly as Unix in general. A modern Linux distro like Ubuntu is generally pretty easy to use, and you can easily run it in Virtualbox, so if you use Windows I would recommend you use that to make things easier.</p>

<p>You should also have at least a basic grasp of the command line, such as how to create and navigate directories. You don&rsquo;t have to be a wizard with it, though.</p>

<p>You also need a proper programmer&rsquo;s text editor. I use Vim, but I freely admit that Vim has a very steep learning curve and you may have trouble picking it up at the same time as following this tutorial. Emacs is also a very powerful text editor, and if you like it, feel free to use it. If you haven&rsquo;t yet found a programmer&rsquo;s text editor you like, I suggest you check out <a href="http://www.sublimetext.com/">Sublime Text</a>, which is easy to get started with, but also very powerful, and can be used without purchasing a license. Don&rsquo;t worry too much about your text editor - it&rsquo;s not vitally import that you use what I use, just find one that works for you. That said, I will say one thing - DON&rsquo;T use an IDE. IDE&rsquo;s hide too many details from new users and make it harder to figure out what&rsquo;s going on.</p>

<p>You will also need to ensure you have the following installed:</p>

<ul>
<li>Python. I recommend installing Python 2.7, because you may have issues with Python 2.6, and Python 3 isn&rsquo;t universally supported yet so you might have some issues with that</li>
<li>Virtualenv</li>
<li>Pip</li>
<li>Git</li>
</ul>


<p>On most Linux distros, you can find packages for all of these items easily enough using your package manager. On Mac OS X, I recommend using Homebrew to install them, though if you have another package manager installed you can use that too. If you have issues with installing any of these, a quick Google search should be sufficient to resolve the issue.</p>

<h2>Beginning work</h2>

<p>With all that done, we&rsquo;re ready to get started. Create a folder in a suitable place on your file system and switch into it. I generally keep a dedicated folder in my home directory called <code>Projects</code> to use for all of my projects, and give each project a folder within it - in this case the project is called <code>django_tutorial_blog_ng</code>.</p>

<p>Now, we&rsquo;ll use Git to keep track of our source code. If you prefer Mercurial, feel free to use that, but this tutorial will assume use of Git, so you&rsquo;ll want to adapt the commands used accordingly. Start tracking your project with the following command from the shell, when you&rsquo;re in the project directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git init
</span></code></pre></td></tr></table></div></figure>


<p>If you haven&rsquo;t used Git before, you&rsquo;ll also want to <a href="http://git-scm.com/book/en/Getting-Started-First-Time-Git-Setup">configure it</a>.</p>

<p>Next, we set up our virtualenv. Run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>virtualenv venv --distribute
</span></code></pre></td></tr></table></div></figure>


<p>Followed by:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>Every time you come back to work on this project, you&rsquo;ll need to run the previous command to make sure you&rsquo;re running the version of Python installed under venv/ rather than your system Python. You can tell it&rsquo;s using this because your shell prompt will be prefixed with <code>(venv)</code>.</p>

<p>Why do this? Well, it means you can install whatever version of a Python module you like, without having root access, and means the Python install you&rsquo;re using will only have those modules you explicitly install, rather than all of those ones available with your operating system. For instance, you could have multiple projects using different versions of Django, rather than having to update a global installation of Django and potentially break existing applications.</p>

<p>Now that our virtualenv is set up, we&rsquo;ll install Django, as well as several other useful Python modules. Run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install django-toolbelt South
</span></code></pre></td></tr></table></div></figure>


<p>A little explanation is called for here. The package <code>django-toolbelt</code> includes a number of packages we&rsquo;ll be using, including Django, as well as Gunicorn (a simple web server we&rsquo;ll use when the time comes to deploy the app to Heroku). South is a migration tool that is commonly used with Django - basically, if you make changes to existing models, Django doesn&rsquo;t natively have the capacity to apply those changes (yet - native migrations are planned at some point in the future), so South can be used to apply those changes for you without having to either manually change the database structure or dump the database and rebuild it.</p>

<p>Please note that one of the packages, <code>psycopg2</code>, may fail if you don&rsquo;t have PostgreSQL installed, but don&rsquo;t worry about installing it. We&rsquo;ll be using SQLite for developing the application locally, and we&rsquo;ll be deploying the finished product to Heroku, which does have it installed.</p>

<p>Once the installation is complete, run the following command to record the new modules installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>The file <code>requirements.txt</code> will be created, which stores the packages and versions you have installed so that they can be easily recreated. If you had issues installing <code>psycopg2</code>, then here&rsquo;s what your <code>requirements.txt</code> should look like - feel free to edit it manually to look like this, as when we deploy it to Heroku, it will need to be correct to ensure that our application can be deployed successfully:</p>

<figure class='code'><figcaption><span>requirements.txt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">Django</span><span class="o">==</span>1.6.1
</span><span class='line'><span class="nv">South</span><span class="o">==</span>0.8.4
</span><span class='line'>dj-database-url<span class="o">==</span>0.2.2
</span><span class='line'>dj-static<span class="o">==</span>0.0.5
</span><span class='line'>django-toolbelt<span class="o">==</span>0.0.1
</span><span class='line'><span class="nv">gunicorn</span><span class="o">==</span>18.0
</span><span class='line'><span class="nv">psycopg2</span><span class="o">==</span>2.5.1
</span><span class='line'><span class="nv">static</span><span class="o">==</span>0.4
</span><span class='line'><span class="nv">wsgiref</span><span class="o">==</span>0.1.2
</span></code></pre></td></tr></table></div></figure>


<p>Next, we&rsquo;ll commit these changes with Git:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Committed requirements&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we&rsquo;ll add a <code>.gitignore</code> file to ignore our virtualenv - we want to keep this out of version control because it&rsquo;s something specific to that install. We have all we need to recreate it so we don&rsquo;t want to store it. In addition, we also want to ignore any compiled Python files (identifiable by the .pyc suffix):</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>venv/
</span><span class='line'>*.pyc
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit that too:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore
</span><span class='line'>git commit -m <span class="s1">&#39;Added a gitignore file&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s generate our project&rsquo;s basic skeleton:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>django-admin.py startproject django_tutorial_blog_ng .
</span></code></pre></td></tr></table></div></figure>


<p>This application skeleton includes a basic configuration which will be sufficient for now, but you will also want to add the SQLite database file to your <code>.gitignore</code>:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>env/
</span><span class='line'>*.pyc
</span><span class='line'>db.sqlite3
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit what we&rsquo;ve done:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore django_tutorial_blog_ng/ manage.py
</span><span class='line'>git commit -m <span class="s1">&#39;Created project skeleton&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, before we create our database, we need to ensure we are using South. Go into <code>django_tutorial_blog_ng/settings.py</code> and find <code>INSTALLED_APPS</code>. Edit it to look like this:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;south&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, you can create your database. Run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py syncdb
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll be prompted to create a superuser - go ahead and fill in the details. Now, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py runserver
</span></code></pre></td></tr></table></div></figure>


<p>This will run Django&rsquo;s built-in web server on port 8000, and if you click <a href="http://127.0.0.1:8000">here</a>, you should see a page congratulating you on your first Django-powered page. Once you&rsquo;re finished with it, you can stop the web server with Ctrl-C.</p>

<p>Don&rsquo;t forget to commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Added South to installed apps&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Your first app</h2>

<p>Django distinguishes between the concepts of <strong>projects</strong> and <strong>apps</strong>. A project is a specific project that may consist of one or more apps, such as a web app, whereas an app is a set of functionality within a project. For instance, one website might include some flat pages, an admin interface, and a blogging engine, and these could easily be different apps. By encouraging you to separate different types of functionality into different apps, Django makes it easier for you to reuse existing content elsewhere.</p>

<p>We&rsquo;re going to create our first app, which is the blogging engine. Run the following command to create a basic skeleton for this app:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py startapp blogengine
</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to amend our settings to install this app:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;south&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;blogengine&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, before we can use this app, we want to let South know about it so that changes to your database structure will be managed right from the start by South. Run the following command to create your initial migration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --initial blogengine
</span></code></pre></td></tr></table></div></figure>


<p>That creates the file for your first migration,but doesn&rsquo;t run it. To migrate your database structure to the latest version, run the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>This won&rsquo;t actually make any changes, but it will ensure that all future changes to your models for the <code>blogengine</code> app are handled by South. Let&rsquo;s commit our app skeleton:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/settings.py blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Added blogengine app skeleton&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, we now have our first app set up, but it doesn&rsquo;t do anything much.</p>

<p>Remember that I mentioned how Django differentiates between projects and apps? Well, Django actually ships with a number of useful apps, and one of those is the admin interface. I consider the Django admin to be one of the framework&rsquo;s killer features because it&rsquo;s easy to use and customise, and saves you a lot of grief.</p>

<p>In the past, the admin interface needed a little work to get it working, but in Django 1.6 it&rsquo;s configured to work out of the box, so if you click <a href="http://127.0.0.1:8000/admin/">here</a>, you should see the login screen for it. You should be able to sign in using the username and password you set when you ran <code>syncdb</code>.</p>

<p>Next, we&rsquo;ll set up our first model.</p>

<h2>An introduction to MVC</h2>

<p>MVC is a common pattern used in web development. Many web development frameworks can be loosely described as MVC, including Django, Rails, CodeIgniter, Laravel and Symfony, as well as some client-side frameworks like Backbone.js. The basic concept is that a web app is divided into three basic components:</p>

<ul>
<li><strong>Models</strong> - the data managed with the application</li>
<li><strong>Views</strong> - the presentation of the data</li>
<li><strong>Controllers</strong> - an intermediary between the models and the views</li>
</ul>


<p>Now, Django&rsquo;s interpretation of MVC is slightly different to many other frameworks. While in most frameworks the views are HTML templates for rendering the data, in Django this role is taken by the templates, and the views are functions or objects that render data from the models using a template. Effectively, you can think of Django&rsquo;s views as being like controllers in other frameworks, and Django templates as being views.</p>

<p>In Django, you create your models as Python classes that represent your data, and you use the Django ORM to query the database. As a result, it&rsquo;s rare to have to directly query your database using SQL, making it more portable between different databases.</p>

<p>Now, our first model is going to be of a blog post. At least initially, each post will have the following attributes:</p>

<ul>
<li>A title</li>
<li>A publication date and time</li>
<li>Some text</li>
</ul>


<p>Now, we could just jump straight into creating our first model, but we&rsquo;re going to make a point of following the practices of test-driven development here. The basic concept of TDD is that you write a failing test before writing any code, then you write the code to pass that test afterwards. It does make things a bit slower, but it&rsquo;s all too easy to neglect writing tests at all if you leave it till later.</p>

<p>If you take a look in the <code>blogengine</code> folder you&rsquo;ll notice there&rsquo;s a file called <code>tests.py</code>. Open it up and you should see the following:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your tests here.</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s worth taking a little time to plan out what we want to test from our post model. Each post object will have the attributes I mentioned above, and what we want to be able to do is test that we can:</p>

<ul>
<li>Set the title</li>
<li>Set the publication date and time</li>
<li>Set the text</li>
<li>Save it successfully</li>
<li>Retrieve it successfully</li>
</ul>


<p>So, let&rsquo;s create a test for our post model. We&rsquo;ll go through the relevant sections of the test bit by bit:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;re importing the required functionality. <code>TestCase</code> is provided by Django, and is an object all of your tests should inherit from. <code>timezone</code> is a utility for handling dates and times correctly. Finally, <code>Post</code> is our model, which we have yet to implement.</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Create your tests here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">PostTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we create the PostTest class, which represents a test for your <code>Post</code> model. So far it only has one method, but you can add additional ones if required.</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>        <span class="c"># Set the attributes</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we set the post&rsquo;s attributes.</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we save it. At this point it has been added to the database, and the rest of the test involves us ensuring it has been saved correctly and can be retrieved.</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we use the Django database API to fetch all of the Post objects, assert that there is only 1 post object, retrieve that post object, and assert that it is the same object as the post object we just saved.</p>

<p>If unit testing is new to you, assertions may be new to you. Essentially you&rsquo;re saying to the Python interpreter, &ldquo;I assert that X is true, so please raise an error if this is not true&rdquo;. Here we assert that the length of the variable <code>all_posts</code> is 1, and that that post is the same object as the previously saved object, so that the test will fail if that is not the case.</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>        <span class="c"># Check attributes</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we assert that the values of each of the post&rsquo;s attributes as stored in the database match up with those in the post object we set. For the <code>title</code> and <code>text</code> fields, these are easy to validate as we can just check the values against those we set. For the <code>pub_date</code> field, things are a bit more complex, since this will be an object in its own right, so you need to check the day, month, year, hour, minute and second attributes separately.</p>

<p>The whole thing should look like this:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your tests here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">PostTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Set the attributes</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check attributes</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that in place, the time has come to run our test with the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py <span class="nb">test</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should see something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="nv">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: blogengine.tests <span class="o">(</span>unittest.loader.ModuleImportFailure<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>ImportError: Failed to import <span class="nb">test </span>module: blogengine.tests
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 254, in _find_tests
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> self._get_module_from_name<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 232, in _get_module_from_name
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 3, in &lt;module&gt;
</span><span class='line'>    from blogengine.models import Post
</span><span class='line'>ImportError: cannot import name Post
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.000s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t worry about the error - this is exactly what we expect to see because we haven&rsquo;t implemented our Post model yet. Now that we have a failing test in place, we can implement our model to make the test pass. Open up <code>blogengine/models.py</code> and enter the following:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Save the file and run the test again:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="n">Smith</span><span class="p">:</span><span class="n">django_tutorial_blog_ng</span> <span class="n">matthewdaly</span><span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span>
</span><span class='line'><span class="n">Creating</span> <span class="n">test</span> <span class="n">database</span> <span class="k">for</span> <span class="n">alias</span> <span class="s">&#39;default&#39;</span><span class="o">...</span>
</span><span class='line'><span class="n">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'><span class="n">ERROR</span><span class="p">:</span> <span class="n">test_create_post</span> <span class="p">(</span><span class="n">blogengine</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">PostTest</span><span class="p">)</span>
</span><span class='line'><span class="o">----------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">17</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_create_post</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">545</span><span class="p">,</span> <span class="ow">in</span> <span class="n">save</span>
</span><span class='line'>    <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span> <span class="n">update_fields</span><span class="o">=</span><span class="n">update_fields</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">573</span><span class="p">,</span> <span class="ow">in</span> <span class="n">save_base</span>
</span><span class='line'>    <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_table</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">force_insert</span><span class="p">,</span> <span class="n">force_update</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">update_fields</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">654</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_save_table</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_insert</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_base_manager</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">update_pk</span><span class="p">,</span> <span class="n">raw</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">687</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_do_insert</span>
</span><span class='line'>    <span class="n">using</span><span class="o">=</span><span class="n">using</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">232</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_insert</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">insert_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1511</span><span class="p">,</span> <span class="ow">in</span> <span class="n">insert_query</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">get_compiler</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="n">using</span><span class="p">)</span><span class="o">.</span><span class="n">execute_sql</span><span class="p">(</span><span class="n">return_id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">898</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute_sql</span>
</span><span class='line'>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">53</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">99</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__exit__</span>
</span><span class='line'>    <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">dj_exc_type</span><span class="p">,</span> <span class="n">dj_exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">53</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">450</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">Database</span><span class="o">.</span><span class="n">Cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span class='line'><span class="n">OperationalError</span><span class="p">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">table</span><span class="p">:</span> <span class="n">blogengine_post</span>
</span><span class='line'>
</span><span class='line'><span class="o">----------------------------------------------------------------------</span>
</span><span class='line'><span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="ow">in</span> <span class="mf">0.059</span><span class="n">s</span>
</span><span class='line'>
</span><span class='line'><span class="n">FAILED</span> <span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">Destroying</span> <span class="n">test</span> <span class="n">database</span> <span class="k">for</span> <span class="n">alias</span> <span class="s">&#39;default&#39;</span><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our test still fails, but if we take a look at this error message, we can see why - there is no database table for the posts (called <code>blogengine_post</code>). Using South, we can easily remedy that by creating a new migration to create this table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span></code></pre></td></tr></table></div></figure>


<p>That creates the new migration. Now let&rsquo;s run it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s run our tests to check it&rsquo;s working as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.001s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Success! We now have a model in place that passes our test. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Added post model with passing test&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, Django&rsquo;s ORM is basically a layer on top of SQL that abstracts away differences between different relational databases, but the underlying queries are still being run. You can view the SQL created to generate the table by using the <code>sqlall</code> command. Just run <code>python manage.py sqlall blogengine</code> and you should see something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">BEGIN</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;blogengine_post&quot;</span> <span class="p">(</span>
</span><span class='line'>    <span class="ss">&quot;id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;title&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;pub_date&quot;</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">&quot;text&quot;</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">COMMIT</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note the addition of the <code>id</code> field as the primary key. If you&rsquo;re at all familiar with relational databases, you&rsquo;ll know that every table must have one field, called a primary key, that is a unique reference to that row. This can be overridden, but here it&rsquo;s exactly the behaviour we want.</p>

<h2>Creating blog posts via the admin</h2>

<p>Now, we need a way to be able to create, edit and delete blog posts. Django&rsquo;s admin interface allows us to do so easily. However, before we do so, we want to create automated acceptance tests for this functionality, in order to test the ability to create posts from an end-user&rsquo;s perspective. While unit tests are for testing sections of an application&rsquo;s functionality from the perspective of other sections of the application, acceptance tests are testing from the user&rsquo;s perspective. In other words, they test what the application needs to do to be acceptable.</p>

<p>First, we will test logging into the admin. Open up <code>blogengine/tests.py</code> and amend it as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">LiveServerTestCase</span><span class="p">,</span> <span class="n">Client</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your tests here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">PostTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Set the attributes</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check attributes</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create client</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>First of all, we import two new objects from <code>django.test</code>, <code>LiveServerTestCase</code> and <code>Client</code>. Then we create the first part of our first test for the admin, named <code>AdminTest</code>. Eventually, this will test that we can log successfully into the admin interface. For now, we&rsquo;re just doing the following:</p>

<ul>
<li>Creating a Client object</li>
<li>Fetching the <code>/admin/</code> route</li>
<li>Asserting that the status code for this HTTP request is 200, (in other words, that the page was fetched successfully).</li>
</ul>


<p>If you run <code>python manage.py test</code>, you should see that both tests pass successfully. Now we&rsquo;ll extend <code>AdminTest</code> - we&rsquo;ll verify that the response contains the string &lsquo;Log in&rsquo;, which in the Django admin interface, appears on the login page:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create client</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here <code>response.content</code> is a string containing the content of the HTTP response - we&rsquo;re asserting that the substring &lsquo;Log in&rsquo; appears in there. If you run <code>python manage.py test</code> again, it should pass.</p>

<p>Now, we need to actually log in. This could be fiddly, but Django has a handy convenience method to log you in when testing:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create client</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, we use the <code>login</code> method of the <code>Client</code> object to log into the admin interface, and then we fetch the <code>/admin/</code> route again. We assert that we get a 200 status code, and we assert that the response contains the string &lsquo;Log out&rsquo; - in other words, that we are logged in.</p>

<p>Try running <code>python manage.py test</code> and we&rsquo;ll get an error., because the user details we&rsquo;ve used to log in don&rsquo;t exist. Let&rsquo;s resolve that.</p>

<p>Now, you could put your own credentials in there, but that&rsquo;s not a good idea because it&rsquo;s a security risk. Instead, we&rsquo;ll create a fixture for the test user that will be loaded when the tests are run. Run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py createsuperuser
</span></code></pre></td></tr></table></div></figure>


<p>Give the username as <code>bobsmith</code>, the email address as <code>bob@example.com</code>, and the password as <code>password</code>. Once that&rsquo;s done, run these commands to dump the existing users to a fixture:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir blogengine/fixtures
</span><span class='line'>python manage.py dumpdata auth.User --indent<span class="o">=</span><span class="m">2</span> &gt; blogengine/fixtures/users.json
</span></code></pre></td></tr></table></div></figure>


<p>This will dump all of the existing users to <code>blogengine/fixtures/users.json</code>. You may wish to edit this file to remove your own superuser account and leave only the newly created one in there.</p>

<p>Next we need to amend our test to load this fixture:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create client</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you run <code>python manage.py test</code>, you should find that the test passes. Next, we&rsquo;ll test that we can log out:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create client</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create client</span>
</span><span class='line'>        <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log out</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This test works along very similar lines. We log in, verify that &lsquo;Log out&rsquo; is in the response, then we log out, and verify that &lsquo;Log in&rsquo; is in the response. Run the tests again, and they should pass. Assuming they do, let&rsquo;s commit our changes again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Added tests for admin auth&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code is a little repetitive. We create the client twice, when we could do so only once. Amend the AdminTest class as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log out</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>setUp()</code> method is automatically run when the test runs, and ensures we only need to start up the client once. Run your tests to make sure they pass, then commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Refactored admin test&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we&rsquo;ll implement a test for creating a new post. The admin interface implements URLs for creating new instances of a model in a consistent format of <code>/admin/app_name/model_name/add/</code>, so the URL for adding a new post will be <code>/admin/blogengine/post/add/</code>.</p>

<p>Add this method to the AdminTest class:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Try running it and this will fail, because we haven&rsquo;t registered the Post model in the Django admin. So we need to do that. To do so, open a new file at <code>blogengine/admin.py</code> and add the following code:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, run <code>python manage.py test</code> and the test should pass. If you want to confirm that the post model appears in the admin, run <code>python manage.py runserver</code> and click <a href="http://127.0.0.1:8000/admin/">here</a>.</p>

<p>So now we can reach the page for adding a post, but we haven&rsquo;t yet tested that we can submit one. Let&rsquo;s remedy that:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post now in database</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we submit the new post via HTTP POST, with all the data passed through. This mirrors the form created by the Django admin interface - if you take a look at the HTML generated by the admin, you&rsquo;ll see that the inputs are given names that match these. Note that the <code>pub_date</code> field, because it represents a datetime object, is split up into a separate date and time field. Also note the parameter <code>follow=True</code> - this denotes that the test client should follow any HTTP redirect.</p>

<p>We confirm that the POST request responded with a 200 code, denoting success. We also confirm that the response included the phrase &lsquo;added successfully&rsquo;. Finally we confirm that there is now a single Post object in the database. Don&rsquo;t worry about any existing content - Django creates a dedicated test database and destroys it after the tests are done, so you can be sure that no posts are present unless you explicitly load them from a fixture.</p>

<p>We can now test creating a post, but we also need to ensure we can test editing and deleting them. First we&rsquo;ll add a test for editing posts:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post amended</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we create a new blog post, then verify we can edit it by resubmitting it with different values, and checking that we get the expected response, and that the data in the database has been updated. Run <code>python manage.py test</code>, and this should pass.</p>

<p>Finally, we&rsquo;ll set up a test for deleting posts:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post amended</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, this is pretty similar to what we did before. We create a new post, verify that it is the sole post in the database, and log into the admin. Then we delete the post via the admin, and confirm that the admin interface confirmed it has been deleted, and the post is gone from the database.</p>

<p>I think it&rsquo;s now time to commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Post admin tests in place&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we now know that we can create, edit and delete posts, and we have tests in place to confirm this. So our next task is to be able to display our posts.</p>

<p>For now, to keep things simple, we&rsquo;re only going to implement the index view - in other words, all the posts in reverse chronological order. We&rsquo;ll use Django&rsquo;s generic views to keep things really easy.</p>

<p>Django&rsquo;s generic views are another really handy feature. As mentioned earlier, a view is a function or class that describes how a specific route should render an object. Now, there are many tasks that recur in web development. For instance, many web pages you may have seen may be a list of objects - in this case, the index page for a blog is a list of blog posts. For that reason, Django has the ListView generic view, which makes it easy to render a list of objects.</p>

<p>Now, like before, we want to have a test in place. Open up <code>blogengine/tests.py</code> and add the following class at the end of the file:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we create the post, and assert that it is the sole post object. We then fetch the index page, and assert that the HTTP status code is 200 (ie. the page exists and is returned). We then verify that the response contains the post title, text and publication date.</p>

<p>Note that for the month, we need to do a bit of jiggery-pokery to get the month name. By default Django will return short month names (eg Jan, Feb etc), but Python stores months as numbers, so we need to format it as a short month name using <code>%b</code>.</p>

<p>If you run this, you will get an error because the index route isn&rsquo;t implemented. So let&rsquo;s fix that. Open up the existing <code>django_tutorial_blog_ng/urls.py</code> file and amend it to look like this:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Examples:</span>
</span><span class='line'>    <span class="c"># url(r&#39;^$&#39;, &#39;django_tutorial_blog_ng.views.home&#39;, name=&#39;home&#39;),</span>
</span><span class='line'>    <span class="c"># url(r&#39;^blog/&#39;, include(&#39;blog.urls&#39;)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Blog URLs</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^.*$&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;blogengine.urls&#39;</span><span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, create a new file at <code>blogengine/urls.py</code> and edit it as follows:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">&#39;^$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>A little explanation is called for. The project has its own <code>urls.py</code> file that handles routing throughout the project. However, because Django encourages you to make your apps reusable, we want to keep the routes in the individual apps as far as possible. So, in the project file, we include the <code>blogengine/urls.py</code> file.</p>

<p>In the app-specific <code>urls.py</code>, we import the Post model and the ListView generic view. We then define a route for the index page - the regular expression <code>^$</code> will match only an empty string, so that page will be the index. For this route, we then call the <code>as_view()</code> method of the ListView object, and set the model as Post.</p>

<p>Now, if you either run the tests, or run the development server and visit <a href="http://127.0.0.1:8000">the index page</a>, you&rsquo;ll see that it isn&rsquo;t working yet - you should see the error <code>TemplateDoesNotExist: blogengine/post_list.html</code>. This tells us that we need to create a template called <code>blogengine/post_list.html</code>, so let&rsquo;s do that. First of all, add the following at the end of <code>django_tutorial_blog_ng/settings.py</code>:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Template directory</span>
</span><span class='line'><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;templates&#39;</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, create the folders for the templates, and a blank <code>post_list.html</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir templates
</span><span class='line'>mkdir templates/blogengine
</span><span class='line'>touch templates/blogengine/post_list.html
</span></code></pre></td></tr></table></div></figure>


<p>Now, run your tests again, and you&rsquo;ll see that the template now exists, but a new error is showing up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>......F
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 189, in test_index
</span><span class='line'>    self.assertTrue<span class="o">(</span>post.title in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">7</span> tests in 2.162s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>To fix this, we make sure the template shows the data we want. Open up <code>templates/blogengine/post_list.html</code> and enter the following:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>My Django Blog<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text }}
</span><span class='line'>        {% endfor %}
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is only a very basic template, and we&rsquo;ll expand upon it in future.</p>

<p>With that done, you can run <code>python manage.py test</code>, and it should pass. Well done! Don&rsquo;t forget to commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/ templates/ blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented list view for posts&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s all for this lesson! We&rsquo;ve done a hell of a lot in this lesson - set up our project, created a comprehensive test suite for it, and implemented the basic functionality. Next time we&rsquo;ll make it a bit prettier using Twitter Bootstrap, as well as implementing more of the basic functionality for the blog.</p>

<p>You can find the source code <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">on Github</a>. For your convenience, I&rsquo;ve tagged this lesson as <code>lesson-1</code>, so you can just clone the repository and switch to the end of this lesson with the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/matthewbdaly/django_tutorial_blog_ng.git
</span><span class='line'><span class="nb">cd </span>django_tutorial_blog_ng
</span><span class='line'>git checkout lesson-1
</span></code></pre></td></tr></table></div></figure>


<p>That way, you can easily check that what you&rsquo;ve done matches up with the repository. Future lessons will be similarly tagged to make them easy to navigate.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/16/a-starting-boilerplate-for-php-development-with-vagrant/">A Starting Boilerplate for PHP Development With Vagrant</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-16T21:49:00+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:49 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve recently started using <a href="http://www.vagrantup.com/">Vagrant</a> for PHP development. It&rsquo;s an incredibly useful and convenient tool - never again will I have to faff about installing XAMPP on someone&rsquo;s laptop so they can demonstrate the new site, instead I can just install Vagrant and Virtualbox, clone the repository, and run <code>vagrant up</code>, and nip off and make a cuppa, safe in the knowledge that when I get back the install will be, if not done, then at least in progress. Also, it means it&rsquo;s easy to run the same OS for development and production.</p>

<p>I&rsquo;ve used <a href="https://puphpet.com/">PuPHPet</a> a bit, but I&rsquo;ve found Puppet to be a little complex for what I wanted, so I switched to using the shell provisioner instead. As a starting point for future projects, I&rsquo;ve thrown together a basic Vagrant configuration based on that provided by PuPHPet, that includes the following:</p>

<ul>
<li>A full LAMP stack, running on Ubuntu 12.04</li>
<li>APC</li>
<li>PHPMyAdmin</li>
<li>Git</li>
<li>A blank SQL file - this is automatically run on <code>vagrant up</code>, so you can place any commands needed to set up your database in here.</li>
<li>msmtp - just amend the username and password in bootstrap.sh to point to a Gmail account and your web app should be able to send emails via that account quickly and easily</li>
</ul>


<p>It&rsquo;s available <a href="https://github.com/matthewbdaly/vagrant-php-dev-boilerplate">here</a>, and if you haven&rsquo;t discovered the benefits of Vagrant yet, it would be a good place to start.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/28/first-steps-with-node-dot-js/">First Steps With Node.js</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-28T19:20:00+01:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:20 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The idea of building an entire web app using nothing but JavaScript has always appealed to me. Despite its undoubted flaws, JavaScript is a powerful language, and chopping and changing between several different programming languages is never great. So I&rsquo;ve always wanted to check out Node.js.</p>

<p>Lately I&rsquo;ve been tinkering with Backbone.js a lot. As a web and mobile app developer, I&rsquo;ve seen the benefit of server-side MVC frameworks firsthand, and I&rsquo;ve also seen how bad a PhoneGap app can get without this kind of structure, so I&rsquo;ve been very eager for a while to get my head around a JavaScript framework. The first one I was able to really grok was Knockout.js, thanks to its wonderful tutorial, but Backbone.js seemed to have better mindshare, and support for routing, so I knuckled down and used it for a large personal project that is still under wraps, but I hope to make available once complete. Using Backbone has made my client-side code far more organised, and I plan to use it a lot in future.</p>

<p>I&rsquo;ve also wanted to get my head around a couple of the NoSQL databases. While the relational model is very often applicable, there are plenty of use cases where it isn&rsquo;t the best choice, especially for simple data, and MongoDB seemed to be an interesting alternative. So, I decided to have a tinker around with Node.js and Backbone today, and wound up building <a href="https://github.com/matthewbdaly/rabbitrabbitrabbit">a real-time guestbook application</a>. Let me know what you think, but please be gentle - this is my first ever Node.js or MongoDB application.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/21/my-first-jquery-plugin/">My First jQuery Plugin</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-04-21T22:06:00+01:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>10:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In my day job, I recently finished <a href="https://www.pagepooch.com/">PagePooch</a>, a tool for monitoring web pages for changes in content or prices. It&rsquo;s a project that I&rsquo;m immensely proud of, because it was my first big and largely solo project as a developer.</p>

<p>During the development of this, I initially created the user interface with jQuery Mobile, but later on added a desktop interface as well. During development of the desktop interface, I needed to recreate the functionality of the filter available for listviews in jQuery Mobile, and wound up creating a plugin for jQuery to do so.</p>

<p>I recently got permission to open-source this, as I figured the functionality was trivial enough that we couldn&rsquo;t reasonably sell it, but by making it freely available, we&rsquo;d maybe get some goodwill, and if we were really lucky, a few bugfixes and/or improvements.</p>

<p>It&rsquo;s <a href="http://plugins.jquery.com/listfilter/">now available</a> via the jQuery plugin registry. Please let me know what you think, and feel free to fork it and hack on it as you see fit.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/15/running-the-php-development-server-with-laravel/">Running the PHP Development Server With Laravel</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-12-15T00:26:00+00:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:26 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One thing that I&rsquo;ve really never liked about PHP is the requirement to install a full-blown web server, so I was pleased when PHP 5.4 shipped with a built-in development server. However, it seems like no PHP framework has yet embraced this to the extent that their counterparts for languages like Python have.</p>

<p>I&rsquo;ve recently decided that CodeIgniter is no longer fulfilling what I need from my main go-to PHP framework, and I&rsquo;ve been looking at Laravel as a likely replacement. It occurred to me that I could create an Artisan task to run the development server quite easily, and after a little tinkering, I put this together, which worked well:</p>

<figure class='code'><figcaption><span>application/tasks/runserver.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Runserver_Task</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$port</span> <span class="o">=</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">?</span> <span class="mi">8000</span><span class="o">:</span> <span class="nv">$arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;Running PHP development server on port &#39;</span><span class="o">.</span><span class="nv">$port</span><span class="o">.</span><span class="s1">&#39;...&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nb">passthru</span><span class="p">(</span><span class="s1">&#39;php -S localhost:&#39;</span><span class="o">.</span><span class="nv">$port</span><span class="o">.</span><span class="s1">&#39; -t &#39;</span><span class="o">.</span><span class="nb">getcwd</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/public&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Once this is in place, you can just run <code>php artisan runserver</code> to run the development server, and hit Ctrl-C to stop it, giving you an experience much like that with Django. Note this requires PHP 5.4 or greater. You also have the option of specifying a different port eg <code>php artisan runserver 7000</code> for port 7000.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/31/building-a-chat-server-with-node-dot-js-and-redis/">Building a Chat Server With Node.js and Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/28/my-first-grunt-plugin/">My First Grunt Plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/">Building a URL Shortener With Node.js and Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/19/my-django-web-server-setup/">My Django Web Server Setup</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/05/introducing-generator-simple-static-blog/">Introducing Generator-simple-static-blog</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/matthewbdaly">@matthewbdaly</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'matthewbdaly',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Matthew Daly -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'matthewdaly';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
