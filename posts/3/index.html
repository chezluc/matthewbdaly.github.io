<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0"><meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog..."><link href="/favicon.ico" rel="icon"><link href="http://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet" type="text/css"><link rel="stylesheet" type="text/css" href="/static/bower_components/sass-bootstrap/dist/css/bootstrap.min.css" media="all"><link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><title>Matthew Daly&#x27;s Blog</title></head><body><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script><header><div class="container headercontainer"><div class="jumbotron"><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></div></div><div class="container headercontainer"><nav class="navbar navbar-inverse navbar-static-top"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#header-nav"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="header-nav"><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href="/blog/archives/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="/rss.xml">RSS</a></li></ul><form action="http://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded" class="navbar-form navbar-right"><div class="form-group"><input id="search" type="search" name="q" placeholder="Search..." maxlength="200" class="form-control"><ul class="searchresults"></ul></div></form></div></div></nav></div></header><div class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">5th October 2014 7:56 pm</p><h1><a href="/blog/2014/10/05/introducing-generator-simple-static-blog/">Introducing Generator-simple-static-blog</a></h1><p>I’m a big fan of static site generators. I ditched WordPress for Octopress over two years ago because it was free to host on GitHub Pages and much faster, had much better syntax highlighting, and I liked being able to write posts in Vim, and I’ve never looked back since.</p><p>That said, Octopress is written in Ruby, a language I’ve never been that keen on. Ideally I’d prefer to use Python or JavaScript, but none of the solutions I’ve found have been to my liking. Recently I’ve been using Grunt and Yeoman to some extent, and I’ve wondered about the idea of creating a Yeoman generator to build a static blogging engine. After discovering <code>grunt-markdown-blog</code>, I took the plunge and have built a simple blog generator called <a href="https://github.com/matthewbdaly/generator-simple-static-blog">generator-simple-static-blog</a>.</p><p>I’ve published it to NPM, so feel free to check it out. It includes code highlighting with the Zenburn colour scheme by default (although highlight.js includes many other themes, so just switch to another one if you want), and it should be easy to edit the templates. I’ve also included the ability to deploy automatically to GitHub Pages using Grunt.</p><p>I don’t anticipate moving over to this from Octopress for the foreseeable future, but it’s been an interesting project for the weekend.</p></article><article class="post"><p class="date">28th September 2014 8:51 pm</p><h1><a href="/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/">Django Blog Tutorial - the Next Generation - Part 9</a></h1><p>Yes, I know the eight instalment was meant to be the last one! Within 24 hours of that post going live, Django 1.7 was released, so naturally I’d like to show you how to upgrade to it.</p><p>The biggest change is that Django 1.7 introduces its own migration system, which means South is now surplus to requirements. We therefore need to switch from South to Django’s native migrations. Fortunately, this is fairly straightforward.</p><p>First of all, activate your virtualenv:</p><pre><code class="hljs lang-bash singleline">$ virtualenv venv</code></pre><p>Then make sure your migrations are up to date:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py syncdb
<span class="linenos">2</span>$ python manage.py migrate</code></pre><p>Then, upgrade your Django version and uninstall South:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ pip install Django --upgrade
<span class="linenos">2</span>$ pip uninstall South
<span class="linenos">3</span>$ pip freeze &gt; requirements.txt</code></pre><p>Next, remove South from <code>INSTALLED_APPS</code> in <code>django_tutorial_blog_ng/settings.py</code>.</p><p>You now need to delete all of the numbered migration files in <code>blogengine/migrations/</code>, and the relevant <code>.pyc</code> files, but NOT the directory or the <code>__init__.py</code> file. You can do so with this command on Linux or OS X:</p><pre><code class="hljs lang-bash singleline">$ rm blogengine/migrations/<span class="hljs-number">00</span>*</code></pre><p>Next, we recreate our migrations with the following command:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py makemigrations
<span class="linenos">2</span>Migrations <span class="hljs-keyword">for</span> <span class="hljs-string">'blogengine'</span>:
<span class="linenos">3</span>  <span class="hljs-number">0001</span>_initial.py:
<span class="linenos">4</span>    - Create model Category
<span class="linenos">5</span>    - Create model Post
<span class="linenos">6</span>    - Create model Tag
<span class="linenos">7</span>    - Add field tags to post</code></pre><p>Then we run the migrations:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py migrate
<span class="linenos">2</span>Operations to perform:
<span class="linenos">3</span>  Synchronize unmigrated apps: sitemaps, django_jenkins, debug_toolbar
<span class="linenos">4</span>  Apply all migrations: sessions, admin, sites, flatpages, contenttypes, auth, blogengine
<span class="linenos">5</span>Synchronizing apps without migrations:
<span class="linenos">6</span>  Creating tables...
<span class="linenos">7</span>  Installing custom SQL...
<span class="linenos">8</span>  Installing indexes...
<span class="linenos">9</span>Running migrations:
<span class="linenos">10</span>  Applying contenttypes.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">11</span>  Applying auth.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">12</span>  Applying admin.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">13</span>  Applying sites.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">14</span>  Applying blogengine.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">15</span>  Applying flatpages.<span class="hljs-number">0001</span>_initial... FAKED
<span class="linenos">16</span>  Applying sessions.<span class="hljs-number">0001</span>_initial... FAKED</code></pre><p>Don’t worry too much if the output doesn’t look exactly the same as this - as long as it works, that’s the main thing.</p><p>Let’s run our test suite to ensure it works:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>....FF.F.FFFFFF..............
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">385</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
<span class="linenos">9</span>    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">10</span>AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">11</span>
<span class="linenos">12</span>======================================================================
<span class="linenos">13</span>FAIL: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
<span class="linenos">14</span>----------------------------------------------------------------------
<span class="linenos">15</span>Traceback (most recent call last):
<span class="linenos">16</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">417</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
<span class="linenos">17</span>    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">18</span>AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">19</span>
<span class="linenos">20</span>======================================================================
<span class="linenos">21</span>FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
<span class="linenos">22</span>----------------------------------------------------------------------
<span class="linenos">23</span>Traceback (most recent call last):
<span class="linenos">24</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">278</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
<span class="linenos">25</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">26</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">27</span>
<span class="linenos">28</span>======================================================================
<span class="linenos">29</span>FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
<span class="linenos">30</span>----------------------------------------------------------------------
<span class="linenos">31</span>Traceback (most recent call last):
<span class="linenos">32</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">346</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
<span class="linenos">33</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">34</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">35</span>
<span class="linenos">36</span>======================================================================
<span class="linenos">37</span>FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
<span class="linenos">38</span>----------------------------------------------------------------------
<span class="linenos">39</span>Traceback (most recent call last):
<span class="linenos">40</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">255</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
<span class="linenos">41</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">42</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">43</span>
<span class="linenos">44</span>======================================================================
<span class="linenos">45</span>FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
<span class="linenos">46</span>----------------------------------------------------------------------
<span class="linenos">47</span>Traceback (most recent call last):
<span class="linenos">48</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">447</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
<span class="linenos">49</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">50</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">51</span>
<span class="linenos">52</span>======================================================================
<span class="linenos">53</span>FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
<span class="linenos">54</span>----------------------------------------------------------------------
<span class="linenos">55</span>Traceback (most recent call last):
<span class="linenos">56</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">323</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
<span class="linenos">57</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">58</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">59</span>
<span class="linenos">60</span>======================================================================
<span class="linenos">61</span>FAIL: <span class="hljs-built_in">test</span>_login (blogengine.tests.AdminTest)
<span class="linenos">62</span>----------------------------------------------------------------------
<span class="linenos">63</span>Traceback (most recent call last):
<span class="linenos">64</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">183</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_login
<span class="linenos">65</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">66</span>AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">67</span>
<span class="linenos">68</span>======================================================================
<span class="linenos">69</span>FAIL: <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span> (blogengine.tests.AdminTest)
<span class="linenos">70</span>----------------------------------------------------------------------
<span class="linenos">71</span>Traceback (most recent call last):
<span class="linenos">72</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">214</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span>
<span class="linenos">73</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">74</span>AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">75</span>
<span class="linenos">76</span>----------------------------------------------------------------------
<span class="linenos">77</span>Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.383</span>s
<span class="linenos">78</span>
<span class="linenos">79</span>FAILED (failures=<span class="hljs-number">9</span>)
<span class="linenos">80</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>We have an issue here. A load of the tests for the admin interface now fail. If we now try running the dev server, we see this error:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py runserver
<span class="linenos">2</span>Performing system checks...
<span class="linenos">3</span>
<span class="linenos">4</span>System check identified no issues (<span class="hljs-number">0</span> silenced).
<span class="linenos">5</span>September <span class="hljs-number">28</span>, <span class="hljs-number">2014</span> - <span class="hljs-number">20</span>:<span class="hljs-number">16</span>:<span class="hljs-number">47</span>
<span class="linenos">6</span>Django version <span class="hljs-number">1.7</span>, using settings <span class="hljs-string">'django_tutorial_blog_ng.settings'</span>
<span class="linenos">7</span>Starting development server at http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span>/
<span class="linenos">8</span>Quit the server with CONTROL-C.
<span class="linenos">9</span>Unhandled exception <span class="hljs-keyword">in</span> thread started by &lt;<span class="hljs-keyword">function</span> wrapper at <span class="hljs-number">0</span>x1024a5ed8&gt;
<span class="linenos">10</span>Traceback (most recent call last):
<span class="linenos">11</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/autoreload.py"</span>, line <span class="hljs-number">222</span>, <span class="hljs-keyword">in</span> wrapper
<span class="linenos">12</span>    fn(*args, **kwargs)
<span class="linenos">13</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="hljs-number">132</span>, <span class="hljs-keyword">in</span> inner_run
<span class="linenos">14</span>    handler = self.get_handler(*args, **options)
<span class="linenos">15</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/staticfiles/management/commands/runserver.py"</span>, line <span class="hljs-number">25</span>, <span class="hljs-keyword">in</span> get_handler
<span class="linenos">16</span>    handler = super(Command, self).get_handler(*args, **options)
<span class="linenos">17</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="hljs-number">48</span>, <span class="hljs-keyword">in</span> get_handler
<span class="linenos">18</span>    <span class="hljs-built_in">return</span> get_internal_wsgi_application()
<span class="linenos">19</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py"</span>, line <span class="hljs-number">66</span>, <span class="hljs-keyword">in</span> get_internal_wsgi_application
<span class="linenos">20</span>    sys.exc_info()[<span class="hljs-number">2</span>])
<span class="linenos">21</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py"</span>, line <span class="hljs-number">56</span>, <span class="hljs-keyword">in</span> get_internal_wsgi_application
<span class="linenos">22</span>    <span class="hljs-built_in">return</span> import_string(app_path)
<span class="linenos">23</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/module_loading.py"</span>, line <span class="hljs-number">26</span>, <span class="hljs-keyword">in</span> import_string
<span class="linenos">24</span>    module = import_module(module_path)
<span class="linenos">25</span>  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.8_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/importlib/__init__.py"</span>, line <span class="hljs-number">37</span>, <span class="hljs-keyword">in</span> import_module
<span class="linenos">26</span>    __import__(name)
<span class="linenos">27</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/django_tutorial_blog_ng/wsgi.py"</span>, line <span class="hljs-number">14</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
<span class="linenos">28</span>    from dj_static import Cling
<span class="linenos">29</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/dj_static.py"</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
<span class="linenos">30</span>    from django.core.handlers.base import get_path_info
<span class="linenos">31</span>django.core.exceptions.ImproperlyConfigured: WSGI application <span class="hljs-string">'django_tutorial_blog_ng.wsgi.application'</span> could not be loaded; Error importing module: <span class="hljs-string">'cannot import name get_path_info'</span></code></pre><p>Fortunately, the error above is easy to fix by upgrading <code>dj_static</code>:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ pip install dj_static --upgrade
<span class="linenos">2</span>$ pip freeze &gt; requirements.txt</code></pre><p>That resolves the error in serving static files, but not the error with the admin. If you run the dev server, you’ll be able to see that the admin actually works fine. The problem is caused by the test client not following redirects in the admin. We can easily run just the admin tests with the following command:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine.tests.AdminTest
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.FF.F.FFFFFF
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">385</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
<span class="linenos">9</span>    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">10</span>AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">11</span>
<span class="linenos">12</span>======================================================================
<span class="linenos">13</span>FAIL: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
<span class="linenos">14</span>----------------------------------------------------------------------
<span class="linenos">15</span>Traceback (most recent call last):
<span class="linenos">16</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">417</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
<span class="linenos">17</span>    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">18</span>AssertionError: False is not <span class="hljs-literal">true</span>
<span class="linenos">19</span>
<span class="linenos">20</span>======================================================================
<span class="linenos">21</span>FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
<span class="linenos">22</span>----------------------------------------------------------------------
<span class="linenos">23</span>Traceback (most recent call last):
<span class="linenos">24</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">278</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
<span class="linenos">25</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">26</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">27</span>
<span class="linenos">28</span>======================================================================
<span class="linenos">29</span>FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
<span class="linenos">30</span>----------------------------------------------------------------------
<span class="linenos">31</span>Traceback (most recent call last):
<span class="linenos">32</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">346</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
<span class="linenos">33</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">34</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">35</span>
<span class="linenos">36</span>======================================================================
<span class="linenos">37</span>FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
<span class="linenos">38</span>----------------------------------------------------------------------
<span class="linenos">39</span>Traceback (most recent call last):
<span class="linenos">40</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">255</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
<span class="linenos">41</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">42</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">43</span>
<span class="linenos">44</span>======================================================================
<span class="linenos">45</span>FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
<span class="linenos">46</span>----------------------------------------------------------------------
<span class="linenos">47</span>Traceback (most recent call last):
<span class="linenos">48</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">447</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
<span class="linenos">49</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">50</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">51</span>
<span class="linenos">52</span>======================================================================
<span class="linenos">53</span>FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
<span class="linenos">54</span>----------------------------------------------------------------------
<span class="linenos">55</span>Traceback (most recent call last):
<span class="linenos">56</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">323</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
<span class="linenos">57</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">58</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">59</span>
<span class="linenos">60</span>======================================================================
<span class="linenos">61</span>FAIL: <span class="hljs-built_in">test</span>_login (blogengine.tests.AdminTest)
<span class="linenos">62</span>----------------------------------------------------------------------
<span class="linenos">63</span>Traceback (most recent call last):
<span class="linenos">64</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">183</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_login
<span class="linenos">65</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">66</span>AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">67</span>
<span class="linenos">68</span>======================================================================
<span class="linenos">69</span>FAIL: <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span> (blogengine.tests.AdminTest)
<span class="linenos">70</span>----------------------------------------------------------------------
<span class="linenos">71</span>Traceback (most recent call last):
<span class="linenos">72</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">214</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_<span class="hljs-built_in">logout</span>
<span class="linenos">73</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">74</span>AssertionError: <span class="hljs-number">302</span> != <span class="hljs-number">200</span>
<span class="linenos">75</span>
<span class="linenos">76</span>----------------------------------------------------------------------
<span class="linenos">77</span>Ran <span class="hljs-number">12</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.283</span>s
<span class="linenos">78</span>
<span class="linenos">79</span>FAILED (failures=<span class="hljs-number">9</span>)
<span class="linenos">80</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Let’s commit our changes so far first:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add django_tutorial_blog_ng/ requirements.txt blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Upgraded to Django 1.7'</span></code></pre><p>Now let’s fix our tests. Here’s the amended version of the <code>AdminTest</code> class:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
<span class="linenos">2</span>    fixtures = [<span class="hljs-string">'users.json'</span>]
<span class="linenos">3</span>
<span class="linenos">4</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">5</span>        <span class="hljs-comment"># Get login page</span>
<span class="linenos">6</span>        response = self.client.get(<span class="hljs-string">'/admin/'</span>, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">7</span>
<span class="linenos">8</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">9</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="hljs-comment"># Check 'Log in' in response</span>
<span class="linenos">12</span>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="hljs-comment"># Log the user in</span>
<span class="linenos">15</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">16</span>
<span class="linenos">17</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">18</span>        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
<span class="linenos">19</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">20</span>
<span class="linenos">21</span>        <span class="hljs-comment"># Check 'Log out' in response</span>
<span class="linenos">22</span>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">25</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">26</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">27</span>
<span class="linenos">28</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">29</span>        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
<span class="linenos">30</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">31</span>
<span class="linenos">32</span>        <span class="hljs-comment"># Check 'Log out' in response</span>
<span class="linenos">33</span>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">34</span>
<span class="linenos">35</span>        <span class="hljs-comment"># Log out</span>
<span class="linenos">36</span>        self.client.logout()
<span class="linenos">37</span>
<span class="linenos">38</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">39</span>        response = self.client.get(<span class="hljs-string">'/admin/'</span>, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">40</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">41</span>
<span class="linenos">42</span>        <span class="hljs-comment"># Check 'Log in' in response</span>
<span class="linenos">43</span>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">46</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">47</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">48</span>
<span class="linenos">49</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">50</span>        response = self.client.get(<span class="hljs-string">'/admin/blogengine/category/add/'</span>)
<span class="linenos">51</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">52</span>
<span class="linenos">53</span>        <span class="hljs-comment"># Create the new category</span>
<span class="linenos">54</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/add/'</span>, {
<span class="linenos">55</span>            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
<span class="linenos">56</span>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">57</span>            },
<span class="linenos">58</span>            follow=<span class="hljs-keyword">True</span>
<span class="linenos">59</span>        )
<span class="linenos">60</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">61</span>
<span class="linenos">62</span>        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">63</span>        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">64</span>
<span class="linenos">65</span>        <span class="hljs-comment"># Check new category now in database</span>
<span class="linenos">66</span>        all_categories = Category.objects.all()
<span class="linenos">67</span>        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
<span class="linenos">68</span>
<span class="linenos">69</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_category</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">70</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">71</span>        category = CategoryFactory()
<span class="linenos">72</span>
<span class="linenos">73</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">74</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">75</span>
<span class="linenos">76</span>        <span class="hljs-comment"># Edit the category</span>
<span class="linenos">77</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/'</span> + str(category.pk) + <span class="hljs-string">'/'</span>, {
<span class="linenos">78</span>            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
<span class="linenos">79</span>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
<span class="linenos">80</span>            }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">81</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">82</span>
<span class="linenos">83</span>        <span class="hljs-comment"># Check changed successfully</span>
<span class="linenos">84</span>        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">85</span>
<span class="linenos">86</span>        <span class="hljs-comment"># Check category amended</span>
<span class="linenos">87</span>        all_categories = Category.objects.all()
<span class="linenos">88</span>        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
<span class="linenos">89</span>        only_category = all_categories[<span class="hljs-number">0</span>]
<span class="linenos">90</span>        self.assertEquals(only_category.name, <span class="hljs-string">'perl'</span>)
<span class="linenos">91</span>        self.assertEquals(only_category.description, <span class="hljs-string">'The Perl programming language'</span>)
<span class="linenos">92</span>
<span class="linenos">93</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_category</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">94</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">95</span>        category = CategoryFactory()
<span class="linenos">96</span>
<span class="linenos">97</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">98</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">99</span>
<span class="linenos">100</span>        <span class="hljs-comment"># Delete the category</span>
<span class="linenos">101</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/'</span> + str(category.pk) + <span class="hljs-string">'/delete/'</span>, {
<span class="linenos">102</span>            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
<span class="linenos">103</span>        }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">104</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">105</span>
<span class="linenos">106</span>        <span class="hljs-comment"># Check deleted successfully</span>
<span class="linenos">107</span>        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">108</span>
<span class="linenos">109</span>        <span class="hljs-comment"># Check category deleted</span>
<span class="linenos">110</span>        all_categories = Category.objects.all()
<span class="linenos">111</span>        self.assertEquals(len(all_categories), <span class="hljs-number">0</span>)
<span class="linenos">112</span>
<span class="linenos">113</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">114</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">115</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">116</span>
<span class="linenos">117</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">118</span>        response = self.client.get(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>)
<span class="linenos">119</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">120</span>
<span class="linenos">121</span>        <span class="hljs-comment"># Create the new tag</span>
<span class="linenos">122</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>, {
<span class="linenos">123</span>            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
<span class="linenos">124</span>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">125</span>            },
<span class="linenos">126</span>            follow=<span class="hljs-keyword">True</span>
<span class="linenos">127</span>        )
<span class="linenos">128</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">129</span>
<span class="linenos">130</span>        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">131</span>        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">132</span>
<span class="linenos">133</span>        <span class="hljs-comment"># Check new tag now in database</span>
<span class="linenos">134</span>        all_tags = Tag.objects.all()
<span class="linenos">135</span>        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
<span class="linenos">136</span>
<span class="linenos">137</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">138</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">139</span>        tag = TagFactory()
<span class="linenos">140</span>
<span class="linenos">141</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">142</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">143</span>
<span class="linenos">144</span>        <span class="hljs-comment"># Edit the tag</span>
<span class="linenos">145</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/'</span> + str(tag.pk) + <span class="hljs-string">'/'</span>, {
<span class="linenos">146</span>            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
<span class="linenos">147</span>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
<span class="linenos">148</span>            }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">149</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">150</span>
<span class="linenos">151</span>        <span class="hljs-comment"># Check changed successfully</span>
<span class="linenos">152</span>        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">153</span>
<span class="linenos">154</span>        <span class="hljs-comment"># Check tag amended</span>
<span class="linenos">155</span>        all_tags = Tag.objects.all()
<span class="linenos">156</span>        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
<span class="linenos">157</span>        only_tag = all_tags[<span class="hljs-number">0</span>]
<span class="linenos">158</span>        self.assertEquals(only_tag.name, <span class="hljs-string">'perl'</span>)
<span class="linenos">159</span>        self.assertEquals(only_tag.description, <span class="hljs-string">'The Perl programming language'</span>)
<span class="linenos">160</span>
<span class="linenos">161</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">162</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">163</span>        tag = TagFactory()
<span class="linenos">164</span>
<span class="linenos">165</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">166</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">167</span>
<span class="linenos">168</span>        <span class="hljs-comment"># Delete the tag</span>
<span class="linenos">169</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/'</span> + str(tag.pk) + <span class="hljs-string">'/delete/'</span>, {
<span class="linenos">170</span>            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
<span class="linenos">171</span>        }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">172</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">173</span>
<span class="linenos">174</span>        <span class="hljs-comment"># Check deleted successfully</span>
<span class="linenos">175</span>        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">176</span>
<span class="linenos">177</span>        <span class="hljs-comment"># Check tag deleted</span>
<span class="linenos">178</span>        all_tags = Tag.objects.all()
<span class="linenos">179</span>        self.assertEquals(len(all_tags), <span class="hljs-number">0</span>)
<span class="linenos">180</span>
<span class="linenos">181</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">182</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">183</span>        category = CategoryFactory()
<span class="linenos">184</span>
<span class="linenos">185</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">186</span>        tag = TagFactory()
<span class="linenos">187</span>
<span class="linenos">188</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">189</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">190</span>
<span class="linenos">191</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">192</span>        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
<span class="linenos">193</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">194</span>
<span class="linenos">195</span>        <span class="hljs-comment"># Create the new post</span>
<span class="linenos">196</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
<span class="linenos">197</span>            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
<span class="linenos">198</span>            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
<span class="linenos">199</span>            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
<span class="linenos">200</span>            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
<span class="linenos">201</span>            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
<span class="linenos">202</span>            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
<span class="linenos">203</span>            <span class="hljs-string">'category'</span>: str(category.pk),
<span class="linenos">204</span>            <span class="hljs-string">'tags'</span>: str(tag.pk)
<span class="linenos">205</span>        },
<span class="linenos">206</span>        follow=<span class="hljs-keyword">True</span>
<span class="linenos">207</span>        )
<span class="linenos">208</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">209</span>
<span class="linenos">210</span>        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">211</span>        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">212</span>
<span class="linenos">213</span>        <span class="hljs-comment"># Check new post now in database</span>
<span class="linenos">214</span>        all_posts = Post.objects.all()
<span class="linenos">215</span>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">216</span>
<span class="linenos">217</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post_without_tag</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">218</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">219</span>        category = CategoryFactory()
<span class="linenos">220</span>
<span class="linenos">221</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">222</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">223</span>
<span class="linenos">224</span>        <span class="hljs-comment"># Check response code</span>
<span class="linenos">225</span>        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
<span class="linenos">226</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">227</span>
<span class="linenos">228</span>        <span class="hljs-comment"># Create the new post</span>
<span class="linenos">229</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
<span class="linenos">230</span>            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
<span class="linenos">231</span>            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
<span class="linenos">232</span>            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
<span class="linenos">233</span>            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
<span class="linenos">234</span>            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
<span class="linenos">235</span>            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
<span class="linenos">236</span>            <span class="hljs-string">'category'</span>: str(category.pk)
<span class="linenos">237</span>        },
<span class="linenos">238</span>        follow=<span class="hljs-keyword">True</span>
<span class="linenos">239</span>        )
<span class="linenos">240</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">241</span>
<span class="linenos">242</span>        <span class="hljs-comment"># Check added successfully</span>
<span class="linenos">243</span>        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">244</span>
<span class="linenos">245</span>        <span class="hljs-comment"># Check new post now in database</span>
<span class="linenos">246</span>        all_posts = Post.objects.all()
<span class="linenos">247</span>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">248</span>
<span class="linenos">249</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">250</span>        <span class="hljs-comment"># Create the post</span>
<span class="linenos">251</span>        post = PostFactory()
<span class="linenos">252</span>
<span class="linenos">253</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">254</span>        category = CategoryFactory()
<span class="linenos">255</span>
<span class="linenos">256</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">257</span>        tag = TagFactory()
<span class="linenos">258</span>        post.tags.add(tag)
<span class="linenos">259</span>
<span class="linenos">260</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">261</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">262</span>
<span class="linenos">263</span>        <span class="hljs-comment"># Edit the post</span>
<span class="linenos">264</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/'</span> + str(post.pk) + <span class="hljs-string">'/'</span>, {
<span class="linenos">265</span>            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
<span class="linenos">266</span>            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
<span class="linenos">267</span>            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
<span class="linenos">268</span>            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
<span class="linenos">269</span>            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
<span class="linenos">270</span>            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
<span class="linenos">271</span>            <span class="hljs-string">'category'</span>: str(category.pk),
<span class="linenos">272</span>            <span class="hljs-string">'tags'</span>: str(tag.pk)
<span class="linenos">273</span>        },
<span class="linenos">274</span>        follow=<span class="hljs-keyword">True</span>
<span class="linenos">275</span>        )
<span class="linenos">276</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">277</span>
<span class="linenos">278</span>        <span class="hljs-comment"># Check changed successfully</span>
<span class="linenos">279</span>        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">280</span>
<span class="linenos">281</span>        <span class="hljs-comment"># Check post amended</span>
<span class="linenos">282</span>        all_posts = Post.objects.all()
<span class="linenos">283</span>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">284</span>        only_post = all_posts[<span class="hljs-number">0</span>]
<span class="linenos">285</span>        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
<span class="linenos">286</span>        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)
<span class="linenos">287</span>
<span class="linenos">288</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">289</span>        <span class="hljs-comment"># Create the post</span>
<span class="linenos">290</span>        post = PostFactory()
<span class="linenos">291</span>
<span class="linenos">292</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">293</span>        tag = TagFactory()
<span class="linenos">294</span>        post.tags.add(tag)
<span class="linenos">295</span>
<span class="linenos">296</span>        <span class="hljs-comment"># Check new post saved</span>
<span class="linenos">297</span>        all_posts = Post.objects.all()
<span class="linenos">298</span>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">299</span>
<span class="linenos">300</span>        <span class="hljs-comment"># Log in</span>
<span class="linenos">301</span>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)
<span class="linenos">302</span>
<span class="linenos">303</span>        <span class="hljs-comment"># Delete the post</span>
<span class="linenos">304</span>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/'</span> + str(post.pk) + <span class="hljs-string">'/delete/'</span>, {
<span class="linenos">305</span>            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
<span class="linenos">306</span>        }, follow=<span class="hljs-keyword">True</span>)
<span class="linenos">307</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">308</span>
<span class="linenos">309</span>        <span class="hljs-comment"># Check deleted successfully</span>
<span class="linenos">310</span>        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">311</span>
<span class="linenos">312</span>        <span class="hljs-comment"># Check post deleted</span>
<span class="linenos">313</span>        all_posts = Post.objects.all()
<span class="linenos">314</span>        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)</code></pre><p>There are two main issues here. The first is that when we try to edit or delete an existing item, or refer to it when creating something else, we can no longer rely on the number representing the primary key being set to 1. So we need to specifically obtain this, rather than hard-coding it to 1. Therefore, whenever we pass through a number to represent an item (with the exception of the site, but including tags, categories and posts), we need to instead fetch its primary key and return it. So, above where we try to delete a post, we replace <code>1</code> with <code>str(post.pk)</code>. This will solve a lot of the problems. As there’s a lot of them, I won’t go through each one, but you can see the entire class above for reference, and if you’ve followed along so far, you shouldn’t have any problems.</p><p>The other issue we need to fix is the login and logout tests. We simply add <code>follow=True</code> to these to ensure that the test client follows the redirects.</p><p>Let’s run our tests to make sure they pass:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.............................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">8.210</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>With that done, you can commit your changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/tests.py
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Fixed broken tests'</span></code></pre><p>Don’t forget to deploy your changes:</p><pre><code class="hljs lang-bash singleline">$ fab deploy</code></pre><p>Our blog has now been happily migrated over to Django 1.7!</p></article><article class="post"><p class="date">28th September 2014 7:53 pm</p><h1><a href="/blog/2014/09/28/changing-date-format-from-dd-slash-mm-slash-yyyy-to-yyyy-mm-dd-in-vim/">Changing Date Format from DD/MM/YYYY to YYYY-MM-DD in Vim</a></h1><p>Recently I had the occasion to reformat a load of dates in Vim from <code>DD/MM/YYYY</code> to <code>YYYY-MM-DD</code>. In Vim, this is quite simple:</p><pre><code class="hljs lang-viml singleline">:<span class="hljs-preprocessor">%</span>s/\<span class="hljs-comment">(\d\{2}\)</span>\/\<span class="hljs-comment">(\d\{2}\)</span>\/\<span class="hljs-comment">(\d\{4}\)</span>/\<span class="hljs-number">3</span>-\<span class="hljs-number">2</span>-\<span class="hljs-number">1</span>/g</code></pre><p>This should be easy to adapt to reformatting other date formats.</p></article><article class="post"><p class="date">31st August 2014 10:00 pm</p><h1><a href="/blog/2014/08/31/django-blog-tutorial-the-next-generation-part-8/">Django Blog Tutorial - the Next Generation - Part 8</a></h1><p>Hello again! In our final instalment, we’ll wrap up our blog by:</p><ul><li>Implementing a sitemap</li><li>Optimising and tidying up the site</li><li>Creating a Fabric task for easier deployment</li></ul><p>I’ll also cover development tools and practices that can make using Django easier. But first there’s a few housekeeping tasks that need doing…</p><p>Don’t forget to activate your virtualenv - you should know how to do this off by heart by now!</p><h1 id="upgrading-django">Upgrading Django</h1><p>At the time of writing, Django 1.7 is due any day now, but it’s not out yet so I won’t cover it. The biggest change is the addition of a built-in migration system, but switching from South to this is well-documented. When Django 1.7 comes out, it shouldn’t be difficult to upgrade to it - because we have good test coverage, we shouldn’t have much trouble catching errors.</p><p>However, Django 1.6.6 was recently released, and we need to upgrade to it. Just enter the following command to upgrade:</p><pre><code class="hljs lang-bash singleline">$ pip install Django --upgrade</code></pre><p>Then add it to your <code>requirements.txt</code>:</p><pre><code class="hljs lang-bash singleline">$ pip freeze &gt; requirements.txt</code></pre><p>Then commit your changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add requirements.txt
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Upgraded Django version'</span></code></pre><h1 id="implementing-a-sitemap">Implementing a sitemap</h1><p>Creating a sitemap for your blog is a good idea - it can be submitted to search engines, so that they can easily find your content. With Django, it’s pretty straightforward too.</p><p>First, let’s create a test for our sitemap. Add the following code at the end of <code>tests.py</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SitemapTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_sitemap</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">3</span>        <span class="hljs-comment"># Create a post</span>
<span class="linenos">4</span>        post = PostFactory()
<span class="linenos">5</span>
<span class="linenos">6</span>        <span class="hljs-comment"># Create a flat page</span>
<span class="linenos">7</span>        page = FlatPageFactory()
<span class="linenos">8</span>
<span class="linenos">9</span>        <span class="hljs-comment"># Get sitemap</span>
<span class="linenos">10</span>        response = self.client.get(<span class="hljs-string">'/sitemap.xml'</span>)
<span class="linenos">11</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">12</span>
<span class="linenos">13</span>        <span class="hljs-comment"># Check post is present in sitemap</span>
<span class="linenos">14</span>        self.assertTrue(<span class="hljs-string">'my-first-post'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">15</span>
<span class="linenos">16</span>        <span class="hljs-comment"># Check page is present in sitemap</span>
<span class="linenos">17</span>        self.assertTrue(<span class="hljs-string">'/about/'</span> <span class="hljs-keyword">in</span> response.content)</code></pre><p>Run it, and you should see the test fail:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>...........................F
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>FAIL: <span class="hljs-built_in">test</span>_sitemap (blogengine.tests.SitemapTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">847</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_sitemap
<span class="linenos">9</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">11</span>
<span class="linenos">12</span>----------------------------------------------------------------------
<span class="linenos">13</span>Ran <span class="hljs-number">28</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">6.873</span>s
<span class="linenos">14</span>
<span class="linenos">15</span>FAILED (failures=<span class="hljs-number">1</span>)
<span class="linenos">16</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Now, let’s implement our sitemap. The sitemap application comes with Django, and needs to be activated in your settings file, under <code>INSTALLED_APPS</code>:</p><pre><code class="hljs lang-python singleline">    <span class="hljs-string">'django.contrib.sitemaps'</span>,</code></pre><p>Next, let’s think about what content we want to include in the sitemap. We want to index our flat pages and our blog posts, so our sitemap should reflect that. Create a new file at <code>blogengine/sitemap.py</code> and enter the following text:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.contrib.sitemaps <span class="hljs-keyword">import</span> Sitemap
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.contrib.flatpages.models <span class="hljs-keyword">import</span> FlatPage
<span class="linenos">3</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post
<span class="linenos">4</span>
<span class="linenos">5</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostSitemap</span><span class="hljs-params">(Sitemap)</span>:</span>
<span class="linenos">6</span>    changefreq = <span class="hljs-string">"always"</span>
<span class="linenos">7</span>    priority = <span class="hljs-number">0.5</span>
<span class="linenos">8</span>
<span class="linenos">9</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">10</span>        <span class="hljs-keyword">return</span> Post.objects.all()
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lastmod</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">13</span>        <span class="hljs-keyword">return</span> obj.pub_date
<span class="linenos">14</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlatpageSitemap</span><span class="hljs-params">(Sitemap)</span>:</span>
<span class="linenos">17</span>    changefreq = <span class="hljs-string">"always"</span>
<span class="linenos">18</span>    priority = <span class="hljs-number">0.5</span>
<span class="linenos">19</span>
<span class="linenos">20</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">21</span>        <span class="hljs-keyword">return</span> FlatPage.objects.all()</code></pre><p>We define two sitemaps, one for all the posts, and the other for all the flat pages. Note that this works in a very similar way to the syndication framework.</p><p>Next, we amend our URLs. Add the following text after the existing imports in your URL file:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.contrib.sitemaps.views <span class="hljs-keyword">import</span> sitemap
<span class="linenos">2</span><span class="hljs-keyword">from</span> blogengine.sitemap <span class="hljs-keyword">import</span> PostSitemap, FlatpageSitemap
<span class="linenos">3</span>
<span class="linenos">4</span><span class="hljs-comment"># Define sitemaps</span>
<span class="linenos">5</span>sitemaps = {
<span class="linenos">6</span>    <span class="hljs-string">'posts'</span>: PostSitemap,
<span class="linenos">7</span>    <span class="hljs-string">'pages'</span>: FlatpageSitemap
<span class="linenos">8</span>}</code></pre><p>Then add the following after the existing routes:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-comment"># Sitemap</span>
<span class="linenos">2</span>    url(<span class="hljs-string">r'^sitemap\.xml$'</span>, sitemap, {<span class="hljs-string">'sitemaps'</span>: sitemaps},
<span class="linenos">3</span>            name=<span class="hljs-string">'django.contrib.sitemaps.views.sitemap'</span>),</code></pre><p>Here we define what sitemaps we’re going to use, and we define a URL for them. It’s pretty straightforward to use.</p><p>Let’s run our tests:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>............................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">28</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">6.863</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>And done! Let’s commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/ django_tutorial_blog_ng/settings.py
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Implemented a sitemap'</span></code></pre><h1 id="fixing-test-coverage">Fixing test coverage</h1><p>Our blog is now feature-complete, but there are a few gaps in test coverage, so we’ll fix them. If, like me, you’re using Coveralls.io, <a href="https://coveralls.io/builds/1151177">you can easily see via their web interface where there are gaps in the coverage</a>.</p><p>Now, our gaps are all in our view file - if you <a href="https://coveralls.io/files/280228813">take a look at my build</a>, you can easily identify the gaps as they’re marked in red.</p><p>The first gap is where a tag does not exist. Interestingly, if we look at the code in the view, we can see that some of it is redundant:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagPostsFeed</span><span class="hljs-params">(PostsFeed)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_object</span><span class="hljs-params">(self, request, slug)</span>:</span>
<span class="linenos">3</span>        <span class="hljs-keyword">return</span> get_object_or_404(Tag, slug=slug)
<span class="linenos">4</span>
<span class="linenos">5</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">title</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">6</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts tagged  %s"</span> % obj.name
<span class="linenos">7</span>
<span class="linenos">8</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">link</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">9</span>        <span class="hljs-keyword">return</span> obj.get_absolute_url()
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">description</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">12</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts tagged %s"</span> % obj.name
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">15</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">16</span>            tag = Tag.objects.get(slug=obj.slug)
<span class="linenos">17</span>            <span class="hljs-keyword">return</span> tag.post_set.all()
<span class="linenos">18</span>        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
<span class="linenos">19</span>            <span class="hljs-keyword">return</span> Post.objects.none()</code></pre><p>Under the <code>items</code> function, we check to see if the tag exists. However, under <code>get_object</code> we can see that if the object didn’t exist, it would already have returned a 404 error. We can therefore safely amend <code>items</code> to not check, since that try statement will never fail:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagPostsFeed</span><span class="hljs-params">(PostsFeed)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_object</span><span class="hljs-params">(self, request, slug)</span>:</span>
<span class="linenos">3</span>        <span class="hljs-keyword">return</span> get_object_or_404(Tag, slug=slug)
<span class="linenos">4</span>
<span class="linenos">5</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">title</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">6</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts tagged  %s"</span> % obj.name
<span class="linenos">7</span>
<span class="linenos">8</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">link</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">9</span>        <span class="hljs-keyword">return</span> obj.get_absolute_url()
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">description</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">12</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts tagged %s"</span> % obj.name
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">15</span>        tag = Tag.objects.get(slug=obj.slug)
<span class="linenos">16</span>        <span class="hljs-keyword">return</span> tag.post_set.all()</code></pre><p>The other two gaps are in our search view - we never get an empty result for the search in the following section:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSearchResults</span><span class="hljs-params">(request)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-string">"""
<span class="linenos">3</span>    Search for a post by title or text
<span class="linenos">4</span>    """</span>
<span class="linenos">5</span>    <span class="hljs-comment"># Get the query data</span>
<span class="linenos">6</span>    query = request.GET.get(<span class="hljs-string">'q'</span>, <span class="hljs-string">''</span>)
<span class="linenos">7</span>    page = request.GET.get(<span class="hljs-string">'page'</span>, <span class="hljs-number">1</span>)
<span class="linenos">8</span>
<span class="linenos">9</span>    <span class="hljs-comment"># Query the database</span>
<span class="linenos">10</span>    <span class="hljs-keyword">if</span> query:
<span class="linenos">11</span>        results = Post.objects.filter(Q(text__icontains=query) | Q(title__icontains=query))
<span class="linenos">12</span>    <span class="hljs-keyword">else</span>:
<span class="linenos">13</span>        results = <span class="hljs-keyword">None</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="hljs-comment"># Add pagination</span>
<span class="linenos">16</span>    pages = Paginator(results, <span class="hljs-number">5</span>)
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="hljs-comment"># Get specified page</span>
<span class="linenos">19</span>    <span class="hljs-keyword">try</span>:
<span class="linenos">20</span>        returned_page = pages.page(page)
<span class="linenos">21</span>    <span class="hljs-keyword">except</span> EmptyPage:
<span class="linenos">22</span>        returned_page = pages.page(pages.num_pages)
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="hljs-comment"># Display the search results</span>
<span class="linenos">25</span>    <span class="hljs-keyword">return</span> render_to_response(<span class="hljs-string">'blogengine/search_post_list.html'</span>,
<span class="linenos">26</span>                              {<span class="hljs-string">'page_obj'</span>: returned_page,
<span class="linenos">27</span>                               <span class="hljs-string">'object_list'</span>: returned_page.object_list,
<span class="linenos">28</span>                               <span class="hljs-string">'search'</span>: query})</code></pre><p>So replace it with this:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSearchResults</span><span class="hljs-params">(request)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-string">"""
<span class="linenos">3</span>    Search for a post by title or text
<span class="linenos">4</span>    """</span>
<span class="linenos">5</span>    <span class="hljs-comment"># Get the query data</span>
<span class="linenos">6</span>    query = request.GET.get(<span class="hljs-string">'q'</span>, <span class="hljs-string">''</span>)
<span class="linenos">7</span>    page = request.GET.get(<span class="hljs-string">'page'</span>, <span class="hljs-number">1</span>)
<span class="linenos">8</span>
<span class="linenos">9</span>    <span class="hljs-comment"># Query the database</span>
<span class="linenos">10</span>    results = Post.objects.filter(Q(text__icontains=query) | Q(title__icontains=query))
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="hljs-comment"># Add pagination</span>
<span class="linenos">13</span>    pages = Paginator(results, <span class="hljs-number">5</span>)
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="hljs-comment"># Get specified page</span>
<span class="linenos">16</span>    <span class="hljs-keyword">try</span>:
<span class="linenos">17</span>        returned_page = pages.page(page)
<span class="linenos">18</span>    <span class="hljs-keyword">except</span> EmptyPage:
<span class="linenos">19</span>        returned_page = pages.page(pages.num_pages)
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="hljs-comment"># Display the search results</span>
<span class="linenos">22</span>    <span class="hljs-keyword">return</span> render_to_response(<span class="hljs-string">'blogengine/search_post_list.html'</span>,
<span class="linenos">23</span>                              {<span class="hljs-string">'page_obj'</span>: returned_page,
<span class="linenos">24</span>                               <span class="hljs-string">'object_list'</span>: returned_page.object_list,
<span class="linenos">25</span>                               <span class="hljs-string">'search'</span>: query})</code></pre><p>We don’t need to check whether <code>query</code> is defined because if <code>q</code> is left blank, the value of <code>query</code> will be an empty string, so we may as well pull out the redundant code.</p><p>Finally, the other gap is for when a user tries to get an empty search page (eg, page two of something with five or less results). So let’s add another test to our <code>SearchViewTest</code> class:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_failing_search</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">2</span>        <span class="hljs-comment"># Search for something that is not present</span>
<span class="linenos">3</span>        response = self.client.get(<span class="hljs-string">'/search?q=wibble'</span>)
<span class="linenos">4</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">5</span>        self.assertTrue(<span class="hljs-string">'No posts found'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">6</span>
<span class="linenos">7</span>        <span class="hljs-comment"># Try to get nonexistent second page</span>
<span class="linenos">8</span>        response = self.client.get(<span class="hljs-string">'/search?q=wibble&amp;page=2'</span>)
<span class="linenos">9</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>        self.assertTrue(<span class="hljs-string">'No posts found'</span> <span class="hljs-keyword">in</span> response.content)</code></pre><p>Run our tests and check the coverage:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ coverage run --include=<span class="hljs-string">"blogengine/*"</span> --omit=<span class="hljs-string">"blogengine/migrations/*"</span> manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>$ coverage html</code></pre><p>If you open <code>htmlcov/index.html</code> in your browser, you should see that the test coverage is back up to 100%. With that done, it’s time to commit again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Fixed gaps in coverage'</span></code></pre><p>Remember, it’s not always possible to achieve 100% test coverage, and you shouldn’t worry too much about it if it’s not possible - <a href="http://nedbatchelder.com/code/coverage/excluding.html">it’s possible to ignore code</a> if necessary. However, it’s a good idea to aim for 100%.</p><h1 id="using-fabric-for-deployment">Using Fabric for deployment</h1><p>Next we’ll cover using Fabric, a handy tool for deploying your changes (any pretty much any other task you want to automate). First, you need to install it:</p><pre><code class="hljs lang-bash singleline">$ pip install Fabric</code></pre><p>If you have any problems installing it, you should be able to resolve them via Google - most of them are likely to be absent libraries that Fabric depends upon. Once it’s installed, add it to your <code>requirements.tzt</code>:</p><pre><code class="hljs lang-bash singleline">$ pip freeze &gt; requirements.txt</code></pre><p>Next, create a file called <code>fabfile.py</code> and enter the following text:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="linenos">2</span><span class="hljs-keyword">from</span> fabric.api <span class="hljs-keyword">import</span> local
<span class="linenos">3</span>
<span class="linenos">4</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deploy</span><span class="hljs-params">()</span>:</span>
<span class="linenos">5</span>    <span class="hljs-string">"""
<span class="linenos">6</span>    Deploy the latest version to Heroku
<span class="linenos">7</span>    """</span>
<span class="linenos">8</span>    <span class="hljs-comment"># Push changes to master</span>
<span class="linenos">9</span>    local(<span class="hljs-string">"git push origin master"</span>)
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="hljs-comment"># Push changes to Heroku</span>
<span class="linenos">12</span>    local(<span class="hljs-string">"git push heroku master"</span>)
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="hljs-comment"># Run migrations on Heroku</span>
<span class="linenos">15</span>    local(<span class="hljs-string">"heroku run python manage.py migrate"</span>)</code></pre><p>Now, all this file does is push our changes to Github (or wherever else your repository is hosted) and to Heroku, and runs your migrations. It’s not a terribly big task anyway, but it’s handy to have it in place. Let’s commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add fabfile.py requirements.txt
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Added Fabric task for deployment'</span></code></pre><p>Then, let’s try it out:</p><pre><code class="hljs lang-bash singleline">$ fab deploy</code></pre><p>There, wasn’t that more convenient? Fabric is much more powerful than this simple demonstration indicates, and can run tasks on remote servers via SSH easily. I recommend you take a look at the <a href="http://www.fabfile.org/">documentation</a> to see what else you can do with it. If you’re hosting your site on a VPS, you will probably find Fabric indispensable, as you will need to restart the application every time you push up a new revision.</p><h1 id="tidying-up">Tidying up</h1><p>We want our blog application to play nicely with other Django apps. For instance, say you’re working on a new site that includes a blogging engine. Wouldn’t it make sense to just be able to drop in this blogging engine and have it work immediately? At the moment, some of our URL’s are hard-coded, so we may have problems in doing so. Let’s fix that.</p><p>First we’ll amend our tests. Add this at the top of the tests file:</p><pre><code class="hljs lang-python singleline"><span class="hljs-keyword">from</span> django.core.urlresolvers <span class="hljs-keyword">import</span> reverse</code></pre><p>Next, replace every instance of this:</p><pre><code class="hljs lang-python singleline">        response = self.client.get(<span class="hljs-string">'/'</span>)</code></pre><p>with this:</p><pre><code class="hljs lang-python singleline">response = self.client.get(reverse(<span class="hljs-string">'blogengine:index'</span>))</code></pre><p>Then, rewrite the calls to the search route. For instance, this:</p><pre><code class="hljs lang-python singleline">        response = self.client.get(<span class="hljs-string">'/search?q=first'</span>)</code></pre><p>should become this:</p><pre><code class="hljs lang-python singleline">        response = self.client.get(reverse(<span class="hljs-string">'blogengine:search'</span>) + <span class="hljs-string">'?q=first'</span>)</code></pre><p>I’ll leave changing these as an exercise for the reader, but check the repository if you get stuck.</p><p>Next, we need to assign a namespace to our app’s routes:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, include, url
<span class="linenos">2</span>
<span class="linenos">3</span><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="linenos">4</span>admin.autodiscover()
<span class="linenos">5</span>
<span class="linenos">6</span>urlpatterns = patterns(<span class="hljs-string">''</span>,
<span class="linenos">7</span>    <span class="hljs-comment"># Examples:</span>
<span class="linenos">8</span>    <span class="hljs-comment"># url(r'^$', 'django_tutorial_blog_ng.views.home', name='home'),</span>
<span class="linenos">9</span>    <span class="hljs-comment"># url(r'^blog/', include('blog.urls')),</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    url(<span class="hljs-string">r'^admin/'</span>, include(admin.site.urls)),
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="hljs-comment"># Blog URLs</span>
<span class="linenos">14</span>    url(<span class="hljs-string">r''</span>, include(<span class="hljs-string">'blogengine.urls'</span>, namespace=<span class="hljs-string">"blogengine"</span>)),
<span class="linenos">15</span>
<span class="linenos">16</span>    <span class="hljs-comment"># Flat pages</span>
<span class="linenos">17</span>    url(<span class="hljs-string">r''</span>, include(<span class="hljs-string">'django.contrib.flatpages.urls'</span>)),
<span class="linenos">18</span>)</code></pre><p>We then assign names to our routes in the app’s <code>urls.py</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="linenos">3</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category, Tag
<span class="linenos">4</span><span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView, PostsFeed, CategoryPostsFeed, TagPostsFeed, getSearchResults
<span class="linenos">5</span><span class="hljs-keyword">from</span> django.contrib.sitemaps.views <span class="hljs-keyword">import</span> sitemap
<span class="linenos">6</span><span class="hljs-keyword">from</span> blogengine.sitemap <span class="hljs-keyword">import</span> PostSitemap, FlatpageSitemap
<span class="linenos">7</span>
<span class="linenos">8</span><span class="hljs-comment"># Define sitemaps</span>
<span class="linenos">9</span>sitemaps = {
<span class="linenos">10</span>    <span class="hljs-string">'posts'</span>: PostSitemap,
<span class="linenos">11</span>    <span class="hljs-string">'pages'</span>: FlatpageSitemap
<span class="linenos">12</span>}
<span class="linenos">13</span>
<span class="linenos">14</span>urlpatterns = patterns(<span class="hljs-string">''</span>,
<span class="linenos">15</span>    <span class="hljs-comment"># Index</span>
<span class="linenos">16</span>    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
<span class="linenos">17</span>        model=Post,
<span class="linenos">18</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">19</span>        ),
<span class="linenos">20</span>        name=<span class="hljs-string">'index'</span>
<span class="linenos">21</span>        ),
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="hljs-comment"># Individual posts</span>
<span class="linenos">24</span>    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
<span class="linenos">25</span>        model=Post,
<span class="linenos">26</span>        ),
<span class="linenos">27</span>        name=<span class="hljs-string">'post'</span>
<span class="linenos">28</span>        ),
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="hljs-comment"># Categories</span>
<span class="linenos">31</span>    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
<span class="linenos">32</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">33</span>        model=Category,
<span class="linenos">34</span>        ),
<span class="linenos">35</span>        name=<span class="hljs-string">'category'</span>
<span class="linenos">36</span>        ),
<span class="linenos">37</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    <span class="hljs-comment"># Tags</span>
<span class="linenos">40</span>    url(<span class="hljs-string">r'^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagListView.as_view(
<span class="linenos">41</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">42</span>        model=Tag,
<span class="linenos">43</span>        ),
<span class="linenos">44</span>        name=<span class="hljs-string">'tag'</span>
<span class="linenos">45</span>        ),
<span class="linenos">46</span>
<span class="linenos">47</span>    <span class="hljs-comment"># Post RSS feed</span>
<span class="linenos">48</span>    url(<span class="hljs-string">r'^feeds/posts/$'</span>, PostsFeed()),
<span class="linenos">49</span>
<span class="linenos">50</span>    <span class="hljs-comment"># Category RSS feed</span>
<span class="linenos">51</span>    url(<span class="hljs-string">r'^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryPostsFeed()),
<span class="linenos">52</span>
<span class="linenos">53</span>    <span class="hljs-comment"># Tag RSS feed</span>
<span class="linenos">54</span>    url(<span class="hljs-string">r'^feeds/posts/tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagPostsFeed()),
<span class="linenos">55</span>
<span class="linenos">56</span>    <span class="hljs-comment"># Search posts</span>
<span class="linenos">57</span>    url(<span class="hljs-string">r'^search'</span>, getSearchResults, name=<span class="hljs-string">'search'</span>),
<span class="linenos">58</span>
<span class="linenos">59</span>    <span class="hljs-comment"># Sitemap</span>
<span class="linenos">60</span>    url(<span class="hljs-string">r'^sitemap\.xml$'</span>, sitemap, {<span class="hljs-string">'sitemaps'</span>: sitemaps},
<span class="linenos">61</span>            name=<span class="hljs-string">'django.contrib.sitemaps.views.sitemap'</span>),
<span class="linenos">62</span>)</code></pre><p>You also need to amend two of your templates:</p><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="linenos">2</span><span class="hljs-comment">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">3</span><span class="hljs-comment">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">4</span><span class="hljs-comment">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">5</span><span class="hljs-comment">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"no-js"</span>&gt;</span> <span class="hljs-comment">&lt;!--&lt;![endif]--&gt;</span>
<span class="linenos">6</span>    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
<span class="linenos">7</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
<span class="linenos">8</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
<span class="linenos">9</span>        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> title %}</span><span class="xml">My Django Blog</span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="linenos">10</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"description"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">""</span>&gt;</span>
<span class="linenos">11</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>&gt;</span>
<span class="linenos">12</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"alternate"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"application/rss+xml"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Blog posts"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span> &gt;</span>
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="hljs-comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
<span class="linenos">15</span>
<span class="linenos">16</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> staticfiles %}</span><span class="xml">
<span class="linenos">17</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/normalize.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">18</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">19</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">20</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">21</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">22</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/code.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">23</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">24</span>    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="linenos">25</span>    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
<span class="linenos">26</span>        <span class="hljs-comment">&lt;!--[if lt IE 7]&gt;
<span class="linenos">27</span>            &lt;p class="browsehappy"&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;
<span class="linenos">28</span>        &lt;![endif]--&gt;</span>
<span class="linenos">29</span>
<span class="linenos">30</span>        <span class="hljs-comment">&lt;!-- Add your site or application content here --&gt;</span>
<span class="linenos">31</span>
<span class="linenos">32</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fb-root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">33</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="clojure"><span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">d</span>, s, id)</span> <span class="hljs-collection">{
<span class="linenos">34</span>            var js, fjs = d.getElementsByTagName<span class="hljs-list">(<span class="hljs-keyword">s</span>)</span><span class="hljs-collection">[<span class="hljs-number">0</span>]</span><span class="hljs-comment">;</span>
<span class="linenos">35</span>            if <span class="hljs-list">(<span class="hljs-keyword">d.getElementById</span><span class="hljs-list">(<span class="hljs-keyword">id</span>)</span>)</span> return;
<span class="linenos">36</span>                js = d.createElement<span class="hljs-list">(<span class="hljs-keyword">s</span>)</span><span class="hljs-comment">; js.id = id;</span>
<span class="linenos">37</span>                js.src = <span class="hljs-string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span><span class="hljs-comment">;</span>
<span class="linenos">38</span>                fjs.parentNode.insertBefore<span class="hljs-list">(<span class="hljs-keyword">js</span>, fjs)</span><span class="hljs-comment">;</span>
<span class="linenos">39</span>            }</span><span class="hljs-list">(<span class="hljs-keyword">document</span>, 'script', 'facebook-jssdk')</span>)</span><span class="hljs-comment">;</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">40</span>
<span class="linenos">41</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
<span class="linenos">42</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container-fluid"</span>&gt;</span>
<span class="linenos">43</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-header"</span>&gt;</span>
<span class="linenos">44</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"button"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-toggle"</span> <span class="hljs-attribute">data-toggle</span>=<span class="hljs-value">"collapse"</span> <span class="hljs-attribute">data-target</span>=<span class="hljs-value">"#header-nav"</span>&gt;</span>
<span class="linenos">45</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">46</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">47</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">48</span>                    <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="linenos">49</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-brand"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">url</span> 'blogengine:index' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">50</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">51</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"collapse navbar-collapse"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header-nav"</span>&gt;</span>
<span class="linenos">52</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav"</span>&gt;</span>
<span class="linenos">53</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> flatpages %}</span><span class="xml">
<span class="linenos">54</span>                        </span><span class="hljs-template_tag">{% get_flatpages <span class="hljs-keyword">as</span> flatpages %}</span><span class="xml">
<span class="linenos">55</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> flatpage <span class="hljs-keyword">in</span> flatpages %}</span><span class="xml">
<span class="linenos">56</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ flatpage.url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ flatpage.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">57</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">58</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span>&gt;</span>RSS feed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">59</span>
<span class="linenos">60</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">"/search"</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"GET"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-form navbar-left"</span>&gt;</span>
<span class="linenos">61</span>                            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group"</span>&gt;</span>
<span class="linenos">62</span>                                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"q"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Search..."</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
<span class="linenos">63</span>                            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">64</span>                            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-default"</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="linenos">65</span>                        <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="linenos">66</span>                    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">67</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">68</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">69</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">70</span>
<span class="linenos">71</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
<span class="linenos">72</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> header %}</span><span class="xml">
<span class="linenos">73</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"page-header"</span>&gt;</span>
<span class="linenos">74</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">75</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">76</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
<span class="linenos">77</span>
<span class="linenos">78</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
<span class="linenos">79</span>                </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
<span class="linenos">80</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">81</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">82</span>
<span class="linenos">83</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container footer"</span>&gt;</span>
<span class="linenos">84</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
<span class="linenos">85</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"span12"</span>&gt;</span>
<span class="linenos">86</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Copyright &amp;copy; </span><span class="hljs-template_tag">{% <span class="hljs-keyword">now</span> "Y" %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">87</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">88</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">89</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">90</span>
<span class="linenos">91</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">92</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="applescript">window.jQuery || document.<span class="hljs-command">write</span>('&lt;<span class="hljs-keyword">script</span> src=<span class="hljs-string">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/jquery-1.10.2.min.js' %}</span><span class="xml"><span class="1c"><span class="hljs-string">"&gt;&lt;\/script&gt;')</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">93</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/plugins.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">94</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">95</span>
<span class="linenos">96</span>        <span class="hljs-comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
<span class="linenos">97</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="scheme">
<span class="linenos">98</span>            <span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">b</span>,o,i,l,e,r)</span>{b.GoogleAnalyticsObject=l<span class="hljs-comment">;b[l]||(b[l]=</span>
<span class="linenos">99</span>            function<span class="hljs-list">()</span>{<span class="hljs-list">(<span class="hljs-keyword">b</span><span class="hljs-list">[<span class="hljs-keyword">l</span>].q=b<span class="hljs-list">[<span class="hljs-keyword">l</span>].q||<span class="hljs-list">[]).push<span class="hljs-list">(<span class="hljs-keyword">arguments</span>)</span>})<span class="hljs-comment">;b[l].l=+new Date;</span>
<span class="linenos">100</span>            e=o.createElement<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span><span class="hljs-comment">;r=o.getElementsByTagName(i)[0];</span>
<span class="linenos">101</span>            e.src=<span class="hljs-variable">'//www.google-analytics.com/analytics.js</span>'<span class="hljs-comment">;</span>
<span class="linenos">102</span>            r.parentNode.insertBefore<span class="hljs-list">(<span class="hljs-keyword">e</span>,r)</span>}<span class="hljs-list">(<span class="hljs-keyword">window</span>,document,<span class="hljs-variable">'script</span>',<span class="hljs-variable">'ga</span>')</span>)<span class="hljs-comment">;</span>
<span class="linenos">103</span>            ga<span class="hljs-list">(<span class="hljs-variable">'create</span>',<span class="hljs-variable">'UA-XXXXX-X</span>')</span><span class="hljs-comment">;ga('send','pageview');</span>
<span class="linenos">104</span>        </span></span></span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">105</span>    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="linenos">106</span><span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></span></code></pre><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">
<span class="linenos">2</span>
<span class="linenos">3</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">
<span class="linenos">4</span>
<span class="linenos">5</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
<span class="linenos">6</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object_list %}</span><span class="xml">
<span class="linenos">7</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
<span class="linenos">8</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post col-md-12"</span>&gt;</span>
<span class="linenos">9</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">10</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
<span class="linenos">11</span>            </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
<span class="linenos">12</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">13</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.category %}</span><span class="xml">
<span class="linenos">14</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">15</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-primary"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">16</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">17</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">18</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.tags %}</span><span class="xml">
<span class="linenos">19</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">20</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
<span class="linenos">21</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-success"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">22</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">23</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">24</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">25</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">26</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">else</span> %}</span><span class="xml">
<span class="linenos">27</span>            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>No posts found<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">28</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">29</span>
<span class="linenos">30</span>        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pager"</span>&gt;</span>
<span class="linenos">31</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
<span class="linenos">32</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"previous"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">url</span> 'blogengine:search' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">?page=</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">&amp;q=</span></span></span><span class="hljs-variable">{{ search }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">33</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">34</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
<span class="linenos">35</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">url</span> 'blogengine:search' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">?page=</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">&amp;q=</span></span></span><span class="hljs-variable">{{ search }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">36</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">37</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span></code></pre><p>Let’s run our tests:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine/
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.............................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">29</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">10.456</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>And commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add .
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use named routes'</span></code></pre><h1 id="debugging-django">Debugging Django</h1><p>There are a number of handy ways to debug Django applications. One of the simplest is to use the Python debugger. To use it, just enter the following lines at the point you want to break at:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">import</span> pdb
<span class="linenos">2</span>pdb.set_trace()</code></pre><p>Now, whenever that line of code is run, you’ll be dropped into an interactive shell that lets you play around to find out what’s going wrong. However, it doesn’t offer autocompletion, so we’ll install <code>ipdb</code>, which is an improved version:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ pip install ipdb
<span class="linenos">2</span>$ pip freeze &gt; requirements.txt</code></pre><p>Now you can use <code>ipdb</code> in much the same way as you would use <code>pdb</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">import</span> ipdb
<span class="linenos">2</span>ipdb.set_trace()</code></pre><p>Now, <code>ipdb</code> is very useful, but it isn’t much help for profiling your application. For that you need the Django Debug Toolbar. Run the following commands:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ pip install django-debug-toolbar
<span class="linenos">2</span>$ pip freeze &gt; requirements.txt</code></pre><p>Then add the following line to <code>INSTALLED_APPS</code> in your settings file:</p><pre><code class="hljs lang-python singleline">    <span class="hljs-string">'debug_toolbar'</span>,</code></pre><p>Then, try running the development server, and you’ll see a toolbar on the right-hand side of the screen that allows you to view some useful data about your page. For instance, you’ll notice a field called <code>SQL</code> - this contains details of the queries carried out when building the page. To actually see the queries carried out, you’ll want to disable caching in your settings file by commenting out all the constants that start with <code>CACHE</code>.</p><p>We won’t go into using the toolbar to optimise queries, but using this, you can easily see what queries are being executed on a specific page, how long they take, and the values they return. Sometimes, you may need to optimise a slow query - in this case, Django allows you to drop down to writing raw SQL if necessary.</p><p>Note that if you’re running Django in production, you should set <code>DEBUG</code> to <code>False</code> as otherwise it gives rather too much information to potential attackers, and with Django Debug Toolbar installed, that’s even more important.</p><p>Please also note that when you disable debug mode, Django no longer handles static files automatically, so you’ll need to run <code>python manage.py collectstatic</code> and commit the <code>staticfiles</code> directory.</p><p>Once you’ve disabled debug mode, collected the static files, and re-enables caching, you can commit your changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add .
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Installed debugging tools'</span></code></pre><h1 id="optimising-static-files">Optimising static files</h1><p>We want our blog to get the best SEO results it can, so making it fast is essential. One of the simplest things you can do is to concatenate and minify static assets such as CSS and JavaScript. There are numerous ways to do this, but I generally use Grunt. Let’s set up a Grunt config to concatenate and minify our CSS and JavaScript.</p><p>You’ll need to have Node.js installed on your development machine for this. Then, you need to install the Grunt command-line interface:</p><pre><code class="hljs lang-bash singleline">$ sudo npm install -g grunt-cli</code></pre><p>With that done, we need to create a <code>package.json</code> file. You can create one using the command <code>npm init</code>. Here’s mine:</p><pre><code class="hljs lang-json"><span class="linenos">1</span>{
<span class="linenos">2</span>  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"django_tutorial_blog_ng"</span></span>,
<span class="linenos">3</span>  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-string">"1.0.0"</span></span>,
<span class="linenos">4</span>  "<span class="hljs-attribute">description</span>": <span class="hljs-value"><span class="hljs-string">"Django Tutorial Blog NG ======================="</span></span>,
<span class="linenos">5</span>  "<span class="hljs-attribute">main</span>": <span class="hljs-value"><span class="hljs-string">"index.js"</span></span>,
<span class="linenos">6</span>  "<span class="hljs-attribute">scripts</span>": <span class="hljs-value">{
<span class="linenos">7</span>    "<span class="hljs-attribute">test</span>": <span class="hljs-value"><span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
<span class="linenos">8</span>  </span>}</span>,
<span class="linenos">9</span>  "<span class="hljs-attribute">repository</span>": <span class="hljs-value">{
<span class="linenos">10</span>    "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"git"</span></span>,
<span class="linenos">11</span>    "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/matthewbdaly/django_tutorial_blog_ng.git"</span>
<span class="linenos">12</span>  </span>}</span>,
<span class="linenos">13</span>  "<span class="hljs-attribute">author</span>": <span class="hljs-value"><span class="hljs-string">"Matthew Daly &lt;matthew@matthewdaly.co.uk&gt; (http://matthewdaly.co.uk/)"</span></span>,
<span class="linenos">14</span>  "<span class="hljs-attribute">license</span>": <span class="hljs-value"><span class="hljs-string">"ISC"</span></span>,
<span class="linenos">15</span>  "<span class="hljs-attribute">bugs</span>": <span class="hljs-value">{
<span class="linenos">16</span>    "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/matthewbdaly/django_tutorial_blog_ng/issues"</span>
<span class="linenos">17</span>  </span>}</span>,
<span class="linenos">18</span>  "<span class="hljs-attribute">homepage</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/matthewbdaly/django_tutorial_blog_ng"</span>
<span class="linenos">19</span></span>}</code></pre><p>Feel free to amend it as you see fit.</p><p>Next we install Grunt and the required plugins:</p><pre><code class="hljs lang-bash singleline">$ npm install grunt grunt-contrib-cssmin grunt-contrib-concat grunt-contrib-uglify --save-dev</code></pre><p>We now need to create a Gruntfile for our tasks:</p><pre><code class="hljs lang-javascript"><span class="linenos">1</span><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(grunt)</span> </span>{
<span class="linenos">2</span><span class="hljs-pi">    'use strict'</span>;
<span class="linenos">3</span>
<span class="linenos">4</span>    grunt.initConfig({
<span class="linenos">5</span>        concat: {
<span class="linenos">6</span>            dist: {
<span class="linenos">7</span>                src: [
<span class="linenos">8</span>                    <span class="hljs-string">'blogengine/static/bower_components/bootstrap/dist/css/bootstrap.css'</span>,
<span class="linenos">9</span>                    <span class="hljs-string">'blogengine/static/bower_components/bootstrap/dist/css/bootstrap-theme.css'</span>,
<span class="linenos">10</span>                    <span class="hljs-string">'blogengine/static/css/code.css'</span>,
<span class="linenos">11</span>                    <span class="hljs-string">'blogengine/static/css/main.css'</span>,
<span class="linenos">12</span>                ],
<span class="linenos">13</span>                dest: <span class="hljs-string">'blogengine/static/css/style.css'</span>
<span class="linenos">14</span>            }
<span class="linenos">15</span>        },
<span class="linenos">16</span>        uglify: {
<span class="linenos">17</span>            dist: {
<span class="linenos">18</span>                src: [
<span class="linenos">19</span>                    <span class="hljs-string">'blogengine/static/bower_components/jquery/jquery.js'</span>,
<span class="linenos">20</span>                    <span class="hljs-string">'blogengine/static/bower_components/bootstrap/dist/js/bootstrap.js'</span>
<span class="linenos">21</span>                ],
<span class="linenos">22</span>                dest: <span class="hljs-string">'blogengine/static/js/all.min.js'</span>
<span class="linenos">23</span>            }
<span class="linenos">24</span>        },
<span class="linenos">25</span>        cssmin: {
<span class="linenos">26</span>            dist: {
<span class="linenos">27</span>                src: <span class="hljs-string">'blogengine/static/css/style.css'</span>,
<span class="linenos">28</span>                dest: <span class="hljs-string">'blogengine/static/css/style.min.css'</span>
<span class="linenos">29</span>            }
<span class="linenos">30</span>        }
<span class="linenos">31</span>    });
<span class="linenos">32</span>
<span class="linenos">33</span>    grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);
<span class="linenos">34</span>    grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-uglify'</span>);
<span class="linenos">35</span>    grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-cssmin'</span>);
<span class="linenos">36</span>    grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'concat'</span>, <span class="hljs-string">'uglify'</span>, <span class="hljs-string">'cssmin'</span>]);
<span class="linenos">37</span>};</code></pre><p>You’ll also need to change the paths in your base HTML file to point to the minified versions:</p><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="linenos">2</span><span class="hljs-comment">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">3</span><span class="hljs-comment">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">4</span><span class="hljs-comment">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">5</span><span class="hljs-comment">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"no-js"</span>&gt;</span> <span class="hljs-comment">&lt;!--&lt;![endif]--&gt;</span>
<span class="linenos">6</span>    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
<span class="linenos">7</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
<span class="linenos">8</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
<span class="linenos">9</span>        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> title %}</span><span class="xml">My Django Blog</span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="linenos">10</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"description"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">""</span>&gt;</span>
<span class="linenos">11</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>&gt;</span>
<span class="linenos">12</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"alternate"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"application/rss+xml"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Blog posts"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span> &gt;</span>
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="hljs-comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
<span class="linenos">15</span>
<span class="linenos">16</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> staticfiles %}</span><span class="xml">
<span class="linenos">17</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/style.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">18</span>    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="linenos">19</span>    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
<span class="linenos">20</span>        <span class="hljs-comment">&lt;!--[if lt IE 7]&gt;
<span class="linenos">21</span>            &lt;p class="browsehappy"&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;
<span class="linenos">22</span>        &lt;![endif]--&gt;</span>
<span class="linenos">23</span>
<span class="linenos">24</span>        <span class="hljs-comment">&lt;!-- Add your site or application content here --&gt;</span>
<span class="linenos">25</span>
<span class="linenos">26</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fb-root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">27</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="clojure"><span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">d</span>, s, id)</span> <span class="hljs-collection">{
<span class="linenos">28</span>            var js, fjs = d.getElementsByTagName<span class="hljs-list">(<span class="hljs-keyword">s</span>)</span><span class="hljs-collection">[<span class="hljs-number">0</span>]</span><span class="hljs-comment">;</span>
<span class="linenos">29</span>            if <span class="hljs-list">(<span class="hljs-keyword">d.getElementById</span><span class="hljs-list">(<span class="hljs-keyword">id</span>)</span>)</span> return;
<span class="linenos">30</span>                js = d.createElement<span class="hljs-list">(<span class="hljs-keyword">s</span>)</span><span class="hljs-comment">; js.id = id;</span>
<span class="linenos">31</span>                js.src = <span class="hljs-string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span><span class="hljs-comment">;</span>
<span class="linenos">32</span>                fjs.parentNode.insertBefore<span class="hljs-list">(<span class="hljs-keyword">js</span>, fjs)</span><span class="hljs-comment">;</span>
<span class="linenos">33</span>            }</span><span class="hljs-list">(<span class="hljs-keyword">document</span>, 'script', 'facebook-jssdk')</span>)</span><span class="hljs-comment">;</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">34</span>
<span class="linenos">35</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
<span class="linenos">36</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container-fluid"</span>&gt;</span>
<span class="linenos">37</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-header"</span>&gt;</span>
<span class="linenos">38</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"button"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-toggle"</span> <span class="hljs-attribute">data-toggle</span>=<span class="hljs-value">"collapse"</span> <span class="hljs-attribute">data-target</span>=<span class="hljs-value">"#header-nav"</span>&gt;</span>
<span class="linenos">39</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">40</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">41</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">42</span>                    <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="linenos">43</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-brand"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">url</span> 'blogengine:index' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">44</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">45</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"collapse navbar-collapse"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header-nav"</span>&gt;</span>
<span class="linenos">46</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav"</span>&gt;</span>
<span class="linenos">47</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> flatpages %}</span><span class="xml">
<span class="linenos">48</span>                        </span><span class="hljs-template_tag">{% get_flatpages <span class="hljs-keyword">as</span> flatpages %}</span><span class="xml">
<span class="linenos">49</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> flatpage <span class="hljs-keyword">in</span> flatpages %}</span><span class="xml">
<span class="linenos">50</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ flatpage.url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ flatpage.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">51</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">52</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span>&gt;</span>RSS feed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">53</span>
<span class="linenos">54</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">"/search"</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"GET"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-form navbar-left"</span>&gt;</span>
<span class="linenos">55</span>                            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group"</span>&gt;</span>
<span class="linenos">56</span>                                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"q"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Search..."</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
<span class="linenos">57</span>                            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">58</span>                            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-default"</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="linenos">59</span>                        <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="linenos">60</span>                    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">61</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">62</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">63</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">64</span>
<span class="linenos">65</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
<span class="linenos">66</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> header %}</span><span class="xml">
<span class="linenos">67</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"page-header"</span>&gt;</span>
<span class="linenos">68</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">69</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">70</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
<span class="linenos">71</span>
<span class="linenos">72</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
<span class="linenos">73</span>                </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
<span class="linenos">74</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">75</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">76</span>
<span class="linenos">77</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container footer"</span>&gt;</span>
<span class="linenos">78</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
<span class="linenos">79</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"span12"</span>&gt;</span>
<span class="linenos">80</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Copyright &amp;copy; </span><span class="hljs-template_tag">{% <span class="hljs-keyword">now</span> "Y" %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">81</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">82</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">83</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">84</span>
<span class="linenos">85</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'js/all.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">86</span>
<span class="linenos">87</span>        <span class="hljs-comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
<span class="linenos">88</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="scheme">
<span class="linenos">89</span>            <span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">b</span>,o,i,l,e,r)</span>{b.GoogleAnalyticsObject=l<span class="hljs-comment">;b[l]||(b[l]=</span>
<span class="linenos">90</span>            function<span class="hljs-list">()</span>{<span class="hljs-list">(<span class="hljs-keyword">b</span><span class="hljs-list">[<span class="hljs-keyword">l</span>].q=b<span class="hljs-list">[<span class="hljs-keyword">l</span>].q||<span class="hljs-list">[]).push<span class="hljs-list">(<span class="hljs-keyword">arguments</span>)</span>})<span class="hljs-comment">;b[l].l=+new Date;</span>
<span class="linenos">91</span>            e=o.createElement<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span><span class="hljs-comment">;r=o.getElementsByTagName(i)[0];</span>
<span class="linenos">92</span>            e.src=<span class="hljs-variable">'//www.google-analytics.com/analytics.js</span>'<span class="hljs-comment">;</span>
<span class="linenos">93</span>            r.parentNode.insertBefore<span class="hljs-list">(<span class="hljs-keyword">e</span>,r)</span>}<span class="hljs-list">(<span class="hljs-keyword">window</span>,document,<span class="hljs-variable">'script</span>',<span class="hljs-variable">'ga</span>')</span>)<span class="hljs-comment">;</span>
<span class="linenos">94</span>            ga<span class="hljs-list">(<span class="hljs-variable">'create</span>',<span class="hljs-variable">'UA-XXXXX-X</span>')</span><span class="hljs-comment">;ga('send','pageview');</span>
<span class="linenos">95</span>        </span></span></span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">96</span>    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="linenos">97</span><span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></span></code></pre><p>Now, run the Grunt task:</p><pre><code class="hljs lang-bash singleline">$ grunt</code></pre><p>And collect the static files:</p><pre><code class="hljs lang-bash singleline">$ python manage.py collectstatic</code></pre><p>You’ll also want to add your <code>node_modules</code> folder to your <code>gitignore</code>:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>venv/
<span class="linenos">2</span>*.pyc
<span class="linenos">3</span>db.sqlite3
<span class="linenos">4</span>reports/
<span class="linenos">5</span>htmlcov/
<span class="linenos">6</span>.coverage
<span class="linenos">7</span>node_modules/</code></pre><p>Then commit your changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add .
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Optimised static assets'</span></code></pre><p>Now, our <code>package.json</code> will cause a problem - it will mean that this app is mistakenly identified as a Node.js app. To prevent this, create the <code>.slugignore</code> file:</p><pre><code class="hljs lang-bash singleline">package.json</code></pre><p>Then commit your changes and push them up:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add .slugignore
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Added slugignore'</span>
<span class="linenos">3</span>$ fab deploy</code></pre><p>If you check, your site should now be loading the minified versions of the static files.</p><p>That’s our site done! As usual I’ve tagged the final commit with <code>lesson-8</code>.</p><p>Sadly, that’s our final instalment over with! I hope you’ve enjoyed these tutorials, and I look forward to seeing what you create with them.</p></article><article class="post"><p class="date">25th August 2014 5:15 pm</p><h1><a href="/blog/2014/08/25/django-blog-tutorial-the-next-generation-part-7/">Django Blog Tutorial - the Next Generation - Part 7</a></h1><p>Hello once again! In this instalment we’ll cover:</p><ul><li>Caching your content with Memcached to improve your site’s performance</li><li>Refactoring and simplifying our tests</li><li>Implementing additional feeds</li><li>Creating a simple search engine</li></ul><p>Don’t forget to activate your virtualenv:</p><pre><code class="hljs lang-bash singleline">$ <span class="hljs-built_in">source</span> venv/bin/activate</code></pre><p>Now let’s get started!</p><h1 id="memcached">Memcached</h1><p>If you frequent (or used to frequent) social media sites like Reddit, Slashdot or Digg, you may be familiar with something called variously the Digg or Slashdot effect, whereby if a page gets submitted to a social media site, and subsequently becomes popular, it can be hit by a huge number of HTTP requests in a very short period of time, slowing it down or even taking the server down completely.</p><p>Now, as a general rule of thumb, for most dynamic websites such as blogs, the bottleneck is not the web server or the programming language, but the database. If you have a lot of people hitting the same page over and over again in quick succession, then you’re essentially running the same query over and over again and getting the same result each time, which is expensive in terms of processing power. What you need to be able to do is cache the results of the query in memory for a given period of time so that the number of queries is reduced.</p><p>That’s where Memcached comes in. It’s a simple key-value store that allows you to store values in memory for a given period of time so that they can be retrieved without having to query the database. Memcached is a very common choice for caching, and is by far the fastest and most efficient type of cache available for Django. It’s also available on Heroku’s free tier.</p><p>Django has a very powerful caching framework that supports numerous types of cache in addition to Memcached, such as:</p><ul><li>Database caching</li><li>Filesystem caching</li><li>Local memory caching</li></ul><p>There are also third-party backends for using other caching systems such as Redis.</p><p>Now, the cache can be used in a number of different ways. You can cache only certain parts of your site if you wish. However, because our site is heavily content-driven, we should be pretty safe to use the per-site cache, which is the simplest way to set up caching.</p><p>In order to set up Memcached, there’s a couple of Python libraries we’ll need. If you want to install them locally, however, you’ll need to install both memcached and libmemcached (on Ubuntu, the packages you need are called <code>memcached</code> and <code>libmemcached-dev</code>) on your development machine. If you don’t want to do this, then just copy and paste these lines into <code>requirements.txt</code> instead:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>django-pylibmc-sasl==<span class="hljs-number">0.2</span>.<span class="hljs-number">4</span>
<span class="linenos">2</span>pylibmc==<span class="hljs-number">1.3</span>.<span class="hljs-number">0</span></code></pre><p>If you are happy to install these dependencies locally, then run this command once memcached and libmemcached are installed:</p><pre><code class="hljs lang-bash singleline">$ pip install pylibmc django-pylibmc-sasl</code></pre><p>With that done let’s configure Memcached. Open up the settings file and add the following at the bottom:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_cache</span><span class="hljs-params">()</span>:</span>
<span class="linenos">2</span>  <span class="hljs-keyword">import</span> os
<span class="linenos">3</span>  <span class="hljs-keyword">try</span>:
<span class="linenos">4</span>    os.environ[<span class="hljs-string">'MEMCACHE_SERVERS'</span>] = os.environ[<span class="hljs-string">'MEMCACHIER_SERVERS'</span>].replace(<span class="hljs-string">','</span>, <span class="hljs-string">';'</span>)
<span class="linenos">5</span>    os.environ[<span class="hljs-string">'MEMCACHE_USERNAME'</span>] = os.environ[<span class="hljs-string">'MEMCACHIER_USERNAME'</span>]
<span class="linenos">6</span>    os.environ[<span class="hljs-string">'MEMCACHE_PASSWORD'</span>] = os.environ[<span class="hljs-string">'MEMCACHIER_PASSWORD'</span>]
<span class="linenos">7</span>    <span class="hljs-keyword">return</span> {
<span class="linenos">8</span>      <span class="hljs-string">'default'</span>: {
<span class="linenos">9</span>        <span class="hljs-string">'BACKEND'</span>: <span class="hljs-string">'django_pylibmc.memcached.PyLibMCCache'</span>,
<span class="linenos">10</span>        <span class="hljs-string">'TIMEOUT'</span>: <span class="hljs-number">300</span>,
<span class="linenos">11</span>        <span class="hljs-string">'BINARY'</span>: <span class="hljs-keyword">True</span>,
<span class="linenos">12</span>        <span class="hljs-string">'OPTIONS'</span>: { <span class="hljs-string">'tcp_nodelay'</span>: <span class="hljs-keyword">True</span> }
<span class="linenos">13</span>      }
<span class="linenos">14</span>    }
<span class="linenos">15</span>  <span class="hljs-keyword">except</span>:
<span class="linenos">16</span>    <span class="hljs-keyword">return</span> {
<span class="linenos">17</span>      <span class="hljs-string">'default'</span>: {
<span class="linenos">18</span>        <span class="hljs-string">'BACKEND'</span>: <span class="hljs-string">'django.core.cache.backends.locmem.LocMemCache'</span>
<span class="linenos">19</span>      }
<span class="linenos">20</span>    }
<span class="linenos">21</span>
<span class="linenos">22</span>CACHES = get_cache()
<span class="linenos">23</span>CACHE_MIDDLEWARE_ALIAS = <span class="hljs-string">'default'</span>
<span class="linenos">24</span>CACHE_MIDDLEWARE_SECONDS = <span class="hljs-number">300</span>
<span class="linenos">25</span>CACHE_MIDDLEWARE_KEY_PREFIX = <span class="hljs-string">''</span></code></pre><p>Then add the following to <code>MIDDLEWARE_CLASSES</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-string">'django.middleware.cache.UpdateCacheMiddleware'</span>,
<span class="linenos">2</span>    <span class="hljs-string">'django.middleware.common.CommonMiddleware'</span>,
<span class="linenos">3</span>    <span class="hljs-string">'django.middleware.cache.FetchFromCacheMiddleware'</span>,</code></pre><p>That’s it! The first section configures the application to use Memcached to cache the content when running on Heroku, and sets some configuration parameters, while the second section tells Django to use the per-site cache in order to cache all the site content.</p><p>Now, Heroku doesn’t include Memcached by default - instead it’s available as an add-on called Memcachier. To use add-ons you need to set up a credit card for billing. We will set it up to use the free developer plan, but if you outgrow this you can easily switch to a paid plan. To add Memcachier, run this command:</p><pre><code class="hljs lang-bash singleline">$ heroku addons:add memcachier:dev</code></pre><p>Please note that Memcachier can take a few minutes to get set up, so you may want to leave it a little while between adding it and pushing up your changes. Now we’ll commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add requirements.txt django_tutorial_blog_ng/settings.py
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Implemented caching with Memcached'</span></code></pre><p>Then we’ll push them up to our remote repository and to Heroku:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git push origin master
<span class="linenos">2</span>$ git push heroku master</code></pre><p>And that’s all you need to do to set up Memcached. In addition to storing your query results in Memcached, enabling the caching framework in Django will also set various HTTP headers to enable web proxies and browsers to cache content for an appropriate length of time. If you open up your browser’s developer tools and compare the response headers for your homepage on the latest version of the code with the previous version, you’ll notice that a number of additional headers appear, including <code>Cache-Control</code>, <code>Expires</code> and <code>Last-Modified</code>. These tell web browsers and web proxies how often to request the latest version of the HTML document, in order to help you reduce the bandwidth used.</p><p>As you can see, for a site like this where you are the only person adding content, it’s really easy to implement caching with Django, and for a blog there’s very little reason not to do it. If you’re not using Heroku and are instead hosting your site on a VPS, then the configuration will be somewhat different - see <a href="https://docs.djangoproject.com/en/1.6/topics/cache/#memcached">here</a> for details. You can also find information on using other cache backends on the same page.</p><p>That isn’t all you can do to speed up your site. Heroku doesn’t seem to be very good for serving static files, and if your site is attracting a lot of traffic you might want to host your static files elsewhere, such as on Amazon’s S3 service. Doing so is outside the scope of this tutorial, but for that use case, you should check out <a href="http://django-storages.readthedocs.org/en/latest/index.html">django-storages</a>.</p><h1 id="clearing-the-cache-automatically">Clearing the cache automatically</h1><p>There is one issue with this implementation. As it is right now, if you view the home page, add a post, then reload the page, you may not see the new post immediately because the cache will continue serving the old version until it has expired. That behaviour is less than ideal - we would like the cache to be cleared automatically when a new post gets added so that users will see the new version immediately. That response will still be cached afterwards, so it only means one extra query.</p><p>This is the ideal place to introduce <a href="https://docs.djangoproject.com/en/dev/topics/signals/">signals</a>. Signals are a way to carry out a given action when an event takes place. In our case, we plan to clear the cache when a post is saved (either created or updated).</p><p>Note that as we’ll be testing the behaviour of the cache at this point, you’ll need to install Memcached on your local machine, and we’ll need to change the settings to fall back to our local Memcached instance:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_cache</span><span class="hljs-params">()</span>:</span>
<span class="linenos">2</span>  <span class="hljs-keyword">import</span> os
<span class="linenos">3</span>  <span class="hljs-keyword">try</span>:
<span class="linenos">4</span>    os.environ[<span class="hljs-string">'MEMCACHE_SERVERS'</span>] = os.environ[<span class="hljs-string">'MEMCACHIER_SERVERS'</span>].replace(<span class="hljs-string">','</span>, <span class="hljs-string">';'</span>)
<span class="linenos">5</span>    os.environ[<span class="hljs-string">'MEMCACHE_USERNAME'</span>] = os.environ[<span class="hljs-string">'MEMCACHIER_USERNAME'</span>]
<span class="linenos">6</span>    os.environ[<span class="hljs-string">'MEMCACHE_PASSWORD'</span>] = os.environ[<span class="hljs-string">'MEMCACHIER_PASSWORD'</span>]
<span class="linenos">7</span>    <span class="hljs-keyword">return</span> {
<span class="linenos">8</span>      <span class="hljs-string">'default'</span>: {
<span class="linenos">9</span>        <span class="hljs-string">'BACKEND'</span>: <span class="hljs-string">'django_pylibmc.memcached.PyLibMCCache'</span>,
<span class="linenos">10</span>        <span class="hljs-string">'TIMEOUT'</span>: <span class="hljs-number">300</span>,
<span class="linenos">11</span>        <span class="hljs-string">'BINARY'</span>: <span class="hljs-keyword">True</span>,
<span class="linenos">12</span>        <span class="hljs-string">'OPTIONS'</span>: { <span class="hljs-string">'tcp_nodelay'</span>: <span class="hljs-keyword">True</span> }
<span class="linenos">13</span>      }
<span class="linenos">14</span>    }
<span class="linenos">15</span>  <span class="hljs-keyword">except</span>:
<span class="linenos">16</span>    <span class="hljs-keyword">return</span> {
<span class="linenos">17</span>      <span class="hljs-string">'default'</span>: {
<span class="linenos">18</span>        <span class="hljs-string">'BACKEND'</span>: <span class="hljs-string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,
<span class="linenos">19</span>        <span class="hljs-string">'LOCATION'</span>: <span class="hljs-string">'127.0.0.1:11211'</span>
<span class="linenos">20</span>      }
<span class="linenos">21</span>    }
<span class="linenos">22</span>
<span class="linenos">23</span>CACHES = get_cache()
<span class="linenos">24</span>CACHE_MIDDLEWARE_ALIAS = <span class="hljs-string">'default'</span>
<span class="linenos">25</span>CACHE_MIDDLEWARE_SECONDS = <span class="hljs-number">300</span>
<span class="linenos">26</span>CACHE_MIDDLEWARE_KEY_PREFIX = <span class="hljs-string">''</span></code></pre><p>If you don’t want to install Memcached locally, you can skip this step, but be aware that the test we write for clearing the cache will always pass if you do skip it.</p><p>Then we’ll run our tests to make sure nothing has been broken:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.......................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">23</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">6.164</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK</code></pre><p>Let’s commit:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add django_tutorial_blog_ng/settings.py
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use Memcached in development'</span></code></pre><p>Now we’ll add a test for clearing the cache to <code>PostViewTest</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_clear_cache</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">2</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">3</span>        category = Category()
<span class="linenos">4</span>        category.name = <span class="hljs-string">'python'</span>
<span class="linenos">5</span>        category.description = <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">6</span>        category.save()
<span class="linenos">7</span>
<span class="linenos">8</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">9</span>        tag = Tag()
<span class="linenos">10</span>        tag.name = <span class="hljs-string">'perl'</span>
<span class="linenos">11</span>        tag.description = <span class="hljs-string">'The Perl programming language'</span>
<span class="linenos">12</span>        tag.save()
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="hljs-comment"># Create the author</span>
<span class="linenos">15</span>        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
<span class="linenos">16</span>        author.save()
<span class="linenos">17</span>
<span class="linenos">18</span>        <span class="hljs-comment"># Create the site</span>
<span class="linenos">19</span>        site = Site()
<span class="linenos">20</span>        site.name = <span class="hljs-string">'example.com'</span>
<span class="linenos">21</span>        site.domain = <span class="hljs-string">'example.com'</span>
<span class="linenos">22</span>        site.save()
<span class="linenos">23</span>
<span class="linenos">24</span>        <span class="hljs-comment"># Create the first post</span>
<span class="linenos">25</span>        post = Post()
<span class="linenos">26</span>        post.title = <span class="hljs-string">'My first post'</span>
<span class="linenos">27</span>        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
<span class="linenos">28</span>        post.slug = <span class="hljs-string">'my-first-post'</span>
<span class="linenos">29</span>        post.pub_date = timezone.now()
<span class="linenos">30</span>        post.author = author
<span class="linenos">31</span>        post.site = site
<span class="linenos">32</span>        post.category = category
<span class="linenos">33</span>        post.save()
<span class="linenos">34</span>        post.tags.add(tag)
<span class="linenos">35</span>
<span class="linenos">36</span>        <span class="hljs-comment"># Check new post saved</span>
<span class="linenos">37</span>        all_posts = Post.objects.all()
<span class="linenos">38</span>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">39</span>
<span class="linenos">40</span>        <span class="hljs-comment"># Fetch the index</span>
<span class="linenos">41</span>        response = self.client.get(<span class="hljs-string">'/'</span>)
<span class="linenos">42</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">43</span>
<span class="linenos">44</span>        <span class="hljs-comment"># Create the second post</span>
<span class="linenos">45</span>        post = Post()
<span class="linenos">46</span>        post.title = <span class="hljs-string">'My second post'</span>
<span class="linenos">47</span>        post.text = <span class="hljs-string">'This is [my second blog post](http://127.0.0.1:8000/)'</span>
<span class="linenos">48</span>        post.slug = <span class="hljs-string">'my-second-post'</span>
<span class="linenos">49</span>        post.pub_date = timezone.now()
<span class="linenos">50</span>        post.author = author
<span class="linenos">51</span>        post.site = site
<span class="linenos">52</span>        post.category = category
<span class="linenos">53</span>        post.save()
<span class="linenos">54</span>        post.tags.add(tag)
<span class="linenos">55</span>
<span class="linenos">56</span>        <span class="hljs-comment"># Fetch the index again</span>
<span class="linenos">57</span>        response = self.client.get(<span class="hljs-string">'/'</span>)
<span class="linenos">58</span>
<span class="linenos">59</span>        <span class="hljs-comment"># Check second post present</span>
<span class="linenos">60</span>        self.assertTrue(<span class="hljs-string">'my second blog post'</span> <span class="hljs-keyword">in</span> response.content)</code></pre><p>This should be fairly self-explanatory. We create one post, and request the index page. We then add a second post, request the index page again, and check for the second post. The test should fail because the cached version is returned, rather than the version in the database.</p><p>Now we have a test in place, we can implement a fix. First, add this to the top of your <code>models.py</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.core.cache <span class="hljs-keyword">import</span> cache</code></pre><p>Then add the following at the bottom of the file:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>
<span class="linenos">2</span><span class="hljs-comment"># Define signals</span>
<span class="linenos">3</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_post</span><span class="hljs-params">(sender, instance, created, **kwargs)</span>:</span>
<span class="linenos">4</span>    cache.clear()
<span class="linenos">5</span>
<span class="linenos">6</span><span class="hljs-comment"># Set up signals</span>
<span class="linenos">7</span>post_save.connect(new_post, sender=Post)</code></pre><p>This is fairly straightforward. What we’re doing is first defining a function called <code>new_post</code> that is called when a new post is created. We then connect it to the <code>post_save</code> signal. When a post is saved, it calls <code>new_post</code>, which clears the cache, making sure users are seeing the latest and greatest version of your site immediately.</p><p>Let’s test it:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">8.473</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>There are a number of signals available, and when you create one, you have access to the created object via the <code>instance</code> parameter. Using signals you can implement all kinds of functionality. For instance, you could implement the functionality to send an email when a new post is published.</p><p>If you’re using Travis CI, you’ll also need to update the config file:</p><pre><code class="hljs lang-yaml"><span class="linenos">1</span><span class="hljs-label">language:</span> python
<span class="linenos">2</span><span class="hljs-label">python:</span>
<span class="linenos">3</span>- <span class="hljs-string">"2.7"</span>
<span class="linenos">4</span><span class="hljs-label">services:</span> memcached
<span class="linenos">5</span><span class="hljs-label">before_install:</span>
<span class="linenos">6</span>    - sudo apt-get install -<span class="hljs-built_in">y</span> libmemcached-dev
<span class="linenos">7</span><span class="hljs-preprocessor"># command to install dependencies</span>
<span class="linenos">8</span><span class="hljs-label">install:</span> <span class="hljs-string">"pip install -r requirements.txt"</span>
<span class="linenos">9</span><span class="hljs-preprocessor"># command to run tests</span>
<span class="linenos">10</span><span class="hljs-label">script:</span> coverage run --include=<span class="hljs-string">"blogengine/*"</span> --omit=<span class="hljs-string">"blogengine/migrations/*"</span> manage.py test blogengine
<span class="linenos">11</span><span class="hljs-label">after_success:</span>
<span class="linenos">12</span>    coveralls</code></pre><p>Time to commit:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/ .travis.yml
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now clear cache when post added'</span></code></pre><h1 id="formatting-for-rss-feeds">Formatting for RSS feeds</h1><p>Now, we want to offer more than one option for RSS feeds. For instance, if your blog is aggregated on a site such as <a href="http://planet.python.org/">Planet Python</a>, but you also blog about JavaScript, you may want to be able to provide a feed for posts in the <code>python</code> category only.</p><p>If you have written any posts that use any of Markdown’s custom formatting, you may notice that if you load your RSS feed in a reader, it isn’t formatted as Markdown. Let’s fix that. First we’ll amend our test:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeedTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_all_post_feed</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">3</span>        <span class="hljs-comment"># Create the category</span>
<span class="linenos">4</span>        category = Category()
<span class="linenos">5</span>        category.name = <span class="hljs-string">'python'</span>
<span class="linenos">6</span>        category.description = <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">7</span>        category.save()
<span class="linenos">8</span>
<span class="linenos">9</span>        <span class="hljs-comment"># Create the tag</span>
<span class="linenos">10</span>        tag = Tag()
<span class="linenos">11</span>        tag.name = <span class="hljs-string">'python'</span>
<span class="linenos">12</span>        tag.description = <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">13</span>        tag.save()
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="hljs-comment"># Create the author</span>
<span class="linenos">16</span>        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
<span class="linenos">17</span>        author.save()
<span class="linenos">18</span>
<span class="linenos">19</span>        <span class="hljs-comment"># Create the site</span>
<span class="linenos">20</span>        site = Site()
<span class="linenos">21</span>        site.name = <span class="hljs-string">'example.com'</span>
<span class="linenos">22</span>        site.domain = <span class="hljs-string">'example.com'</span>
<span class="linenos">23</span>        site.save()
<span class="linenos">24</span>
<span class="linenos">25</span>        <span class="hljs-comment"># Create a post</span>
<span class="linenos">26</span>        post = Post()
<span class="linenos">27</span>        post.title = <span class="hljs-string">'My first post'</span>
<span class="linenos">28</span>        post.text = <span class="hljs-string">'This is my *first* blog post'</span>
<span class="linenos">29</span>        post.slug = <span class="hljs-string">'my-first-post'</span>
<span class="linenos">30</span>        post.pub_date = timezone.now()
<span class="linenos">31</span>        post.author = author
<span class="linenos">32</span>        post.site = site
<span class="linenos">33</span>        post.category = category
<span class="linenos">34</span>
<span class="linenos">35</span>        <span class="hljs-comment"># Save it</span>
<span class="linenos">36</span>        post.save()
<span class="linenos">37</span>
<span class="linenos">38</span>        <span class="hljs-comment"># Add the tag</span>
<span class="linenos">39</span>        post.tags.add(tag)
<span class="linenos">40</span>        post.save()
<span class="linenos">41</span>
<span class="linenos">42</span>        <span class="hljs-comment"># Check we can find it</span>
<span class="linenos">43</span>        all_posts = Post.objects.all()
<span class="linenos">44</span>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
<span class="linenos">45</span>        only_post = all_posts[<span class="hljs-number">0</span>]
<span class="linenos">46</span>        self.assertEquals(only_post, post)
<span class="linenos">47</span>
<span class="linenos">48</span>        <span class="hljs-comment"># Fetch the feed</span>
<span class="linenos">49</span>        response = self.client.get(<span class="hljs-string">'/feeds/posts/'</span>)
<span class="linenos">50</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">51</span>
<span class="linenos">52</span>        <span class="hljs-comment"># Parse the feed</span>
<span class="linenos">53</span>        feed = feedparser.parse(response.content)
<span class="linenos">54</span>
<span class="linenos">55</span>        <span class="hljs-comment"># Check length</span>
<span class="linenos">56</span>        self.assertEquals(len(feed.entries), <span class="hljs-number">1</span>)
<span class="linenos">57</span>
<span class="linenos">58</span>        <span class="hljs-comment"># Check post retrieved is the correct one</span>
<span class="linenos">59</span>        feed_post = feed.entries[<span class="hljs-number">0</span>]
<span class="linenos">60</span>        self.assertEquals(feed_post.title, post.title)
<span class="linenos">61</span>        self.assertTrue(<span class="hljs-string">'This is my &lt;em&gt;first&lt;/em&gt; blog post'</span> <span class="hljs-keyword">in</span> feed_post.description)</code></pre><p>Don’t forget to run the tests to make sure they fail. Now, let’s fix it:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="linenos">3</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post, Tag
<span class="linenos">4</span><span class="hljs-keyword">from</span> django.contrib.syndication.views <span class="hljs-keyword">import</span> Feed
<span class="linenos">5</span><span class="hljs-keyword">from</span> django.utils.encoding <span class="hljs-keyword">import</span> force_unicode
<span class="linenos">6</span><span class="hljs-keyword">from</span> django.utils.safestring <span class="hljs-keyword">import</span> mark_safe
<span class="linenos">7</span><span class="hljs-keyword">import</span> markdown2
<span class="linenos">8</span>
<span class="linenos">9</span><span class="hljs-comment"># Create your views here.</span>
<span class="linenos">10</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
<span class="linenos">11</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">12</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">13</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">14</span>            category = Category.objects.get(slug=slug)
<span class="linenos">15</span>            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
<span class="linenos">16</span>        <span class="hljs-keyword">except</span> Category.DoesNotExist:
<span class="linenos">17</span>            <span class="hljs-keyword">return</span> Post.objects.none()
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagListView</span><span class="hljs-params">(ListView)</span>:</span>
<span class="linenos">21</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">22</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">23</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">24</span>            tag = Tag.objects.get(slug=slug)
<span class="linenos">25</span>            <span class="hljs-keyword">return</span> tag.post_set.all()
<span class="linenos">26</span>        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
<span class="linenos">27</span>            <span class="hljs-keyword">return</span> Post.objects.none()
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostsFeed</span><span class="hljs-params">(Feed)</span>:</span>
<span class="linenos">31</span>    title = <span class="hljs-string">"RSS feed - posts"</span>
<span class="linenos">32</span>    link = <span class="hljs-string">"feeds/posts/"</span>
<span class="linenos">33</span>    description = <span class="hljs-string">"RSS feed - blog posts"</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">36</span>        <span class="hljs-keyword">return</span> Post.objects.order_by(<span class="hljs-string">'-pub_date'</span>)
<span class="linenos">37</span>
<span class="linenos">38</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_title</span><span class="hljs-params">(self, item)</span>:</span>
<span class="linenos">39</span>        <span class="hljs-keyword">return</span> item.title
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_description</span><span class="hljs-params">(self, item)</span>:</span>
<span class="linenos">42</span>        extras = [<span class="hljs-string">"fenced-code-blocks"</span>]
<span class="linenos">43</span>        content = mark_safe(markdown2.markdown(force_unicode(item.text),
<span class="linenos">44</span>                                               extras = extras))
<span class="linenos">45</span>        <span class="hljs-keyword">return</span> content</code></pre><p>All we’re doing here is amending the <code>item_description</code> method of <code>PostsFeed</code> to render it as Markdown. Now let’s run our tests again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">9.370</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>With that done, we’ll commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Fixed rendering for post feed'</span></code></pre><h1 id="refactoring-our-tests">Refactoring our tests</h1><p>Now, before we get into implementing the feed, our tests are a bit verbose. We create a lot of items over and over again - let’s sort that out. Factory Boy is a handy Python module that allows you to create easy-to-use factories for creating objects over and over again in tests. Let’s install it:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ pip install factory_boy
<span class="linenos">2</span>$ pip freeze &gt; requirements.txt
<span class="linenos">3</span>$ git add requirements.txt
<span class="linenos">4</span>$ git commit -m <span class="hljs-string">'Installed Factory Boy'</span></code></pre><p>Now let’s set up a factory for creating posts. Add this at the top of the test file:</p><pre><code class="hljs lang-python singleline"><span class="hljs-keyword">import</span> factory.django</code></pre><p>Then, before your actual tests, insert the following:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-comment"># Factories</span>
<span class="linenos">2</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteFactory</span><span class="hljs-params">(factory.django.DjangoModelFactory)</span>:</span>
<span class="linenos">3</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
<span class="linenos">4</span>        model = Site
<span class="linenos">5</span>        django_get_or_create = (
<span class="linenos">6</span>            <span class="hljs-string">'name'</span>,
<span class="linenos">7</span>            <span class="hljs-string">'domain'</span>
<span class="linenos">8</span>        )
<span class="linenos">9</span>
<span class="linenos">10</span>    name = <span class="hljs-string">'example.com'</span>
<span class="linenos">11</span>    domain = <span class="hljs-string">'example.com'</span></code></pre><p>Now, wherever you call <code>Site()</code>, add its attributes, and save it, replace those lines with the following:</p><pre><code class="hljs lang-python singleline">        site = SiteFactory()</code></pre><p>Much simpler and more concise, I’m sure you’ll agree! Now, let’s run the tests to make sure they aren’t broken:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.482</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Let’s commit again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/tests.py
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use Factory Boy for site objects'</span></code></pre><p>Let’s do the same thing with <code>Category</code> objects:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryFactory</span><span class="hljs-params">(factory.django.DjangoModelFactory)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
<span class="linenos">3</span>        model = Category
<span class="linenos">4</span>        django_get_or_create = (
<span class="linenos">5</span>            <span class="hljs-string">'name'</span>,
<span class="linenos">6</span>            <span class="hljs-string">'description'</span>,
<span class="linenos">7</span>            <span class="hljs-string">'slug'</span>
<span class="linenos">8</span>        )
<span class="linenos">9</span>
<span class="linenos">10</span>    name = <span class="hljs-string">'python'</span>
<span class="linenos">11</span>    description = <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">12</span>    slug = <span class="hljs-string">'python'</span></code></pre><p>Again, just find every time we call <code>Category()</code> and replace it with the following:</p><pre><code class="hljs lang-python singleline">        category = CategoryFactory()</code></pre><p>Now if we run our tests, we’ll notice a serious error:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>EE..EE.EE.EE...E.EEE..E.
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>ERROR: <span class="hljs-built_in">test</span>_create_category (blogengine.tests.PostTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">42</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_category
<span class="linenos">9</span>    category = CategoryFactory()
<span class="linenos">10</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">11</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">12</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">13</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">14</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">15</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">16</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">17</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">18</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">19</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">20</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">21</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">22</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">23</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">24</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">25</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">26</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">27</span>
<span class="linenos">28</span>======================================================================
<span class="linenos">29</span>ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.PostTest)
<span class="linenos">30</span>----------------------------------------------------------------------
<span class="linenos">31</span>Traceback (most recent call last):
<span class="linenos">32</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">80</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
<span class="linenos">33</span>    category = CategoryFactory()
<span class="linenos">34</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">35</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">36</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">37</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">38</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">39</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">40</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">41</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">42</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">43</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">44</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">45</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">46</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">47</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">48</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">49</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">50</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">51</span>
<span class="linenos">52</span>======================================================================
<span class="linenos">53</span>ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
<span class="linenos">54</span>----------------------------------------------------------------------
<span class="linenos">55</span>Traceback (most recent call last):
<span class="linenos">56</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">339</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
<span class="linenos">57</span>    category = CategoryFactory()
<span class="linenos">58</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">59</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">60</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">61</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">62</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">63</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">64</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">65</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">66</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">67</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">68</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">69</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">70</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">71</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">72</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">73</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">74</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">75</span>
<span class="linenos">76</span>======================================================================
<span class="linenos">77</span>ERROR: <span class="hljs-built_in">test</span>_create_post_without_tag (blogengine.tests.AdminTest)
<span class="linenos">78</span>----------------------------------------------------------------------
<span class="linenos">79</span>Traceback (most recent call last):
<span class="linenos">80</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">378</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post_without_tag
<span class="linenos">81</span>    category = CategoryFactory()
<span class="linenos">82</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">83</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">84</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">85</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">86</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">87</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">88</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">89</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">90</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">91</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">92</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">93</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">94</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">95</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">96</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">97</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">98</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">99</span>
<span class="linenos">100</span>======================================================================
<span class="linenos">101</span>ERROR: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
<span class="linenos">102</span>----------------------------------------------------------------------
<span class="linenos">103</span>Traceback (most recent call last):
<span class="linenos">104</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">245</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
<span class="linenos">105</span>    category = CategoryFactory()
<span class="linenos">106</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">107</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">108</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">109</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">110</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">111</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">112</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">113</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">114</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">115</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">116</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">117</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">118</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">119</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">120</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">121</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">122</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">123</span>
<span class="linenos">124</span>======================================================================
<span class="linenos">125</span>ERROR: <span class="hljs-built_in">test</span>_delete_post (blogengine.tests.AdminTest)
<span class="linenos">126</span>----------------------------------------------------------------------
<span class="linenos">127</span>Traceback (most recent call last):
<span class="linenos">128</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">467</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_post
<span class="linenos">129</span>    category = CategoryFactory()
<span class="linenos">130</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">131</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">132</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">133</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">134</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">135</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">136</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">137</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">138</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">139</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">140</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">141</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">142</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">143</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">144</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">145</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">146</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">147</span>
<span class="linenos">148</span>======================================================================
<span class="linenos">149</span>ERROR: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
<span class="linenos">150</span>----------------------------------------------------------------------
<span class="linenos">151</span>Traceback (most recent call last):
<span class="linenos">152</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">221</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
<span class="linenos">153</span>    category = CategoryFactory()
<span class="linenos">154</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">155</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">156</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">157</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">158</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">159</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">160</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">161</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">162</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">163</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">164</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">165</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">166</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">167</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">168</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">169</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">170</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">171</span>
<span class="linenos">172</span>======================================================================
<span class="linenos">173</span>ERROR: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
<span class="linenos">174</span>----------------------------------------------------------------------
<span class="linenos">175</span>Traceback (most recent call last):
<span class="linenos">176</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">410</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
<span class="linenos">177</span>    category = CategoryFactory()
<span class="linenos">178</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">179</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">180</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">181</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">182</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">183</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">184</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">185</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">186</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">187</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">188</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">189</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">190</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">191</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">192</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">193</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">194</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">195</span>
<span class="linenos">196</span>======================================================================
<span class="linenos">197</span>ERROR: <span class="hljs-built_in">test</span>_all_post_feed (blogengine.tests.FeedTest)
<span class="linenos">198</span>----------------------------------------------------------------------
<span class="linenos">199</span>Traceback (most recent call last):
<span class="linenos">200</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">810</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_all_post_feed
<span class="linenos">201</span>    category = CategoryFactory()
<span class="linenos">202</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">203</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">204</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">205</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">206</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">207</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">208</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">209</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">210</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">211</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">212</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">213</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">214</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">215</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">216</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">217</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">218</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">219</span>
<span class="linenos">220</span>======================================================================
<span class="linenos">221</span>ERROR: <span class="hljs-built_in">test</span>_category_page (blogengine.tests.PostViewTest)
<span class="linenos">222</span>----------------------------------------------------------------------
<span class="linenos">223</span>Traceback (most recent call last):
<span class="linenos">224</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">640</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_category_page
<span class="linenos">225</span>    category = CategoryFactory()
<span class="linenos">226</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">227</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">228</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">229</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">230</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">231</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">232</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">233</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">234</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">235</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">236</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">237</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">238</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">239</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">240</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">241</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">242</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">243</span>
<span class="linenos">244</span>======================================================================
<span class="linenos">245</span>ERROR: <span class="hljs-built_in">test</span>_clear_cache (blogengine.tests.PostViewTest)
<span class="linenos">246</span>----------------------------------------------------------------------
<span class="linenos">247</span>Traceback (most recent call last):
<span class="linenos">248</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">753</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_clear_cache
<span class="linenos">249</span>    category = CategoryFactory()
<span class="linenos">250</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">251</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">252</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">253</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">254</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">255</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">256</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">257</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">258</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">259</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">260</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">261</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">262</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">263</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">264</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">265</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">266</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">267</span>
<span class="linenos">268</span>======================================================================
<span class="linenos">269</span>ERROR: <span class="hljs-built_in">test</span>_index (blogengine.tests.PostViewTest)
<span class="linenos">270</span>----------------------------------------------------------------------
<span class="linenos">271</span>Traceback (most recent call last):
<span class="linenos">272</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">518</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_index
<span class="linenos">273</span>    category = CategoryFactory()
<span class="linenos">274</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">275</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">276</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">277</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">278</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">279</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">280</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">281</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">282</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">283</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">284</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">285</span>
<span class="linenos">286</span>
<span class="linenos">287</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">288</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">289</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">290</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">291</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">292</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">293</span>
<span class="linenos">294</span>======================================================================
<span class="linenos">295</span>ERROR: <span class="hljs-built_in">test</span>_post_page (blogengine.tests.PostViewTest)
<span class="linenos">296</span>----------------------------------------------------------------------
<span class="linenos">297</span>Traceback (most recent call last):
<span class="linenos">298</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">576</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_post_page
<span class="linenos">299</span>    category = CategoryFactory()
<span class="linenos">300</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">82</span>, <span class="hljs-keyword">in</span> __call__
<span class="linenos">301</span>    <span class="hljs-built_in">return</span> cls.create(**kwargs)
<span class="linenos">302</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">585</span>, <span class="hljs-keyword">in</span> create
<span class="linenos">303</span>    <span class="hljs-built_in">return</span> cls._generate(True, attrs)
<span class="linenos">304</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">510</span>, <span class="hljs-keyword">in</span> _generate
<span class="linenos">305</span>    obj = cls._prepare(create, **attrs)
<span class="linenos">306</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py"</span>, line <span class="hljs-number">485</span>, <span class="hljs-keyword">in</span> _prepare
<span class="linenos">307</span>    <span class="hljs-built_in">return</span> cls._create(model_class, *args, **kwargs)
<span class="linenos">308</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">151</span>, <span class="hljs-keyword">in</span> _create
<span class="linenos">309</span>
<span class="linenos">310</span>
<span class="linenos">311</span>    <span class="hljs-built_in">return</span> cls._get_or_create(model_class, *args, **kwargs)
<span class="linenos">312</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> _get_or_create
<span class="linenos">313</span>    obj, _created = manager.get_or_create(*args, **key_fields)
<span class="linenos">314</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">315</span>    <span class="hljs-built_in">return</span> self.get_queryset().get_or_create(**kwargs)
<span class="linenos">316</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">383</span>, <span class="hljs-keyword">in</span> get_or_create
<span class="linenos">317</span>    obj.save(force_insert=True, using=self.db)
<span class="linenos">318</span>TypeError: save() got an unexpected keyword argument <span class="hljs-string">'force_insert'</span>
<span class="linenos">319</span>
<span class="linenos">320</span>----------------------------------------------------------------------
<span class="linenos">321</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.162</span>s
<span class="linenos">322</span>
<span class="linenos">323</span>FAILED (errors=<span class="hljs-number">13</span>)
<span class="linenos">324</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Thankfully, this is easy to fix. We just need to amend the custom <code>save()</code> method of the <code>Category</code> model:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self, *args, **kwargs)</span>:</span>
<span class="linenos">2</span>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.slug:
<span class="linenos">3</span>            self.slug = slugify(unicode(self.name))
<span class="linenos">4</span>        super(Category, self).save(*args, **kwargs)</code></pre><p>That should resolve the issue:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.749</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Let’s commit again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Category now uses Factory Boy'</span></code></pre><p>Now let’s do the same thing for tags:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagFactory</span><span class="hljs-params">(factory.django.DjangoModelFactory)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
<span class="linenos">3</span>        model = Tag
<span class="linenos">4</span>        django_get_or_create = (
<span class="linenos">5</span>            <span class="hljs-string">'name'</span>,
<span class="linenos">6</span>            <span class="hljs-string">'description'</span>,
<span class="linenos">7</span>            <span class="hljs-string">'slug'</span>
<span class="linenos">8</span>        )
<span class="linenos">9</span>
<span class="linenos">10</span>    name = <span class="hljs-string">'python'</span>
<span class="linenos">11</span>    description = <span class="hljs-string">'The Python programming language'</span>
<span class="linenos">12</span>    slug = <span class="hljs-string">'python'</span></code></pre><p>And replace the sections where we create new <code>Tag</code> objects:</p><pre><code class="hljs lang-python singleline">        tag = TagFactory()</code></pre><p>Note that some tags have different values. We can easily pass different values to our <code>TagFactory()</code> to override the default values:</p><pre><code class="hljs lang-python singleline">        tag = TagFactory(name=<span class="hljs-string">'perl'</span>, description=<span class="hljs-string">'The Perl programming language'</span>)</code></pre><p>The <code>Tag</code> model has the same issue as the <code>Category</code> one did, so let’s fix that:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self, *args, **kwargs)</span>:</span>
<span class="linenos">2</span>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.slug:
<span class="linenos">3</span>            self.slug = slugify(unicode(self.name))
<span class="linenos">4</span>        super(Tag, self).save(*args, **kwargs)</code></pre><p>We run our tests again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine/
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.153</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Time to commit again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use Factory Boy for tags'</span></code></pre><p>Next we’ll create a factory for adding users. Note that the factory name doesn’t have to match the object name, so you can create factories for different types of users. Here we create a factory for authors - you could, for instance, create a separate factory for subscribers if you wanted:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthorFactory</span><span class="hljs-params">(factory.django.DjangoModelFactory)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
<span class="linenos">3</span>        model = User
<span class="linenos">4</span>        django_get_or_create = (<span class="hljs-string">'username'</span>,<span class="hljs-string">'email'</span>, <span class="hljs-string">'password'</span>,)
<span class="linenos">5</span>
<span class="linenos">6</span>    username = <span class="hljs-string">'testuser'</span>
<span class="linenos">7</span>    email = <span class="hljs-string">'user@example.com'</span>
<span class="linenos">8</span>    password = <span class="hljs-string">'password'</span></code></pre><p>And as before, replace those sections where we create users with the following:</p><pre><code class="hljs lang-python singleline">        author = AuthorFactory()</code></pre><p>Run the tests again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.808</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>We commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use Factory Boy for creating authors'</span></code></pre><p>Now we’ll create a flat page factory:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlatPageFactory</span><span class="hljs-params">(factory.django.DjangoModelFactory)</span>:</span>
<span class="linenos">4</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
<span class="linenos">5</span>        model = FlatPage
<span class="linenos">6</span>        django_get_or_create = (
<span class="linenos">7</span>            <span class="hljs-string">'url'</span>,
<span class="linenos">8</span>            <span class="hljs-string">'title'</span>,
<span class="linenos">9</span>            <span class="hljs-string">'content'</span>
<span class="linenos">10</span>        )
<span class="linenos">11</span>
<span class="linenos">12</span>    url = <span class="hljs-string">'/about/'</span>
<span class="linenos">13</span>    title = <span class="hljs-string">'About me'</span>
<span class="linenos">14</span>    content = <span class="hljs-string">'All about me'</span></code></pre><p>And use it for our flat page test:</p><pre><code class="hljs lang-python singleline">        page = FlatPageFactory()</code></pre><p>Check the tests pass:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">24</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.796</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>And commit again:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use Factory Boy for flat page test'</span></code></pre><p>Now we’ll create a final factory for posts:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostFactory</span><span class="hljs-params">(factory.django.DjangoModelFactory)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
<span class="linenos">3</span>        model = Post
<span class="linenos">4</span>        django_get_or_create = (
<span class="linenos">5</span>            <span class="hljs-string">'title'</span>,
<span class="linenos">6</span>            <span class="hljs-string">'text'</span>,
<span class="linenos">7</span>            <span class="hljs-string">'slug'</span>,
<span class="linenos">8</span>            <span class="hljs-string">'pub_date'</span>
<span class="linenos">9</span>        )
<span class="linenos">10</span>
<span class="linenos">11</span>    title = <span class="hljs-string">'My first post'</span>
<span class="linenos">12</span>    text = <span class="hljs-string">'This is my first blog post'</span>
<span class="linenos">13</span>    slug = <span class="hljs-string">'my-first-post'</span>
<span class="linenos">14</span>    pub_date = timezone.now()
<span class="linenos">15</span>    author = factory.SubFactory(AuthorFactory)
<span class="linenos">16</span>    site = factory.SubFactory(SiteFactory)
<span class="linenos">17</span>    category = factory.SubFactory(CategoryFactory)</code></pre><p>This factory is a little bit different. Because our <code>Post</code> model depends on several others, we need to be able to create those additional objects on demand. By designating them as subfactories, we can easily create the associated objects for our <code>Post</code> object.</p><p>That means that not only can we get rid of our <code>Post()</code> calls, but we can also get rid of the factory calls to create the associated objects for <code>Post</code> models. Again, I’ll leave actually doing this as an exercise for the reader, but you can always refer to the GitHub repository if you’re not too sure.</p><p>Make sure your tests still pass, then commit the changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Now use Factory Boy for testing posts'</span></code></pre><p>Using Factory Boy made a big difference to the size of the test file - I was able to cut it down by over 200 lines of code. As your application gets bigger, it gets harder to maintain, so do what you can to keep the size down.</p><h1 id="additional-rss-feeds">Additional RSS feeds</h1><p>Now, let’s implement our additional RSS feeds. First, we’ll write a test for the category feed. Add this to the <code>FeedTest</code> class:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_category_feed</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">2</span>        <span class="hljs-comment"># Create a post</span>
<span class="linenos">3</span>        post = PostFactory(text=<span class="hljs-string">'This is my *first* blog post'</span>)
<span class="linenos">4</span>
<span class="linenos">5</span>        <span class="hljs-comment"># Create another post in a different category</span>
<span class="linenos">6</span>        category = CategoryFactory(name=<span class="hljs-string">'perl'</span>, description=<span class="hljs-string">'The Perl programming language'</span>, slug=<span class="hljs-string">'perl'</span>)
<span class="linenos">7</span>        post2 = PostFactory(text=<span class="hljs-string">'This is my *second* blog post'</span>, title=<span class="hljs-string">'My second post'</span>, slug=<span class="hljs-string">'my-second-post'</span>, category=category)
<span class="linenos">8</span>
<span class="linenos">9</span>        <span class="hljs-comment"># Fetch the feed</span>
<span class="linenos">10</span>        response = self.client.get(<span class="hljs-string">'/feeds/posts/category/python/'</span>)
<span class="linenos">11</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">12</span>
<span class="linenos">13</span>        <span class="hljs-comment"># Parse the feed</span>
<span class="linenos">14</span>        feed = feedparser.parse(response.content)
<span class="linenos">15</span>
<span class="linenos">16</span>        <span class="hljs-comment"># Check length</span>
<span class="linenos">17</span>        self.assertEquals(len(feed.entries), <span class="hljs-number">1</span>)
<span class="linenos">18</span>
<span class="linenos">19</span>        <span class="hljs-comment"># Check post retrieved is the correct one</span>
<span class="linenos">20</span>        feed_post = feed.entries[<span class="hljs-number">0</span>]
<span class="linenos">21</span>        self.assertEquals(feed_post.title, post.title)
<span class="linenos">22</span>        self.assertTrue(<span class="hljs-string">'This is my &lt;em&gt;first&lt;/em&gt; blog post'</span> <span class="hljs-keyword">in</span> feed_post.description)
<span class="linenos">23</span>
<span class="linenos">24</span>        <span class="hljs-comment"># Check other post is not in this feed</span>
<span class="linenos">25</span>        self.assertTrue(<span class="hljs-string">'This is my &lt;em&gt;second&lt;/em&gt; blog post'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> response.content)</code></pre><p>Here we create two posts in different categories (note that we create a new category and override the post category for it). We then fetch <code>/feeds/posts/category/python/</code> and assert that it contains only one post, with the content of the first post and not the content of the second.</p><p>Run the tests and they should fail:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>................F........
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>FAIL: <span class="hljs-built_in">test</span>_category_feed (blogengine.tests.FeedTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">716</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_category_feed
<span class="linenos">9</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">11</span>
<span class="linenos">12</span>----------------------------------------------------------------------
<span class="linenos">13</span>Ran <span class="hljs-number">25</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.804</span>s
<span class="linenos">14</span>
<span class="linenos">15</span>FAILED (failures=<span class="hljs-number">1</span>)
<span class="linenos">16</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Because we haven’t yet implemented that route, we get a 404 error. So let’s create a route for this:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="linenos">3</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category, Tag
<span class="linenos">4</span><span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView, PostsFeed, CategoryPostsFeed
<span class="linenos">5</span>
<span class="linenos">6</span>urlpatterns = patterns(<span class="hljs-string">''</span>,
<span class="linenos">7</span>    <span class="hljs-comment"># Index</span>
<span class="linenos">8</span>    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
<span class="linenos">9</span>        model=Post,
<span class="linenos">10</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">11</span>        )),
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="hljs-comment"># Individual posts</span>
<span class="linenos">14</span>    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
<span class="linenos">15</span>        model=Post,
<span class="linenos">16</span>        )),
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="hljs-comment"># Categories</span>
<span class="linenos">19</span>    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
<span class="linenos">20</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">21</span>        model=Category,
<span class="linenos">22</span>        )),
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="hljs-comment"># Tags</span>
<span class="linenos">25</span>    url(<span class="hljs-string">r'^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagListView.as_view(
<span class="linenos">26</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">27</span>        model=Tag,
<span class="linenos">28</span>        )),
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="hljs-comment"># Post RSS feed</span>
<span class="linenos">31</span>    url(<span class="hljs-string">r'^feeds/posts/$'</span>, PostsFeed()),
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="hljs-comment"># Category RSS feed</span>
<span class="linenos">34</span>    url(<span class="hljs-string">r'^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryPostsFeed()),
<span class="linenos">35</span>)</code></pre><p>Note that the category RSS feed route is similar to the post RSS feed route, but accepts a <code>slug</code> parameter. We will use this to pass through the slug for the category in question. Also note we import the <code>CategoryPostsFeed</code> view. Now, we need to create that view. Fortunately, because it’s written as a Python class, we can extend the existing <code>PostsFeed</code> class. Open up your views file and amend it to look like this:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> get_object_or_404
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="linenos">3</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post, Tag
<span class="linenos">4</span><span class="hljs-keyword">from</span> django.contrib.syndication.views <span class="hljs-keyword">import</span> Feed
<span class="linenos">5</span><span class="hljs-keyword">from</span> django.utils.encoding <span class="hljs-keyword">import</span> force_unicode
<span class="linenos">6</span><span class="hljs-keyword">from</span> django.utils.safestring <span class="hljs-keyword">import</span> mark_safe
<span class="linenos">7</span><span class="hljs-keyword">import</span> markdown2
<span class="linenos">8</span>
<span class="linenos">9</span><span class="hljs-comment"># Create your views here.</span>
<span class="linenos">10</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
<span class="linenos">11</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">12</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">13</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">14</span>            category = Category.objects.get(slug=slug)
<span class="linenos">15</span>            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
<span class="linenos">16</span>        <span class="hljs-keyword">except</span> Category.DoesNotExist:
<span class="linenos">17</span>            <span class="hljs-keyword">return</span> Post.objects.none()
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagListView</span><span class="hljs-params">(ListView)</span>:</span>
<span class="linenos">21</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">22</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">23</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">24</span>            tag = Tag.objects.get(slug=slug)
<span class="linenos">25</span>            <span class="hljs-keyword">return</span> tag.post_set.all()
<span class="linenos">26</span>        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
<span class="linenos">27</span>            <span class="hljs-keyword">return</span> Post.objects.none()
<span class="linenos">28</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostsFeed</span><span class="hljs-params">(Feed)</span>:</span>
<span class="linenos">31</span>    title = <span class="hljs-string">"RSS feed - posts"</span>
<span class="linenos">32</span>    description = <span class="hljs-string">"RSS feed - blog posts"</span>
<span class="linenos">33</span>    link = <span class="hljs-string">'/'</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">36</span>        <span class="hljs-keyword">return</span> Post.objects.order_by(<span class="hljs-string">'-pub_date'</span>)
<span class="linenos">37</span>
<span class="linenos">38</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_title</span><span class="hljs-params">(self, item)</span>:</span>
<span class="linenos">39</span>        <span class="hljs-keyword">return</span> item.title
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_description</span><span class="hljs-params">(self, item)</span>:</span>
<span class="linenos">42</span>        extras = [<span class="hljs-string">"fenced-code-blocks"</span>]
<span class="linenos">43</span>        content = mark_safe(markdown2.markdown(force_unicode(item.text),
<span class="linenos">44</span>                                               extras = extras))
<span class="linenos">45</span>        <span class="hljs-keyword">return</span> content
<span class="linenos">46</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryPostsFeed</span><span class="hljs-params">(PostsFeed)</span>:</span>
<span class="linenos">49</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_object</span><span class="hljs-params">(self, request, slug)</span>:</span>
<span class="linenos">50</span>        <span class="hljs-keyword">return</span> get_object_or_404(Category, slug=slug)
<span class="linenos">51</span>
<span class="linenos">52</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">title</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">53</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts in category %s"</span> % obj.name
<span class="linenos">54</span>
<span class="linenos">55</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">link</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">56</span>        <span class="hljs-keyword">return</span> obj.get_absolute_url()
<span class="linenos">57</span>
<span class="linenos">58</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">description</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">59</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts in category %s"</span> % obj.name
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">62</span>        <span class="hljs-keyword">return</span> Post.objects.filter(category=obj).order_by(<span class="hljs-string">'-pub_date'</span>)</code></pre><p>Note that many of our fields don’t have to be explicitly defined as they are inherited from <code>PostsFeed</code>. We can’t hard-code the title, link or description because they depend on the category, so we instead define methods to return the appropriate text.</p><p>Also note <code>get_object()</code> - we define this so that we can ensure the category exists. If it doesn’t exist, then it returns a 404 error rather than showing an empty feed.</p><p>We also override <code>items()</code> to filter it to just those posts that are in the given category.</p><p>If you run the tests again, they should now pass:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">25</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.867</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Let’s commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Implemented category RSS feed'</span></code></pre><p>Now, we can get our category RSS feed, but how do we navigate to it? Let’s add a link to each category page that directs a user to its RSS feed. To do so, we’ll need to create a new template for category pages. First, let’s add some code to our tests to ensure that the right template is used at all times. Add the following to the end of the <code>test_index</code> method of <code>PostViewTest</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>        <span class="hljs-comment"># Check the correct template was used</span>
<span class="linenos">2</span>        self.assertTemplateUsed(response, <span class="hljs-string">'blogengine/post_list.html'</span>)</code></pre><p>Then, add this to the end of <code>test_post_page</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>
<span class="linenos">2</span>        <span class="hljs-comment"># Check the correct template was used</span>
<span class="linenos">3</span>        self.assertTemplateUsed(response, <span class="hljs-string">'blogengine/post_detail.html'</span>)</code></pre><p>Finally, add this to the end of <code>test_category_page</code>:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>        <span class="hljs-comment"># Check the correct template was used</span>
<span class="linenos">2</span>        self.assertTemplateUsed(response, <span class="hljs-string">'blogengine/category_post_list.html'</span>)</code></pre><p>These assertions confirm which template was used to generate which request.</p><p>Next, we head into our views file:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
<span class="linenos">2</span>    template_name = <span class="hljs-string">'blogengine/category_post_list.html'</span>
<span class="linenos">3</span>
<span class="linenos">4</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">5</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">6</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">7</span>            category = Category.objects.get(slug=slug)
<span class="linenos">8</span>            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
<span class="linenos">9</span>        <span class="hljs-keyword">except</span> Category.DoesNotExist:
<span class="linenos">10</span>            <span class="hljs-keyword">return</span> Post.objects.none()
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_context_data</span><span class="hljs-params">(self, **kwargs)</span>:</span>
<span class="linenos">13</span>        context = super(CategoryListView, self).get_context_data(**kwargs)
<span class="linenos">14</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">15</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">16</span>            context[<span class="hljs-string">'category'</span>] = Category.objects.get(slug=slug)
<span class="linenos">17</span>        <span class="hljs-keyword">except</span> Category.DoesNotExist:
<span class="linenos">18</span>            context[<span class="hljs-string">'category'</span>] = <span class="hljs-keyword">None</span>
<span class="linenos">19</span>        <span class="hljs-keyword">return</span> context</code></pre><p>Note that we first of all change the template used by this view. Then, we override <code>get_context_data</code> to add in additional data. What we’re doing is getting the slug that was passed through, looking up any category for which it is the slug, and returning it as additional context data. Using this method, you can easily add additional data that you may wish to render in your Django templates.</p><p>Finally, we create our new template:</p><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">
<span class="linenos">2</span>
<span class="linenos">3</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">
<span class="linenos">4</span>
<span class="linenos">5</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
<span class="linenos">6</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object_list %}</span><span class="xml">
<span class="linenos">7</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
<span class="linenos">8</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post col-md-12"</span>&gt;</span>
<span class="linenos">9</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">10</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
<span class="linenos">11</span>            </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
<span class="linenos">12</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">13</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.category %}</span><span class="xml">
<span class="linenos">14</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">15</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-primary"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">16</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">17</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">18</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.tags %}</span><span class="xml">
<span class="linenos">19</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">20</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
<span class="linenos">21</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-success"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">22</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">23</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">24</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">25</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">26</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">else</span> %}</span><span class="xml">
<span class="linenos">27</span>            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>No posts found<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">28</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">29</span>
<span class="linenos">30</span>        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pager"</span>&gt;</span>
<span class="linenos">31</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
<span class="linenos">32</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"previous"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">33</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">34</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
<span class="linenos">35</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">36</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">37</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">38</span>
<span class="linenos">39</span>        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/category/</span></span></span><span class="hljs-variable">{{ category.slug }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>RSS feed for category </span><span class="hljs-variable">{{ category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span></code></pre><p>Note that the category has been passed through to the template and is now accessible. If you run the tests, they should now pass:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py jenkins
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">25</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.232</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>With that done. we can commit our changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add templates/ blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Added link to RSS feed from category page'</span></code></pre><p>Next up, let’s implement another RSS feed for tags. First, we’ll implement our test:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_tag_feed</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">2</span>          <span class="hljs-comment"># Create a post</span>
<span class="linenos">3</span>          post = PostFactory(text=<span class="hljs-string">'This is my *first* blog post'</span>)
<span class="linenos">4</span>          tag = TagFactory()
<span class="linenos">5</span>          post.tags.add(tag)
<span class="linenos">6</span>          post.save()
<span class="linenos">7</span>
<span class="linenos">8</span>          <span class="hljs-comment"># Create another post with a different tag</span>
<span class="linenos">9</span>          tag2 = TagFactory(name=<span class="hljs-string">'perl'</span>, description=<span class="hljs-string">'The Perl programming language'</span>, slug=<span class="hljs-string">'perl'</span>)
<span class="linenos">10</span>          post2 = PostFactory(text=<span class="hljs-string">'This is my *second* blog post'</span>, title=<span class="hljs-string">'My second post'</span>, slug=<span class="hljs-string">'my-second-post'</span>)
<span class="linenos">11</span>          post2.tags.add(tag2)
<span class="linenos">12</span>          post2.save()
<span class="linenos">13</span>
<span class="linenos">14</span>          <span class="hljs-comment"># Fetch the feed</span>
<span class="linenos">15</span>          response = self.client.get(<span class="hljs-string">'/feeds/posts/tag/python/'</span>)
<span class="linenos">16</span>          self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">17</span>
<span class="linenos">18</span>          <span class="hljs-comment"># Parse the feed</span>
<span class="linenos">19</span>          feed = feedparser.parse(response.content)
<span class="linenos">20</span>
<span class="linenos">21</span>          <span class="hljs-comment"># Check length</span>
<span class="linenos">22</span>          self.assertEquals(len(feed.entries), <span class="hljs-number">1</span>)
<span class="linenos">23</span>
<span class="linenos">24</span>          <span class="hljs-comment"># Check post retrieved is the correct one</span>
<span class="linenos">25</span>          feed_post = feed.entries[<span class="hljs-number">0</span>]
<span class="linenos">26</span>          self.assertEquals(feed_post.title, post.title)
<span class="linenos">27</span>          self.assertTrue(<span class="hljs-string">'This is my &lt;em&gt;first&lt;/em&gt; blog post'</span> <span class="hljs-keyword">in</span> feed_post.description)
<span class="linenos">28</span>
<span class="linenos">29</span>          <span class="hljs-comment"># Check other post is not in this feed</span>
<span class="linenos">30</span>          self.assertTrue(<span class="hljs-string">'This is my &lt;em&gt;second&lt;/em&gt; blog post'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> response.content)</code></pre><p>This is virtually identical to the test for the categroy feed, but we adjust it to work with the <code>Tag</code> attribute and change the URL. Let’s check that our test fails:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>.................F........
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>FAIL: <span class="hljs-built_in">test</span>_tag_feed (blogengine.tests.FeedTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">757</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_tag_feed
<span class="linenos">9</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">11</span>
<span class="linenos">12</span>----------------------------------------------------------------------
<span class="linenos">13</span>Ran <span class="hljs-number">26</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.760</span>s
<span class="linenos">14</span>
<span class="linenos">15</span>FAILED (failures=<span class="hljs-number">1</span>)
<span class="linenos">16</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>As before, we create a route for this:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="linenos">3</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category, Tag
<span class="linenos">4</span><span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView, PostsFeed, CategoryPostsFeed, TagPostsFeed
<span class="linenos">5</span>
<span class="linenos">6</span>urlpatterns = patterns(<span class="hljs-string">''</span>,
<span class="linenos">7</span>    <span class="hljs-comment"># Index</span>
<span class="linenos">8</span>    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
<span class="linenos">9</span>        model=Post,
<span class="linenos">10</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">11</span>        )),
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="hljs-comment"># Individual posts</span>
<span class="linenos">14</span>    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
<span class="linenos">15</span>        model=Post,
<span class="linenos">16</span>        )),
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="hljs-comment"># Categories</span>
<span class="linenos">19</span>    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
<span class="linenos">20</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">21</span>        model=Category,
<span class="linenos">22</span>        )),
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="hljs-comment"># Tags</span>
<span class="linenos">25</span>    url(<span class="hljs-string">r'^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagListView.as_view(
<span class="linenos">26</span>        paginate_by=<span class="hljs-number">5</span>,
<span class="linenos">27</span>        model=Tag,
<span class="linenos">28</span>        )),
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="hljs-comment"># Post RSS feed</span>
<span class="linenos">31</span>    url(<span class="hljs-string">r'^feeds/posts/$'</span>, PostsFeed()),
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="hljs-comment"># Category RSS feed</span>
<span class="linenos">34</span>    url(<span class="hljs-string">r'^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryPostsFeed()),
<span class="linenos">35</span>
<span class="linenos">36</span>    <span class="hljs-comment"># Tag RSS feed</span>
<span class="linenos">37</span>    url(<span class="hljs-string">r'^feeds/posts/tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagPostsFeed()),
<span class="linenos">38</span>)</code></pre><p>Next, we create our view:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagPostsFeed</span><span class="hljs-params">(PostsFeed)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_object</span><span class="hljs-params">(self, request, slug)</span>:</span>
<span class="linenos">3</span>        <span class="hljs-keyword">return</span> get_object_or_404(Tag, slug=slug)
<span class="linenos">4</span>
<span class="linenos">5</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">title</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">6</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts tagged  %s"</span> % obj.name
<span class="linenos">7</span>
<span class="linenos">8</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">link</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">9</span>        <span class="hljs-keyword">return</span> obj.get_absolute_url()
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">description</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">12</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"RSS feed - blog posts tagged %s"</span> % obj.name
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self, obj)</span>:</span>
<span class="linenos">15</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">16</span>            tag = Tag.objects.get(slug=obj.slug)
<span class="linenos">17</span>            <span class="hljs-keyword">return</span> tag.post_set.all()
<span class="linenos">18</span>        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
<span class="linenos">19</span>            <span class="hljs-keyword">return</span> Post.objects.none()</code></pre><p>Again, this inherits from <code>PostsFeed</code>, but the syntax for getting posts matching a tag is slightly different because they use a many-to-many relationship.</p><p>We also need a template for the tag pages. Add this to the end of the <code>test_tag_page</code> method:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>
<span class="linenos">2</span>        <span class="hljs-comment"># Check the correct template was used</span>
<span class="linenos">3</span>        self.assertTemplateUsed(response, <span class="hljs-string">'blogengine/tag_post_list.html'</span>)</code></pre><p>Let’s create that template:</p><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">
<span class="linenos">2</span>
<span class="linenos">3</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">
<span class="linenos">4</span>
<span class="linenos">5</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
<span class="linenos">6</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object_list %}</span><span class="xml">
<span class="linenos">7</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
<span class="linenos">8</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post col-md-12"</span>&gt;</span>
<span class="linenos">9</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">10</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
<span class="linenos">11</span>            </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
<span class="linenos">12</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">13</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.category %}</span><span class="xml">
<span class="linenos">14</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">15</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-primary"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">16</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">17</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">18</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.tags %}</span><span class="xml">
<span class="linenos">19</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">20</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
<span class="linenos">21</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-success"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">22</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">23</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">24</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">25</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">26</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">else</span> %}</span><span class="xml">
<span class="linenos">27</span>            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>No posts found<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">28</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">29</span>
<span class="linenos">30</span>        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pager"</span>&gt;</span>
<span class="linenos">31</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
<span class="linenos">32</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"previous"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">33</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">34</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
<span class="linenos">35</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">36</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">37</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">38</span>
<span class="linenos">39</span>        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/tag/</span></span></span><span class="hljs-variable">{{ tag.slug }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>RSS feed for tag </span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span></code></pre><p>This is virtually identical to the category template. You’ll also need to apply this template in the view for the tag list, and pass the tag name through as context data:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagListView</span><span class="hljs-params">(ListView)</span>:</span>
<span class="linenos">2</span>    template_name = <span class="hljs-string">'blogengine/tag_post_list.html'</span>
<span class="linenos">3</span>
<span class="linenos">4</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">5</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">6</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">7</span>            tag = Tag.objects.get(slug=slug)
<span class="linenos">8</span>            <span class="hljs-keyword">return</span> tag.post_set.all()
<span class="linenos">9</span>        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
<span class="linenos">10</span>            <span class="hljs-keyword">return</span> Post.objects.none()
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_context_data</span><span class="hljs-params">(self, **kwargs)</span>:</span>
<span class="linenos">13</span>        context = super(TagListView, self).get_context_data(**kwargs)
<span class="linenos">14</span>        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
<span class="linenos">15</span>        <span class="hljs-keyword">try</span>:
<span class="linenos">16</span>            context[<span class="hljs-string">'tag'</span>] = Tag.objects.get(slug=slug)
<span class="linenos">17</span>        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
<span class="linenos">18</span>            context[<span class="hljs-string">'tag'</span>] = <span class="hljs-keyword">None</span>
<span class="linenos">19</span>        <span class="hljs-keyword">return</span> context</code></pre><p>Let’s run our tests:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span> blogengine
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>..........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">26</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.770</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>You may want to do a quick check to ensure your tag feed link works as expected. Time to commit:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine templates
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Implemented tag feeds'</span></code></pre><h1 id="moving-our-templates">Moving our templates</h1><p>Before we crack on with implementing search, there’s one more piece of housekeeping. In Django, templates can be applied at project level or at app level. So far, we’ve been storing them in the project, but we would like our app to be as self-contained as possible so it can just be dropped into future projects where we need a blog. That way, it can be easily overridden for specific projects. You can move the folders and update the Git repository at the same time with this command:</p><pre><code class="hljs lang-bash singleline">$ git mv templates/ blogengine/</code></pre><p>We run the tests to make sure nothing untoward has happened:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span>
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>..........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">26</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.847</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>And we commit:</p><pre><code class="hljs lang-bash singleline">$ git commit -m <span class="hljs-string">'Moved templates'</span></code></pre><p>Note that <code>git mv</code> updates Git and moves the files, so you don’t need to call <code>git add</code>.</p><h1 id="implementing-search">Implementing search</h1><p>For our final task today, we will be implementing a very simple search engine. Our requirements are:</p><ul><li>It should be in the header, to allow for easy access from anywhere in the front end.</li><li>It should search the title and text of posts.</li></ul><p>First, we’ll write our tests:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_search</span><span class="hljs-params">(self)</span>:</span>
<span class="linenos">3</span>        <span class="hljs-comment"># Create a post</span>
<span class="linenos">4</span>        post = PostFactory()
<span class="linenos">5</span>
<span class="linenos">6</span>        <span class="hljs-comment"># Create another post</span>
<span class="linenos">7</span>        post2 = PostFactory(text=<span class="hljs-string">'This is my *second* blog post'</span>, title=<span class="hljs-string">'My second post'</span>, slug=<span class="hljs-string">'my-second-post'</span>)
<span class="linenos">8</span>
<span class="linenos">9</span>        <span class="hljs-comment"># Search for first post</span>
<span class="linenos">10</span>        response = self.client.get(<span class="hljs-string">'/search?q=first'</span>)
<span class="linenos">11</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">12</span>
<span class="linenos">13</span>        <span class="hljs-comment"># Check the first post is contained in the results</span>
<span class="linenos">14</span>        self.assertTrue(<span class="hljs-string">'My first post'</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">15</span>
<span class="linenos">16</span>        <span class="hljs-comment"># Check the second post is not contained in the results</span>
<span class="linenos">17</span>        self.assertTrue(<span class="hljs-string">'My second post'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">18</span>
<span class="linenos">19</span>        <span class="hljs-comment"># Search for second post</span>
<span class="linenos">20</span>        response = self.client.get(<span class="hljs-string">'/search?q=second'</span>)
<span class="linenos">21</span>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">22</span>
<span class="linenos">23</span>        <span class="hljs-comment"># Check the first post is not contained in the results</span>
<span class="linenos">24</span>        self.assertTrue(<span class="hljs-string">'My first post'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> response.content)
<span class="linenos">25</span>
<span class="linenos">26</span>        <span class="hljs-comment"># Check the second post is contained in the results</span>
<span class="linenos">27</span>        self.assertTrue(<span class="hljs-string">'My second post'</span> <span class="hljs-keyword">in</span> response.content)</code></pre><p>Don’t forget to run the tests to make sure they fail:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span>
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>..........................F
<span class="linenos">4</span>======================================================================
<span class="linenos">5</span>FAIL: <span class="hljs-built_in">test</span>_search (blogengine.tests.SearchViewTest)
<span class="linenos">6</span>----------------------------------------------------------------------
<span class="linenos">7</span>Traceback (most recent call last):
<span class="linenos">8</span>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">819</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_search
<span class="linenos">9</span>    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
<span class="linenos">10</span>AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>
<span class="linenos">11</span>
<span class="linenos">12</span>----------------------------------------------------------------------
<span class="linenos">13</span>Ran <span class="hljs-number">27</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">6.919</span>s
<span class="linenos">14</span>
<span class="linenos">15</span>FAILED (failures=<span class="hljs-number">1</span>)
<span class="linenos">16</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>With that done, we can add the search form to the header:</p><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="linenos">2</span><span class="hljs-comment">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">3</span><span class="hljs-comment">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">4</span><span class="hljs-comment">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="linenos">5</span><span class="hljs-comment">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"no-js"</span>&gt;</span> <span class="hljs-comment">&lt;!--&lt;![endif]--&gt;</span>
<span class="linenos">6</span>    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
<span class="linenos">7</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
<span class="linenos">8</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
<span class="linenos">9</span>        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> title %}</span><span class="xml">My Django Blog</span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="linenos">10</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"description"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">""</span>&gt;</span>
<span class="linenos">11</span>        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>&gt;</span>
<span class="linenos">12</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"alternate"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"application/rss+xml"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Blog posts"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span> &gt;</span>
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="hljs-comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
<span class="linenos">15</span>
<span class="linenos">16</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> staticfiles %}</span><span class="xml">
<span class="linenos">17</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/normalize.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">18</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">19</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">20</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">21</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">22</span>        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/code.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
<span class="linenos">23</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">24</span>    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="linenos">25</span>    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
<span class="linenos">26</span>        <span class="hljs-comment">&lt;!--[if lt IE 7]&gt;
<span class="linenos">27</span>            &lt;p class="browsehappy"&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;
<span class="linenos">28</span>        &lt;![endif]--&gt;</span>
<span class="linenos">29</span>
<span class="linenos">30</span>        <span class="hljs-comment">&lt;!-- Add your site or application content here --&gt;</span>
<span class="linenos">31</span>
<span class="linenos">32</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fb-root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">33</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="clojure"><span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">d</span>, s, id)</span> <span class="hljs-collection">{
<span class="linenos">34</span>            var js, fjs = d.getElementsByTagName<span class="hljs-list">(<span class="hljs-keyword">s</span>)</span><span class="hljs-collection">[<span class="hljs-number">0</span>]</span><span class="hljs-comment">;</span>
<span class="linenos">35</span>            if <span class="hljs-list">(<span class="hljs-keyword">d.getElementById</span><span class="hljs-list">(<span class="hljs-keyword">id</span>)</span>)</span> return;
<span class="linenos">36</span>                js = d.createElement<span class="hljs-list">(<span class="hljs-keyword">s</span>)</span><span class="hljs-comment">; js.id = id;</span>
<span class="linenos">37</span>                js.src = <span class="hljs-string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span><span class="hljs-comment">;</span>
<span class="linenos">38</span>                fjs.parentNode.insertBefore<span class="hljs-list">(<span class="hljs-keyword">js</span>, fjs)</span><span class="hljs-comment">;</span>
<span class="linenos">39</span>            }</span><span class="hljs-list">(<span class="hljs-keyword">document</span>, 'script', 'facebook-jssdk')</span>)</span><span class="hljs-comment">;</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">40</span>
<span class="linenos">41</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
<span class="linenos">42</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container-fluid"</span>&gt;</span>
<span class="linenos">43</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-header"</span>&gt;</span>
<span class="linenos">44</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"button"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-toggle"</span> <span class="hljs-attribute">data-toggle</span>=<span class="hljs-value">"collapse"</span> <span class="hljs-attribute">data-target</span>=<span class="hljs-value">"#header-nav"</span>&gt;</span>
<span class="linenos">45</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">46</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">47</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
<span class="linenos">48</span>                    <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="linenos">49</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-brand"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/"</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">50</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">51</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"collapse navbar-collapse"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header-nav"</span>&gt;</span>
<span class="linenos">52</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav"</span>&gt;</span>
<span class="linenos">53</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> flatpages %}</span><span class="xml">
<span class="linenos">54</span>                        </span><span class="hljs-template_tag">{% get_flatpages <span class="hljs-keyword">as</span> flatpages %}</span><span class="xml">
<span class="linenos">55</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> flatpage <span class="hljs-keyword">in</span> flatpages %}</span><span class="xml">
<span class="linenos">56</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ flatpage.url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ flatpage.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">57</span>                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">58</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span>&gt;</span>RSS feed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">59</span>
<span class="linenos">60</span>                        <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">"/search"</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"GET"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-form navbar-left"</span>&gt;</span>
<span class="linenos">61</span>                            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group"</span>&gt;</span>
<span class="linenos">62</span>                                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"q"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Search..."</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
<span class="linenos">63</span>                            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">64</span>                            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-default"</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="linenos">65</span>                        <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="linenos">66</span>                    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">67</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">68</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">69</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">70</span>
<span class="linenos">71</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
<span class="linenos">72</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> header %}</span><span class="xml">
<span class="linenos">73</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"page-header"</span>&gt;</span>
<span class="linenos">74</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">75</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">76</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
<span class="linenos">77</span>
<span class="linenos">78</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
<span class="linenos">79</span>                </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
<span class="linenos">80</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">81</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">82</span>
<span class="linenos">83</span>        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container footer"</span>&gt;</span>
<span class="linenos">84</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
<span class="linenos">85</span>                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"span12"</span>&gt;</span>
<span class="linenos">86</span>                    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Copyright &amp;copy; </span><span class="hljs-template_tag">{% <span class="hljs-keyword">now</span> "Y" %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">87</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">88</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">89</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">90</span>
<span class="linenos">91</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">92</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="applescript">window.jQuery || document.<span class="hljs-command">write</span>('&lt;<span class="hljs-keyword">script</span> src=<span class="hljs-string">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/jquery-1.10.2.min.js' %}</span><span class="xml"><span class="1c"><span class="hljs-string">"&gt;&lt;\/script&gt;')</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">93</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/plugins.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">94</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">95</span>
<span class="linenos">96</span>        <span class="hljs-comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
<span class="linenos">97</span>        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="scheme">
<span class="linenos">98</span>            <span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">b</span>,o,i,l,e,r)</span>{b.GoogleAnalyticsObject=l<span class="hljs-comment">;b[l]||(b[l]=</span>
<span class="linenos">99</span>            function<span class="hljs-list">()</span>{<span class="hljs-list">(<span class="hljs-keyword">b</span><span class="hljs-list">[<span class="hljs-keyword">l</span>].q=b<span class="hljs-list">[<span class="hljs-keyword">l</span>].q||<span class="hljs-list">[]).push<span class="hljs-list">(<span class="hljs-keyword">arguments</span>)</span>})<span class="hljs-comment">;b[l].l=+new Date;</span>
<span class="linenos">100</span>            e=o.createElement<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span><span class="hljs-comment">;r=o.getElementsByTagName(i)[0];</span>
<span class="linenos">101</span>            e.src=<span class="hljs-variable">'//www.google-analytics.com/analytics.js</span>'<span class="hljs-comment">;</span>
<span class="linenos">102</span>            r.parentNode.insertBefore<span class="hljs-list">(<span class="hljs-keyword">e</span>,r)</span>}<span class="hljs-list">(<span class="hljs-keyword">window</span>,document,<span class="hljs-variable">'script</span>',<span class="hljs-variable">'ga</span>')</span>)<span class="hljs-comment">;</span>
<span class="linenos">103</span>            ga<span class="hljs-list">(<span class="hljs-variable">'create</span>',<span class="hljs-variable">'UA-XXXXX-X</span>')</span><span class="hljs-comment">;ga('send','pageview');</span>
<span class="linenos">104</span>        </span></span></span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="linenos">105</span>    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="linenos">106</span><span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></span></code></pre><p>Now we’ll actually implement our search. Implementing search using Django’s generic views can be fiddly, so we’ll write our search view as a function instead. First, amend the imports at the top of your view file to look like this:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> get_object_or_404, render_to_response
<span class="linenos">2</span><span class="hljs-keyword">from</span> django.core.paginator <span class="hljs-keyword">import</span> Paginator, EmptyPage
<span class="linenos">3</span><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q
<span class="linenos">4</span><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="linenos">5</span><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post, Tag
<span class="linenos">6</span><span class="hljs-keyword">from</span> django.contrib.syndication.views <span class="hljs-keyword">import</span> Feed
<span class="linenos">7</span><span class="hljs-keyword">from</span> django.utils.encoding <span class="hljs-keyword">import</span> force_unicode
<span class="linenos">8</span><span class="hljs-keyword">from</span> django.utils.safestring <span class="hljs-keyword">import</span> mark_safe
<span class="linenos">9</span><span class="hljs-keyword">import</span> markdown2</code></pre><p>Next, add the following code to the end of the file:</p><pre><code class="hljs lang-python"><span class="linenos">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSearchResults</span><span class="hljs-params">(request)</span>:</span>
<span class="linenos">2</span>    <span class="hljs-string">"""
<span class="linenos">3</span>    Search for a post by title or text
<span class="linenos">4</span>    """</span>
<span class="linenos">5</span>    <span class="hljs-comment"># Get the query data</span>
<span class="linenos">6</span>    query = request.GET.get(<span class="hljs-string">'q'</span>, <span class="hljs-string">''</span>)
<span class="linenos">7</span>    page = request.GET.get(<span class="hljs-string">'page'</span>, <span class="hljs-number">1</span>)
<span class="linenos">8</span>
<span class="linenos">9</span>    <span class="hljs-comment"># Query the database</span>
<span class="linenos">10</span>    <span class="hljs-keyword">if</span> query:
<span class="linenos">11</span>        results = Post.objects.filter(Q(text__icontains=query) | Q(title__icontains=query))
<span class="linenos">12</span>    <span class="hljs-keyword">else</span>:
<span class="linenos">13</span>        results = <span class="hljs-keyword">None</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="hljs-comment"># Add pagination</span>
<span class="linenos">16</span>    pages = Paginator(results, <span class="hljs-number">5</span>)
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="hljs-comment"># Get specified page</span>
<span class="linenos">19</span>    <span class="hljs-keyword">try</span>:
<span class="linenos">20</span>        returned_page = pages.page(page)
<span class="linenos">21</span>    <span class="hljs-keyword">except</span> EmptyPage:
<span class="linenos">22</span>        returned_page = pages.page(pages.num_pages)
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="hljs-comment"># Display the search results</span>
<span class="linenos">25</span>    <span class="hljs-keyword">return</span> render_to_response(<span class="hljs-string">'blogengine/search_post_list.html'</span>,
<span class="linenos">26</span>                              {<span class="hljs-string">'page_obj'</span>: returned_page,
<span class="linenos">27</span>                               <span class="hljs-string">'object_list'</span>: returned_page.object_list,
<span class="linenos">28</span>                               <span class="hljs-string">'search'</span>: query})</code></pre><p>As this is the first time we’ve written a view without using generic views, a little explanation is called for. First we get the values of the <code>q</code> and <code>page</code> parameters passed to the view. <code>q</code> contains the query text and <code>page</code> contains the page number. Note also that our page defaults to 1 if not set.</p><p>We then use the Q object to perform a query. The Django ORM will <code>AND</code> together keyword argument queries, but that’s not the behaviour we want here. Instead we want to be able to search for content in the title or text, so we need to use a query with an <code>OR</code> statement, which necessitates using the <a href="https://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects">Q</a> object.</p><p>Next, we use the <code>Paginator</code> object to manually paginate the results, and if it raises an <code>EmptyPage</code> exception, to just show the last page instead. Finally we render the template <code>blogengine/search_post_list.html</code>, and pass through the parameters <code>page_obj</code> for the returned page, <code>object_list</code> for the objects, and <code>search</code> for the query.</p><p>We also need to add a route for our new view:</p><pre><code class="hljs lang-python"><span class="linenos">1</span>
<span class="linenos">2</span>    <span class="hljs-comment"># Search posts</span>
<span class="linenos">3</span>    url(<span class="hljs-string">r'^search'</span>, <span class="hljs-string">'blogengine.views.getSearchResults'</span>),</code></pre><p>Finally, let’s create a new template to show our results:</p><pre><code class="hljs lang-django"><span class="linenos">1</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">
<span class="linenos">2</span>
<span class="linenos">3</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">
<span class="linenos">4</span>
<span class="linenos">5</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
<span class="linenos">6</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object_list %}</span><span class="xml">
<span class="linenos">7</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
<span class="linenos">8</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post col-md-12"</span>&gt;</span>
<span class="linenos">9</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
<span class="linenos">10</span>            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
<span class="linenos">11</span>            </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
<span class="linenos">12</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">13</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.category %}</span><span class="xml">
<span class="linenos">14</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">15</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-primary"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">16</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">17</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">18</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.tags %}</span><span class="xml">
<span class="linenos">19</span>            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
<span class="linenos">20</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
<span class="linenos">21</span>            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-success"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
<span class="linenos">22</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">23</span>            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="linenos">24</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">25</span>            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
<span class="linenos">26</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">else</span> %}</span><span class="xml">
<span class="linenos">27</span>            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>No posts found<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="linenos">28</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">29</span>
<span class="linenos">30</span>        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pager"</span>&gt;</span>
<span class="linenos">31</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
<span class="linenos">32</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"previous"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/search?page=</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">&amp;q=</span></span></span><span class="hljs-variable">{{ search }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">33</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">34</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
<span class="linenos">35</span>        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/search?page=</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">&amp;q=</span></span></span><span class="hljs-variable">{{ search }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="linenos">36</span>        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
<span class="linenos">37</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span></code></pre><p>Let’s run our tests:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ python manage.py <span class="hljs-built_in">test</span>
<span class="linenos">2</span>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
<span class="linenos">3</span>...........................
<span class="linenos">4</span>----------------------------------------------------------------------
<span class="linenos">5</span>Ran <span class="hljs-number">27</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">6.421</span>s
<span class="linenos">6</span>
<span class="linenos">7</span>OK
<span class="linenos">8</span>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</code></pre><p>Don’t forget to do a quick sense check to make sure it’s all working as expected. Then it’s time to commit:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git add blogengine/
<span class="linenos">2</span>$ git commit -m <span class="hljs-string">'Implemented search'</span></code></pre><p>And push up your changes:</p><pre><code class="hljs lang-bash"><span class="linenos">1</span>$ git push origin master
<span class="linenos">2</span>$ git push heroku master</code></pre><p>And that’s the end of this instalment. Please note this particular search solution is quite basic, and if you want something more powerful, you may want to look at <a href="http://haystacksearch.org/">Haystack</a>.</p><p>As usual, you can get this lesson with <code>git checkout lesson-7</code> - if you have any problems, the <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">repository</a> should be the first place you look for answers as this is the working code base for the application, and with judicious use of a tool like <code>diff</code>, it’s generally pretty easy to track down most issues.</p><p>In our next, and final instalment, we’ll cover:</p><ul><li>Tidying everything up</li><li>Implementing an XML sitemap for search engines</li><li>Optimising our site</li><li>Using Fabric to make deployment easier</li></ul><p>Hope to see you then!</p></article></div><div class="col-md-4"><h1>Recent Posts</h1><p><a href="/blog/2015/05/03/my-static-site-generator-post-on-sitepoint/">My Static Site Generator Post on Sitepoint</a></p><p><a href="/blog/2015/04/18/how-i-added-search-to-my-site-with-lunr-dot-js/">How I Added Search to My Site With Lunr.js</a></p><p><a href="/blog/2015/04/04/adding-a-new-search-engine-to-my-site/">Adding a New Search Engine to My Site</a></p><p><a href="/blog/2015/03/02/syntax-highlighting-in-fenced-code-blocks-in-vim/">Syntax Highlighting in Fenced Code Blocks in Vim</a></p><p><a href="/blog/2015/03/02/extending-our-node-dot-js-and-redis-chat-server/">Extending Our Node.js and Redis Chat Server</a></p><section id="github-profile"></section><h4>My GitHub repositories</h4><ul id="github-repos"><li>Loading repositories...</li></ul></div></div><div class="row"><div class="col-md-12"><ul class="pager"><li><a href="/posts/2/">Newer</a></li><li><a href="/posts/4/">Older</a></li></ul></div></div></div><footer><div class="container footercontainer"><div class="col-md-12"><p class="copyright">Copyright &copy; Matthew Daly 2015.</p></div></div></footer><script type="text/javascript" src="/static/js/all.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');</script></body></html>