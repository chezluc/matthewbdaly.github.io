<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
        <meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog...">
        
        <link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="/static/bower_components/sass-bootstrap/dist/css/bootstrap.min.css" media="all" />
        <link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all" />
        <link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/atom.xml" />
        <title>Matthew Daly&#x27;s Blog</title>
    </head>
    <body>

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script>

        <header>
            <nav class="navbar navbar-inverse navbar-static-top">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#header-nav">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="header-nav">
                            <ul class="nav navbar-nav">
                                <li><a href="/">Home</a></li>
                                <li><a href="/blog/archives/">Archives</a></li>
                                <li><a href="/about/">About</a></li>
                                <li><a href="/atom.xml">RSS</a></li>
                            </ul>
                            <form action="http://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded" class="navbar-form navbar-right">
                                <div class="form-group">
                                    <input id="search" type="search" name="q" placeholder="Search..." maxlength="200" class="form-control"></input>
                                </div>
                                <input id="site" name="q" type="hidden" value="site:matthewdaly.co.uk" />
                                <input type="submit" class="btn btn-default"></input>
                            </form>
                        </div>
                    </div>
                </div>
            </nav>

            <div class="container">
                <div class="page-header">
                    <h1><a href="/">Matthew Daly&#x27;s Blog</a></h1>
                    <h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2>
                </div>
            </div>
        </header>

<div class="container">
    <div class="row">
        <div class="col-md-8">
    <article class="post">
        <p class="date">25th May 2014 5:23 pm</p>
        <h1><a href="/blog/2014/05/25/django-blog-tutorial-the-next-generation-part-6/">Django Blog Tutorial - the Next Generation - Part 6</a></h1>
        <p>Welcome back! In this tutorial we’ll cover the following:</p>
<ul>
<li>Fixing bugs the TDD way</li>
<li>Setting up syntax highlighting for code snippets</li>
<li>Tidying up the front end</li>
</ul>
<p>Apologies, but I’m holding over implementing the search and additional feeds for a future instalment - in the past I’ve tried to cover too much in one post and that has led to me putting them off for much too long. So this instalment and future ones are going to be shorter so I can get them out the door quicker.</p>
<p>Ready? Let’s get started!</p>
<h1 id="fixing-bugs">Fixing bugs</h1>
<p>When someone reports a bug, it’s tempting to just dive straight in and start fixing it. But TDD cautions us against this practice. If we have a bug, then our tests should have caught it. If they don’t, then before we fix the bug, we have to make sure we can catch it if it crops up in future by implementing a test for it, and ensuring that it fails. Once that test is in place, we can then go ahead and fix the bug, safe in the knowledge that if it should reappear in future, we will be warned when our tests run.</p>
<p>As it happens, we have a bug in our web app. If you activate your virtualenv in the usual way and run the development server, and then try to create a new post without adding a tag, you’ll see that it fails as the tag is empty. Now, it’s pretty obvious that this is because the <code>tags</code> attribute of the <code>Post</code> model cannot be blank, so we have a good idea of what we need to do to fix this. But to make sure it never occurs again, we need to implement a test first.</p>
<p>Add the following method to <code>AdminTest</code>:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post_without_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
</code></pre>
<p>This is virtually identical to our previous method for adding a post, but doesn’t add a tag to the post. If you run <code>python manage.py jenkins</code>, the test should fail. Let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/tests.py
$ git commit -m <span class="hljs-string">'Added failing test for posts without tags'</span>
</code></pre>
<p>Now we’re in a position to fix our bug. Let’s take a look at our models:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)
    tags = models.ManyToManyField(Tag)
</code></pre>
<p>If you compare <code>category</code> and <code>tags</code>, you’ll immediately see that <code>category</code> has the additional parameters <code>blank</code> and <code>null</code> both set to <code>True</code>. So that’s what we need to do for <code>tags</code> as well. Amend the model to look like this:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)
    tags = models.ManyToManyField(Tag, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)
</code></pre>
<p>You shouldn’t have to create a migration for this. Let’s run our tests:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins --coverage-html-report=htmlcov
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.......................
----------------------------------------------------------------------
Ran <span class="hljs-number">23</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">7.634</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Our tests pass! So we’ve fixed our bug, and we’ve ensured that if it happens again, we’ll catch it. With that done, it’s time to commit:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/models.py
$ git commit -m <span class="hljs-string">'Fixed a bug with the Post model'</span>
</code></pre>
<p><strong>Remember</strong>: Always make the effort to create a test to reproduce your bug before fixing it. That way, you know you can catch it in future.</p>
<h1 id="syntax-highlighting">Syntax highlighting</h1>
<p>This is one feature that not everyone will want to implement. If you want to be able to show code snippets on your blog, then implementing syntax highlighting is well worth your time. However, if that’s not what you want to use your blog for, feel free to skip over this section.</p>
<p>Now, earlier in the series we implemented Markdown support. In Markdown there are two main ways to denote a code block. One is to indent the code by four spaces, while the other is to use <a href="https://help.github.com/articles/github-flavored-markdown#syntax-highlighting">fenced code blocks with syntax highlighting</a>. There are many flavours of Markdown available for Python, and unfortunately the one we’ve been using so far doesn’t support fenced code blocks, so we’ll be switching to one that does.</p>
<p>We also need to be able to generate a suitable stylesheet to highlight the code appropriately. For that, we’ll be using <a href="http://pygments.org/">Pygments</a>. So let’s first uninstall our existing implementation of Markdown:</p>
<pre><code class="hljs lang-bash">$ pip uninstall Markdown
</code></pre>
<p>And install the new modules:</p>
<pre><code class="hljs lang-bash">$ pip install markdown2 Pygments
</code></pre>
<p>Don’t forget to record the changes:</p>
<pre><code class="hljs lang-bash">$ pip freeze &gt; requirements.txt
</code></pre>
<p>Now, we need to amend our Markdown template tags to use the new version of Markdown:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> markdown2

<span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> template
<span class="hljs-keyword">from</span> django.template.defaultfilters <span class="hljs-keyword">import</span> stringfilter
<span class="hljs-keyword">from</span> django.utils.encoding <span class="hljs-keyword">import</span> force_unicode
<span class="hljs-keyword">from</span> django.utils.safestring <span class="hljs-keyword">import</span> mark_safe

register = template.Library()

<span class="hljs-decorator">@register.filter(is_safe=True)</span>
<span class="hljs-decorator">@stringfilter</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">custom_markdown</span><span class="hljs-params">(value)</span>:</span>
    extras = [<span class="hljs-string">"fenced-code-blocks"</span>]

    <span class="hljs-keyword">return</span> mark_safe(markdown2.markdown(force_unicode(value),
                                       extras = extras))
</code></pre>
<p>All we do here is change the Markdown module that gets imported, and amend how it is called. Note that we pass through the parameter <code>fenced-code-blocks</code> to enable this functionality.</p>
<p>If you now run the development server and create a post with some code in it (just copy the Ruby example from <a href="https://help.github.com/articles/github-flavored-markdown#syntax-highlighting">here</a>), then view it on the site, you should be able to see that it’s in a <code>&lt;code&gt;</code> block. However, it’s not highlighted yet. Let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add requirements/txt blogengine/templatetags/custom_markdown.py
$ git commit -m <span class="hljs-string">'Now use Markdown2 to allow for syntax highlighting'</span>
</code></pre>
<p>Now, if you examine the markup for your code blocks using your browser’s developer tools, you’ll notice that the code is wrapped in many different spans with various classes. Pygments can generate a CSS file that uses those classes to highlight your code.</p>
<p>First, let’s create a folder to store our CSS files in:</p>
<pre><code class="hljs lang-bash">$ mkdir blogengine/static/css
</code></pre>
<p>Next, we’ll add a blank CSS file for any other styling we may want to apply:</p>
<pre><code class="hljs lang-bash">$ touch blogengine/static/css/main.css
</code></pre>
<p>Then, we generate our CSS file:</p>
<pre><code class="hljs lang-bash">$ pygmentize -S default <span class="hljs-operator">-f</span> html &gt; blogengine/static/css/code.css
</code></pre>
<p>We need to include our CSS files in our HTML template:</p>
<pre><code class="hljs lang-django"><span class="xml"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-comment">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="hljs-comment">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="hljs-comment">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="hljs-comment">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"no-js"</span>&gt;</span> <span class="hljs-comment">&lt;!--&lt;![endif]--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> title %}</span><span class="xml">My Django Blog</span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"description"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">""</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>

        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> staticfiles %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/normalize.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/code.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
        <span class="hljs-comment">&lt;!--[if lt IE 7]&gt;
            &lt;p class="browsehappy"&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;
        &lt;![endif]--&gt;</span>

        <span class="hljs-comment">&lt;!-- Add your site or application content here --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fb-root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, s, id)</span> </span>{
            <span class="hljs-keyword">var</span> js, fjs = d.getElementsByTagName(s)[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">if</span> (d.getElementById(id)) <span class="hljs-keyword">return</span>;
                js = d.createElement(s); js.id = id;
                js.src = <span class="hljs-string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span>;
                fjs.parentNode.insertBefore(js, fjs);
            }(<span class="hljs-built_in">document</span>, <span class="hljs-string">'script'</span>, <span class="hljs-string">'facebook-jssdk'</span>));</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-inner"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-navbar"</span> <span class="hljs-attribute">data-toggle</span>=<span class="hljs-value">"collapse"</span> <span class="hljs-attribute">data-target</span>=<span class="hljs-value">".nav-collapse"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"brand"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/"</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-collapse collapse"</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> header %}</span><span class="xml">
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"page-header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">

            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
                </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container footer"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"span12"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Copyright &amp;copy; </span><span class="hljs-template_tag">{% <span class="hljs-keyword">now</span> "Y" %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">window</span>.jQuery || <span class="hljs-built_in">document</span>.write(<span class="hljs-string">'&lt;script src="</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/jquery-1.10.2.min.js' %}</span><span class="xml"><span class="javascript"><span class="hljs-string">"&gt;&lt;\/script&gt;')</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/plugins.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
            (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b,o,i,l,e,r)</span></span>{b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{(b[l].q=b[l].q||[]).push(<span class="hljs-built_in">arguments</span>)});b[l].l=+<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>;
            e=o.createElement(i);r=o.getElementsByTagName(i)[<span class="hljs-number">0</span>];
            e.src=<span class="hljs-string">'//www.google-analytics.com/analytics.js'</span>;
            r.parentNode.insertBefore(e,r)}(<span class="hljs-built_in">window</span>,<span class="hljs-built_in">document</span>,<span class="hljs-string">'script'</span>,<span class="hljs-string">'ga'</span>));
            ga(<span class="hljs-string">'create'</span>,<span class="hljs-string">'UA-XXXXX-X'</span>);ga(<span class="hljs-string">'send'</span>,<span class="hljs-string">'pageview'</span>);
        </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></span>
</code></pre>
<p>Now, if you run the development server and reload the page, your code will be highlighted using the default Pygments style. If you don’t like it, there are plenty to choose from. Run the following command:</p>
<pre><code class="hljs lang-bash">$ pygmentize -L styles
</code></pre>
<p>That will list the various styles available. For instance, let’s say we want to try the Tango style:</p>
<pre><code class="hljs lang-bash">$ pygmentize -S tango <span class="hljs-operator">-f</span> html &gt; blogengine/static/css/code.css
</code></pre>
<p>If you like the Monokai theme in Sublime Text, there’s a Pygments version of that:</p>
<pre><code class="hljs lang-bash">$ pygmentize -S monokai <span class="hljs-operator">-f</span> html &gt; blogengine/static/css/code.css
</code></pre>
<p>If you like the Solarized theme, that’s not bundled with Pygments, but can be installed separately:</p>
<pre><code class="hljs lang-bash">$ pip install pygments-style-solarized
</code></pre>
<p>Then run this for the light version:</p>
<pre><code class="hljs lang-bash">$ pygmentize -S solarizedlight <span class="hljs-operator">-f</span> html &gt; blogengine/static/css/code.css
</code></pre>
<p>And this for the dark version:</p>
<pre><code class="hljs lang-bash">$ pygmentize -S solarizeddark <span class="hljs-operator">-f</span> html &gt; blogengine/static/css/code.css
</code></pre>
<p>Pick one that you like - I’m going to go for the dark version of Solarized.</p>
<p>Note that this doesn’t actually change the background colour of the code blocks. You will therefore need to set this manually using the CSS file we created earlier. If you’re using Solarized Dark like I am, then this should set it correctly:</p>
<pre><code class="hljs lang-css"><span class="hljs-tag">div</span><span class="hljs-class">.codehilite</span> <span class="hljs-tag">pre</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#002b36</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>If you’re using Solarized Light, then this should be more appropriate:</p>
<pre><code class="hljs lang-css"><span class="hljs-tag">div</span><span class="hljs-class">.codehilite</span> <span class="hljs-tag">pre</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#fdf6e3</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Or, if you’re using Monokai, black will do:</p>
<pre><code class="hljs lang-css"><span class="hljs-tag">div</span><span class="hljs-class">.codehilite</span> <span class="hljs-tag">pre</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#000000</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>With that done, let’s record the additional Pygments style:</p>
<pre><code class="hljs lang-bash">$ pip freeze &gt; requirements.txt
</code></pre>
<p>And commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add requirements.txt blogengine/static/css/ templates/blogengine/includes/base.html
$ git commit -m <span class="hljs-string">'Styled code with Solarized Dark'</span>
</code></pre>
<p>Let’s run our tests:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
E
======================================================================
ERROR: blogengine.tests (unittest.loader.ModuleImportFailure)
----------------------------------------------------------------------
ImportError: Failed to import <span class="hljs-built_in">test</span> module: blogengine.tests
Traceback (most recent call last):
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">254</span>, <span class="hljs-keyword">in</span> _find_tests
    module = self._get_module_from_name(name)
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _get_module_from_name
    __import__(name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    import markdown
ImportError: No module named markdown


----------------------------------------------------------------------
Ran <span class="hljs-number">1</span> <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0.001</span>s

FAILED (errors=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Whoops! We introduced an error here. If we take a look, we can see that the problem is on line 7, where we import the Markdown module. That makes sense, as we now use a different implementation of Markdown. Fortunately, in Python you can import modules with a different name, which makes this a breeze to fix. Change the line to:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> markdown2 <span class="hljs-keyword">as</span> markdown
</code></pre>
<p>Now, if you run your tests, they should pass. It’s important that if a test breaks, you fix it as soon as possible and don’t put it off. Let’s commit these changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/tests.py
$ git commit -m <span class="hljs-string">'Fixed a broken test'</span>
</code></pre>
<p>Our syntax highlighting is now done! If you want to see it in action using the Solarized Dark theme, check out the copy of this blogging engine hosted <a href="http://blog.shellshocked.info/">here</a>.</p>
<h1 id="tidying-up">Tidying up</h1>
<p>Now that our blog is up and running on Heroku, it could do with a bit of work on the front end to make it look a bit nicer. If you recall, we’re using Bootstrap for our front end, so you may want to refer to the documentation for that to give you some ideas on how you want to style your blog.</p>
<p>Bootstrap has a nifty pager class for Next and Previous links, so let’s apply that to our post list template:</p>
<pre><code class="hljs lang-django"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pager"</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"previous"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span></span>
</code></pre>
<p>Let’s also add labels to our categories and tags. We’ll also place our posts and other content inside proper columns:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object_list %}</span><span class="xml">
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post col-md-12"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
            </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.category %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-primary"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> post.tags %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-success"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">else</span> %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>No posts found<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">

        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pager"</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"previous"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>We’ll also want to tidy up the layout for our individual post pages:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post col-md-12"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span></span><span class="hljs-variable">{{ object.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ object.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        </span><span class="hljs-variable">{{ object.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object.category %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ object.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-primary"</span>&gt;</span></span><span class="hljs-variable">{{ object.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object.tags %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> object.tags.all %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label label-success"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-md-12"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h4</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"fb-comments"</span> <span class="hljs-attribute">data-href</span>=<span class="hljs-value">"http://</span></span></span><span class="hljs-variable">{{ object.site }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value"></span></span></span><span class="hljs-variable">{{ object.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span> <span class="hljs-attribute">data-width</span>=<span class="hljs-value">"470"</span> <span class="hljs-attribute">data-num-posts</span>=<span class="hljs-value">"10"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>Time to commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add templates/blogengine/
$ git commit -m <span class="hljs-string">'Tidied up post templates'</span>
</code></pre>
<p>With that done, let’s turn our attention to our base template. We’ll amend the header to collapse down at smaller screen widths. This is easy to do with Bootstrap:</p>
<pre><code class="hljs lang-django"><span class="xml"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-comment">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="hljs-comment">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="hljs-comment">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="hljs-comment">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"no-js"</span>&gt;</span> <span class="hljs-comment">&lt;!--&lt;![endif]--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> title %}</span><span class="xml">My Django Blog</span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"description"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">""</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"alternate"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"application/rss+xml"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Blog posts"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span> &gt;</span>

        <span class="hljs-comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>

        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> staticfiles %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/normalize.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/main.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'css/code.css' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
        <span class="hljs-comment">&lt;!--[if lt IE 7]&gt;
            &lt;p class="browsehappy"&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;
        &lt;![endif]--&gt;</span>

        <span class="hljs-comment">&lt;!-- Add your site or application content here --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fb-root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, s, id)</span> </span>{
            <span class="hljs-keyword">var</span> js, fjs = d.getElementsByTagName(s)[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">if</span> (d.getElementById(id)) <span class="hljs-keyword">return</span>;
                js = d.createElement(s); js.id = id;
                js.src = <span class="hljs-string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span>;
                fjs.parentNode.insertBefore(js, fjs);
            }(<span class="hljs-built_in">document</span>, <span class="hljs-string">'script'</span>, <span class="hljs-string">'facebook-jssdk'</span>));</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container-fluid"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"button"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-toggle"</span> <span class="hljs-attribute">data-toggle</span>=<span class="hljs-value">"collapse"</span> <span class="hljs-attribute">data-target</span>=<span class="hljs-value">"#header-nav"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-brand"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/"</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"collapse navbar-collapse"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header-nav"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav"</span>&gt;</span>
                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> flatpages %}</span><span class="xml">
                        </span><span class="hljs-template_tag">{% get_flatpages <span class="hljs-keyword">as</span> flatpages %}</span><span class="xml">
                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> flatpage <span class="hljs-keyword">in</span> flatpages %}</span><span class="xml">
                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ flatpage.url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ flatpage.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
                        <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/feeds/posts/"</span>&gt;</span>RSS feed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> header %}</span><span class="xml">
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"page-header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">

            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
                </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml">
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container footer"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"span12"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Copyright &amp;copy; </span><span class="hljs-template_tag">{% <span class="hljs-keyword">now</span> "Y" %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">window</span>.jQuery || <span class="hljs-built_in">document</span>.write(<span class="hljs-string">'&lt;script src="</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/jquery-1.10.2.min.js' %}</span><span class="xml"><span class="javascript"><span class="hljs-string">"&gt;&lt;\/script&gt;')</span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/html5-boilerplate/js/plugins.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"</span></span></span><span class="hljs-template_tag">{% <span class="hljs-keyword">static</span> 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
            (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b,o,i,l,e,r)</span></span>{b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{(b[l].q=b[l].q||[]).push(<span class="hljs-built_in">arguments</span>)});b[l].l=+<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>;
            e=o.createElement(i);r=o.getElementsByTagName(i)[<span class="hljs-number">0</span>];
            e.src=<span class="hljs-string">'//www.google-analytics.com/analytics.js'</span>;
            r.parentNode.insertBefore(e,r)}(<span class="hljs-built_in">window</span>,<span class="hljs-built_in">document</span>,<span class="hljs-string">'script'</span>,<span class="hljs-string">'ga'</span>));
            ga(<span class="hljs-string">'create'</span>,<span class="hljs-string">'UA-XXXXX-X'</span>);ga(<span class="hljs-string">'send'</span>,<span class="hljs-string">'pageview'</span>);
        </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></span>
</code></pre>
<p>Here we’ve also added a link to our RSS feed in the header, and another in the page head to facilitate working with browsers that support RSS better.</p>
<p>Our blog’s now looking much more presentable. All that remains is to commit it:</p>
<pre><code class="hljs lang-bash">$ git add templates/blogengine/includes/base.html
$ git commit -m <span class="hljs-string">'Amended base template'</span>
</code></pre>
<p>Now we can push it to GitHub and deploy it on Heroku:</p>
<pre><code class="hljs lang-bash">$ git push origin master
$ git push heroku master
</code></pre>
<p>And we’re done! Don’t forget, you can grab this lesson with <code>git checkout lesson-6</code>.</p>
<p>Next time, we’ll cover search (I promise!).</p>

    </article>
    <article class="post">
        <p class="date">24th May 2014 8:15 pm</p>
        <h1><a href="/blog/2014/05/24/django-blog-tutorial-the-next-generation-part-5/">Django Blog Tutorial - the Next Generation - Part 5</a></h1>
        <p>Hello again! I was originally planning to cover implementing a search system, adding more feeds, and tidying up the front end in this instalment. However, I felt it was time for a change of pace, so instead, we’re going to look at:</p>
<ul>
<li>Checking code coverage and getting it to 100%</li>
<li>Using continuous integration</li>
<li>Deploying to Heroku</li>
</ul>
<p>Don’t worry, the original lesson isn’t going anywhere. We’ll still be implementing all of that later on, but today is the day we get your Django blog up and running on the web. That way, you can get a better idea of how Django works in the wild, and you have something concrete to show for your efforts.</p>
<h1 id="continuous-integration">Continuous integration</h1>
<p>If you’re not familiar with continuous integration, it’s basically a process that carries out some tasks automatically when you push a new commit to the repository. These tasks may include running unit tests, linting your code, and checking it to see what percentage of the code base is covered by the tests (after all, if your tests don’t actually cover every scenario, then there’s more of a chance that something might slip through the net. It’s also possible to implement hooks to automatically deploy your application only if the tests pass.</p>
<p>Typically, you will have a continuous integration server running somewhere that regularly polls your Git repository for changes, and when it finds a new commit, will check it out and run the tests (or whatever other task you configure it to). One of the most popular continuous integration servers around is <a href="http://jenkins-ci.org/">Jenkins</a> - I use it at work and can highly recommend it. However, we aren’t going to cover using Jenkins here because setting it up is quite a big deal and it really is best kept on a server of its own (although feel free to use it if you prefer). Instead, we’re going to use <a href="https://travis-ci.org/">Travis CI</a>, which integrates nicely with GitHub and is free for open source projects. If you don’t mind your code being publicly available on GitHub, then Travis is a really great way to dip your toe into continuous integration.</p>
<p>NB: You don’t have to use continuous integration at all if you don’t want to - this isn’t a big project so you don’t really need it. If you don’t want to put your code on GitHub, then feel free to just follow along and not bother pushing your code to GitHub and configuring Travis.</p>
<h1 id="code-coverage">Code coverage</h1>
<p>As mentioned above, code coverage is a measure of the percentage of the code that is covered by tests. While not infallible, it’s a fairly good guide to how comprehensive your tests are. If you have 100% code coverage, you can be fairly confident that your tests are comprehensive enough to catch most errors, so it’s a good rule of thumb to aim for 100% test coverage on a project.</p>
<p>So how do we check our test coverage? The <code>coverage</code> Python module is the most common tool for this. There’s also a handy Django module called <code>django-jenkins</code>, which is designed to work with Jenkins, but can be used with any continuous integration server, that can not only run your tests, but also check code coverage at the same time. So, make sure your virtualenv is up and running:</p>
<pre><code class="hljs lang-bash">$ <span class="hljs-built_in">source</span> venv/bin/activate
</code></pre>
<p>Then, run the following command:</p>
<pre><code class="hljs lang-bash">$ pip install coverage django-jenkins
</code></pre>
<p>Once that’s done, add these to our requirements file:</p>
<pre><code class="hljs lang-bash">$ pip freeze &gt; requirements.txt
</code></pre>
<p>We now need to configure our Django project to use <code>django-jenkins</code>. Add the following to the bottom of the settings file:</p>
<pre><code class="hljs lang-python">INSTALLED_APPS += (<span class="hljs-string">'django_jenkins'</span>,)
JENKINS_TASKS = (
    <span class="hljs-string">'django_jenkins.tasks.run_pylint'</span>,
    <span class="hljs-string">'django_jenkins.tasks.with_coverage'</span>,
)
PROJECT_APPS = [<span class="hljs-string">'blogengine'</span>]
</code></pre>
<p>This adds <code>django-jenkins</code> to our installed apps and tells it to include two additional tasks, besides running the tests. The first task runs Pylint to check our code quality (but we aren’t really concerned about that at this point). The second checks the coverage. Finally, we tell <code>django-jenkins</code> that the <code>blogengine</code> app is the only one to be tested.</p>
<p>You’ll also want to add the following lines to your <code>.gitignore</code>:</p>
<pre><code class="hljs lang-bash">reports/
htmlcov/
</code></pre>
<p>These are the reports generated by <code>django-jenkins</code>, and should not be kept under version control. With that done, it’s time to commit:</p>
<pre><code class="hljs lang-bash">$ git add .gitignore django_tutorial_blog_ng/ requirements.txt
$ git commit -m <span class="hljs-string">'Added coverage checking using django-jenkins'</span>
</code></pre>
<p>Now, let’s run our tests. From now on, you’ll use the following command to run your tests:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins
</code></pre>
<p>This ensures we check the coverage at the same time. Now, you’ll notice that the <code>reports</code> folder has been created, and it will contain three files, including one called <code>coverage.xml</code>. However, XML isn’t a very friendly format. Happily, we can easily generate reports in HTML instead:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins --coverage-html-report=htmlcov
</code></pre>
<p>Running this command will create another folder called <code>htmlcov/</code>, and in here you will find your report, nicely formatted as HTML. Open up <code>index.html</code> in your web browser and you should see a file-by-file breakdown of your code coverage. Nice, huh?</p>
<p>Now, if your code so far is largely identical to mine, you’ll notice that the model and view files don’t have 100% coverage yet. If you click on each one, you’ll see a handy line-by-line breakdown of the test coverage for each file. You’ll notice that in the views file, the areas of the code for when tags and categories don’t exist are highlighted in pink - this tells you that these lines of code are never executed during the tests. So let’s fix that.</p>
<p>First, our template needs to be able to handle empty lists.</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> object_list %}</span><span class="xml">
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
            </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
            </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">else</span> %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>No posts found<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">

        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>Let’s commit the changes:</p>
<pre><code class="hljs lang-bash">$ git add templates/blogengine/post_list.html
$ git commit -m <span class="hljs-string">'Added a "No posts found" message to post list template'</span>
</code></pre>
<p>Next, we need to write tests to check that we get a “No posts found” message when we view a tag or category that does not exist. Add the following methods to the class <code>PostViewTest()</code>:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_nonexistent_category_page</span><span class="hljs-params">(self)</span>:</span>
        category_url = <span class="hljs-string">'/category/blah/'</span>
        response = self.client.get(category_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
        self.assertTrue(<span class="hljs-string">'No posts found'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_nonexistent_tag_page</span><span class="hljs-params">(self)</span>:</span>
        tag_url = <span class="hljs-string">'/tag/blah/'</span>
        response = self.client.get(tag_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
        self.assertTrue(<span class="hljs-string">'No posts found'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>Now, let’s run our tests again:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins --coverage-html-report=htmlcov
</code></pre>
<p>Assuming they all pass as expected, then your coverage reports will be regenerated. If you reload the coverage report, you should see that your views now have 100% test coverage. Let’s commit again:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/tests.py
$ git commit -m <span class="hljs-string">'Views file now has 100% coverage'</span>
</code></pre>
<p>Now, our models still don’t have 100% coverage yet. If you look at the breakdown for <code>models.py</code>, you’ll see that the line <code>if not self.slug:</code> has only partial coverage, because we missed out setting a slug for the categories and tags in our test. So, let’s fix that. In <code>PostTest()</code>, amend the <code>test_create_category()</code> and <code>test_create_tag()</code> methods as follows:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()

        <span class="hljs-comment"># Add attributes</span>
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.slug = <span class="hljs-string">'python'</span>

        <span class="hljs-comment"># Save it</span>
        category.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
        only_category = all_categories[<span class="hljs-number">0</span>]
        self.assertEquals(only_category, category)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_category.description, <span class="hljs-string">'The Python programming language'</span>)
        self.assertEquals(only_category.slug, <span class="hljs-string">'python'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()

        <span class="hljs-comment"># Add attributes</span>
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.slug = <span class="hljs-string">'python'</span>

        <span class="hljs-comment"># Save it</span>
        tag.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
        only_tag = all_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_tag, tag)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_tag.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_tag.description, <span class="hljs-string">'The Python programming language'</span>)
        self.assertEquals(only_tag.slug, <span class="hljs-string">'python'</span>)
</code></pre>
<p>Run the tests again:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins --coverage-html-report=htmlcov
</code></pre>
<p>Then refresh your coverage page, and we should have hit 100% coverage. Excellent news! This means that we can be confident that if any problems get introduced in future, we can pick them up easily. To demonstrate this, let’s upgrade our Django install to the latest version and check everything still works as expected:</p>
<pre><code class="hljs lang-bash">$ pip install Django --upgrade
</code></pre>
<p>This will upgrade the copy of Django in our virtualenv to the latest version. Then we can run our tests again:</p>
<pre><code class="hljs lang-bash">$ python manage.py jenkins --coverage-html-report=htmlcov
</code></pre>
<p>Our tests should still pass, indicating that the upgrade to our Django version does not appear to have broken any functionality. Let’s update our <code>requirements.txt</code>:</p>
<pre><code class="hljs lang-bash">$ pip freeze &gt; requirements.txt
$ git add requirements.txt
$ git commit -m <span class="hljs-string">'Upgraded Django version'</span>
</code></pre>
<h1 id="preparing-our-web-app-for-deployment-to-heroku">Preparing our web app for deployment to Heroku</h1>
<p>As mentioned previously, I’m going to assume you plan to deploy your site on <a href="https://www.heroku.com/">Heroku</a>. It has good Django support, and you can quite happily host a blog there using their free tariff. If you’d prefer to use another hosting provider, then you should be able to adapt these instructions accordingly.</p>
<p>Now, so far we’ve used SQLite as our database for development purposes. However, SQLite isn’t really suitable for production purposes. Heroku provide a Postgresql database for each web app, so we will use that. To configure it, open up <code>settings.py</code> and amend the database configuration section to look like this:</p>
<pre><code class="hljs lang-python">DATABASES = {
    <span class="hljs-string">'default'</span>: {
        <span class="hljs-string">'ENGINE'</span>: <span class="hljs-string">'django.db.backends.'</span>,
        <span class="hljs-string">'NAME'</span>: <span class="hljs-string">''</span>,
    }
}
</code></pre>
<p>Then, add the following at the end of the file:</p>
<pre><code class="hljs lang-python">
<span class="hljs-comment"># Heroku config</span>
<span class="hljs-comment"># Parse database configuration from $DATABASE_URL</span>
<span class="hljs-keyword">import</span> dj_database_url
DATABASES[<span class="hljs-string">'default'</span>] =  dj_database_url.config(default=<span class="hljs-string">"sqlite:///db.sqlite3"</span>)

<span class="hljs-comment"># Honor the 'X-Forwarded-Proto' header for request.is_secure()</span>
SECURE_PROXY_SSL_HEADER = (<span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span>, <span class="hljs-string">'https'</span>)

<span class="hljs-comment"># Allow all host headers</span>
ALLOWED_HOSTS = [<span class="hljs-string">'*'</span>]

<span class="hljs-comment"># Static asset configuration</span>
STATIC_ROOT = <span class="hljs-string">'staticfiles'</span>

STATICFILES_DIRS = (
    os.path.join(BASE_DIR, <span class="hljs-string">'static'</span>),
)
</code></pre>
<p>A little explanation is called for. Remember when we first started out, we installed the <code>django-toolbelt</code> package, which included <code>dj-database-url</code>? Well, here we use the <code>dj_database_url</code> module to get the database from an environment variable set on Heroku. We set a default value so as to fall back to SQLite when that variable is not set. The other settings are required by Heroku.</p>
<p>You may want to run your tests again to ensure everything is still working before committing:</p>
<pre><code class="hljs lang-bash">$ git add django_tutorial_blog_ng/settings.py
$ git commit -m <span class="hljs-string">'Amended settings to work on desktop and Heroku'</span>
</code></pre>
<h1 id="setting-up-continuous-integration-and-coverage">Setting up Continuous Integration and coverage</h1>
<p>Now, as mentioned previously, I’ll be demonstrating how to set up Travis CI for our project. Travis CI is only free for open-source projects, so if you don’t want to make your code publicly accessible, you may want to use Jenkins instead. I’ll leave setting that up and running it as an exercise for the reader, but I recommend a plugin called Cobertura which allows you to publish details of your code’s test coverage.</p>
<p>Unfortunately, Travis CI doesn’t have the capability to publish your coverage results. Fortunately, you can use <a href="https://coveralls.io/">Coveralls.io</a> to pick up the slack. Like Travis, it’s free for open-source projects, and if you host your code on GitHub, it’s pretty easy to use.</p>
<p>You can find instructions on setting up a project on Travis CI <a href="http://docs.travis-ci.com/user/getting-started/">here</a>. Once you’ve configured it, you’ll need to set up your <code>.travis.yml</code> file. This is a simple text file that tells Travis CI how to run your tests. Put the following content in the file:</p>
<pre><code class="hljs lang-yml"><span class="hljs-label">language:</span> python
<span class="hljs-label">python:</span>
- <span class="hljs-string">"2.7"</span>
<span class="hljs-preprocessor"># command to install dependencies</span>
<span class="hljs-label">install:</span> <span class="hljs-string">"pip install -r requirements.txt"</span>
<span class="hljs-preprocessor"># command to run tests</span>
<span class="hljs-label">script:</span> coverage run --include=<span class="hljs-string">"blogengine/*"</span> --omit=<span class="hljs-string">"blogengine/migrations/*"</span> manage.py test blogengine
<span class="hljs-label">after_success:</span>
    coveralls
</code></pre>
<p>Now, this tells Travis that this is a Python application, and we should be using Python 2.7. Please note you can test against multiple versions of Python if you wish - just add another line with the Python version you want to test against.</p>
<p>Then, we see that we use Pip to install our requirements. Finally we run our tests with Coverage, in order to generate coverage data, and afterwards call <code>coveralls</code> to pass the coverage data to Coveralls.io.</p>
<p>We also need to install the <code>coveralls</code> module:</p>
<pre><code class="hljs lang-bash">$ pip install coveralls
$ pip freeze &gt; requirements.txt
</code></pre>
<p>And we need to keep our coverage data out of version control:</p>
<pre><code class="hljs lang-bash">env/
*.pyc
db.sqlite3
blogengine/static/bower_components/
reports/
htmlcov/
.coverage
</code></pre>
<p>You’ll also want to set up your project on Coveralls, as described <a href="https://coveralls.io/docs">here</a> - please note that this requires your project be in a public GitHub repository.</p>
<p>With that done, let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add .gitignore .travis.yml requirements.txt
$ git commit -m <span class="hljs-string">'Added Travis config file and Coveralls support'</span>
</code></pre>
<p>With that done, assuming you have Travis CI and Coveralls configured, and your code is already hosted on GitHub, then you should be able to just push your code up to trigger the build:</p>
<pre><code class="hljs lang-bash">$ git push origin master
</code></pre>
<p>If you keep an eye on Travis in your browser, you can watch what happens as your tests are run. If for any reason the build fails, then it shouldn’t be too hard to figure out what has gone wrong using the documentation for Travis and Coveralls - both services are pretty easy to use.</p>
<p>Congratulations - you’re now using Continuous Integration! That wasn’t so hard, was it? Now, every time you push to GitHub, Travis will run your tests, and you’ll get an email if they fail, giving you early warning of any problems, and you can check your coverage at the same time. Both Travis and Coveralls offer badges that you can place in your README file on GitHub to show off your coverage and build status - feel free to add these to your repo.</p>
<p>You may want to try making a change that breaks your tests and committing it, then pushing it up, so that you can see what happens when the build breaks.</p>
<h1 id="deploying-to-heroku">Deploying to Heroku</h1>
<p>Our final task today is deploying our blog to Heroku so we can see it in action. First of all, if you don’t already have an account with Heroku, you’ll need to sign up <a href="https://www.heroku.com/">here</a>. You should also be prompted to install the Heroku toolbelt. Once that’s done, run the following command:</p>
<pre><code class="hljs lang-bash">$ heroku login
</code></pre>
<p>You’ll be prompted for your credentials - enter these and you should be able to log in successfully.</p>
<p>Now, in order to run our Django app on Heroku, we’ll need to add a <code>Procfile</code> to tell Heroku what command to run in order to start your app. In this case, we will be using Gunicorn as our web server. Assuming our project is called <code>django_tutorial_blog_ng</code>, this is what you need to put in this file:</p>
<pre><code class="hljs lang-bash">web: gunicorn django_tutorial_blog_ng.wsgi
</code></pre>
<p>That tells Heroku that the file we need to run for this application is <code>django_tutorial_blog_ng/wsgi.py</code>. To test it, run the following command:</p>
<pre><code class="hljs lang-bash">$ foreman start
</code></pre>
<p>That will start our web server on port 5000, using Gunicorn rather than the Django development server. You should be able to see it in action <a href="http://127.0.0.1:5000/">here</a>, but you’ll notice a very serious issue - namely that the static files aren’t being served. Now, Django has a command called <code>collectstatic</code> that collects all the static files and drops them into one convenient folder. Heroku will run this command automatically, so we need to ensure our static files are available. Amend your <code>.gitignore</code> file so it no longer excludes our static files:</p>
<pre><code class="hljs lang-bash">venv/
*.pyc
db.sqlite3
reports/
htmlcov/
.coverage
</code></pre>
<p>We also need to amend our wsgi.py to serve static files:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> os
os.environ.setdefault(<span class="hljs-string">"DJANGO_SETTINGS_MODULE"</span>, <span class="hljs-string">"django_tutorial_blog_ng.settings"</span>)

<span class="hljs-keyword">from</span> django.core.wsgi <span class="hljs-keyword">import</span> get_wsgi_application
<span class="hljs-keyword">from</span> dj_static <span class="hljs-keyword">import</span> Cling

application = Cling(get_wsgi_application())
</code></pre>
<p>This should solve our problem. Let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add django_tutorial_blog_ng/wsgi.py Procfile blogengine/static/ .gitignore
$ git commit -m <span class="hljs-string">'Configured app for deployment on Heroku'</span>
</code></pre>
<p>Now we’re ready to deploy our app!</p>
<h1 id="deployment">Deployment</h1>
<p>Every Heroku app needs a unique name. If you don’t specify one, then Heroku will generate one for you. Your app will have the domain name <code>appname.herokuapp.com</code> - however, if you already have a domain name lined up for your blog, you can point that domain name at the Heroku app if you wish. I’m going to deploy mine with the name <code>blog-shellshocked-info</code>.</p>
<p>You also need to consider where you want to deploy it. Heroku has two regions - North America and EU. By default it will deploy to North America, but as I’m in the EU, that’s where I want to deploy my app to - obviously if you’re in the Americas, you may be better off sticking with North America.</p>
<p>So, let’s create our app. Here’s the command you need to run:</p>
<pre><code class="hljs lang-bash">$ heroku apps:create blog-shellshocked-info --region eu
</code></pre>
<p>You will want to change the app name, or remove it entirely if you’re happy for Heroku to generate one for you. If you want to host it in North America, drop the <code>--region eu</code> section.</p>
<p>Once completed, this will have created your new app, and added a Git remote for it, but will not have deployed it. To deploy your app, run this command:</p>
<pre><code class="hljs lang-bash">$ git push heroku master
</code></pre>
<p>That will push your code up to Heroku. Please note that building the app may take a little while. Once it’s done, you can run <code>heroku open</code> to open it in your web browser. You should see an error message stating that the relation <code>blogengine_post</code> does not exist. That’s because we need to create our database structure. Heroku allows you to easily run commands on your app with <code>heroku run</code>, so let’s create our database and run our migrations:</p>
<pre><code class="hljs lang-bash">$ heroku run python manage.py syncdb
$ heroku run python manage.py migrate
</code></pre>
<p>These are exactly the same commands you would run locally to create your database, but prefaced with <code>heroku run</code> so that they get run by Heroku. As usual, you will be prompted to create a superuser - you’ll want to do this so you can log into the admin.</p>
<p>That’s all for today! We’ve finally got our site up and running on Heroku, and set up continuous integration so our tests will get run for us. You can see an example of the site working <a href="http://blog.shellshocked.info/">here</a>. As usual, you can check out the latest version of the code with <code>git checkout lesson-5</code>. If you’d like a homework assignment, then take a look at <a href="http://docs.travis-ci.com/user/deployment/heroku/">automating deployment to Heroku on successful builds</a> and see if you can get it set up successfully.</p>
<p>Next time around, we’ll get back to implementing our search and tidying up the front end. See you then!</p>

    </article>
    <article class="post">
        <p class="date">15th February 2014 5:45 pm</p>
        <h1><a href="/blog/2014/02/15/django-blog-tutorial-the-next-generation-part-4/">Django Blog Tutorial - the Next Generation - Part 4</a></h1>
        <p>Hello again! As promised, in this instalment we’ll implement categories and tags, as well as an RSS feed.</p>
<p>As usual, we need to switch into our virtualenv:</p>
<pre><code class="hljs lang-bash">$ <span class="hljs-built_in">source</span> venv/bin/activate
</code></pre>
<h2 id="categories">Categories</h2>
<p>It’s worth taking a little time at this point to set out what we mean by categories and tags in this case, as the two can be very similar. In this case, we’ll use the following criteria:</p>
<ul>
<li>A post can have only one category, or none, but a category can be applied to any number of posts</li>
<li>A post can have any number of tags, and a tag can be applied to any number of posts</li>
</ul>
<p>If you’re not too familiar with relational database theory, the significance of this may not be apparent, so here’s a quick explanation. Because the categories are limited to one per post, the relationship between a post and a category is known as <em>one-to-many</em>. In other words, one post can only have one category, but one category can have many posts. You can therefore define the categories in one table in your database, and refer to them by their ID (the reference to the category in the post table is referred to as a <em>foreign key</em>).</p>
<p>As usual, we will write a test first. Open up <code>blogengine/tests.py</code> and edit the line importing the <code>Post</code> model as follows:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category
</code></pre>
<p>Also, add the following method before <code>test_create_post</code>:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()

        <span class="hljs-comment"># Add attributes</span>
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>

        <span class="hljs-comment"># Save it</span>
        category.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
        only_category = all_categories[<span class="hljs-number">0</span>]
        self.assertEquals(only_category, category)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_category.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre>
<p>This test checks that we can create categories. But categories aren’t much use unless we can actually apply them to our posts. So we need to edit our <code>Post</code> model as well, and to do so we need to have a test in place first. Edit the <code>test_create_post</code> method as follows:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()

        <span class="hljs-comment"># Set the attributes</span>
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)
        self.assertEquals(only_post.slug, <span class="hljs-string">'my-first-post'</span>)
        self.assertEquals(only_post.site.name, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.site.domain, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.pub_date.day, post.pub_date.day)
        self.assertEquals(only_post.pub_date.month, post.pub_date.month)
        self.assertEquals(only_post.pub_date.year, post.pub_date.year)
        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)
        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)
        self.assertEquals(only_post.pub_date.second, post.pub_date.second)
        self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
        self.assertEquals(only_post.author.email, <span class="hljs-string">'user@example.com'</span>)
        self.assertEquals(only_post.category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_post.category.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre>
<p>What we’re doing here is adding a <code>category</code> attribute to the posts. This attribute contains a reference to a <code>Category</code> object.</p>
<p>Now, we also want to test adding, editing, and deleting a category from the admin interface. Add this code to the <code>AdminTest</code> class:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/category/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/add/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
            },
            follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new category now in database</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/1/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
            }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check category amended</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
        only_category = all_categories[<span class="hljs-number">0</span>]
        self.assertEquals(only_category.name, <span class="hljs-string">'perl'</span>)
        self.assertEquals(only_category.description, <span class="hljs-string">'The Perl programming language'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check category deleted</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">0</span>)
</code></pre>
<p>This is very similar to the prior code for the posts, and just checks we can create categories via the admin. We also need to check we can apply these categories to posts, and that they don’t break the existing tests:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.site = site
        post.author = author
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post deleted</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)
</code></pre>
<p>Here we basically take our existing post tests in the admin interface and add the category to them. Finally, we edit the <code>PostViewTest</code> class to include categories:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>Now it’s time to run our tests:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
E
======================================================================
ERROR: blogengine.tests (unittest.loader.ModuleImportFailure)
----------------------------------------------------------------------
ImportError: Failed to import <span class="hljs-built_in">test</span> module: blogengine.tests
Traceback (most recent call last):
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">254</span>, <span class="hljs-keyword">in</span> _find_tests
    module = self._get_module_from_name(name)
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _get_module_from_name
    __import__(name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">3</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    from blogengine.models import Post, Category
ImportError: cannot import name Category


----------------------------------------------------------------------
Ran <span class="hljs-number">1</span> <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0.000</span>s

FAILED (errors=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>This is the expected result. We need to create our Category model. So let’s do that:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre>
<p>Note that we add <code>Category</code> before <code>Post</code> - this is because <code>Category</code> is a foreign key in <code>Post</code>, and must be defined in order to be used. Also, note that we add the <code>category</code> attribute as a <code>ForeignKey</code> field, like <code>User</code> and <code>Site</code>, indicating that it is an item in another table being references.</p>
<p>We also allow for <code>category</code> to be blank or null, so the user does not have to apply a category if they don’t wish to.</p>
<p>If we run our tests, they should still fail:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
EEFEEEEE...EE
======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_category (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">20</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_category
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">37</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">215</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">192</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_delete_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">304</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">165</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">250</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_index (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">353</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_index
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: <span class="hljs-built_in">test</span>_post_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">403</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_post_page
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">13</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.393</span>s

FAILED (failures=<span class="hljs-number">1</span>, errors=<span class="hljs-number">9</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>The category table hasn’t yet been created, so we need to use South to create and run the migrations:</p>
<pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
$ python manage.py migrate
</code></pre>
<p>If we then run our tests again, some of them will still fail:</p>
<pre><code class="hljs lang-bash">Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..F.F.F......
======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">142</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_delete_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">201</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">175</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_category
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">13</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">4.047</span>s

FAILED (failures=<span class="hljs-number">3</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>That’s because we haven’t registered the categories in the admin. So, that’s our next job:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostAdmin</span><span class="hljs-params">(admin.ModelAdmin)</span>:</span>
    prepopulated_fields = {<span class="hljs-string">"slug"</span>: (<span class="hljs-string">"title"</span>,)}
    exclude = (<span class="hljs-string">'author'</span>,)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_model</span><span class="hljs-params">(self, request, obj, form, change)</span>:</span>
        obj.author = request.user
        obj.save()

admin.site.register(models.Category)
admin.site.register(models.Post, PostAdmin)
</code></pre>
<p>Now we try again:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.............
----------------------------------------------------------------------
Ran <span class="hljs-number">13</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">4.092</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>It passes! Let’s do a quick sense check before committing. Run the server:</p>
<pre><code class="hljs lang-bash">$ python manage.py runserver
</code></pre>
<p>If you visit the <a href="http://127.0.0.1:8000/admin/">admin</a>, you’ll see the text for category is <code>Categorys</code>, which is incorrect. We also don’t have a good representation of the category in the admin. Let’s fix that:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        verbose_name_plural = <span class="hljs-string">'categories'</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre>
<p>Let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/
$ git commit -m <span class="hljs-string">'Implemented categories'</span>
</code></pre>
<p>Now, as yet our categories don’t actually do all that much. We would like to be able to:</p>
<ul>
<li>List all posts under a category</li>
<li>Show the post category at the base of the post</li>
</ul>
<p>So, let’s implement that. First, as usual, we implement tests first:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>All we do here is assert that for both the post pages and the index, the text from the category name is shown in the response. We also need to check the category-specific route works. Add this method to <code>PostViewTest</code>:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_category_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the category URL</span>
        category_url = post.category.get_absolute_url()

        <span class="hljs-comment"># Fetch the category</span>
        response = self.client.get(category_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the category name is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>This is very similar to the previous tests, but fetches the absolute URL for the category, and ensures the category name and post content are shown. Now, let’s run our new tests:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
...........EFF
======================================================================
ERROR: <span class="hljs-built_in">test</span>_category_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">494</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_category_page
    category_url = post.category.get_absolute_url()
AttributeError: <span class="hljs-string">'Category'</span> object has no attribute <span class="hljs-string">'get_absolute_url'</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_index (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">391</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_index
    self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_post_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">446</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_post_page
    self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">14</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.017</span>s

FAILED (failures=<span class="hljs-number">2</span>, errors=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Let’s take a look at why they failed. <code>test_category_page</code> failed because the <code>Category</code> object had no method <code>get_absolute_url</code>. So we need to implement one. To do so, we really need to add a slug field, like the posts already have. Ideally, we want this to be populated automatically, but with the option to create one manually. So, edit the models as follows:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site
<span class="hljs-keyword">from</span> django.utils.text <span class="hljs-keyword">import</span> slugify

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.slug:
            self.slug = slugify(unicode(self.name))
        super(Category, self).save()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/category/%s/"</span> % (self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        verbose_name_plural = <span class="hljs-string">'categories'</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre>
<p>We’re adding the <code>slug</code> attribute to the <code>Category</code> model here. However, we’re also overriding the <code>save</code> method to detect if the slug is set, and if not, to create a slug using the <code>slugify</code> function, and set it as the category’s slug. We also define an absolute URL for the category.</p>
<p>Now, if you run the tests, they will fail because we haven’t made the changes to the database. So, we use South again:</p>
<pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
</code></pre>
<p>Then run the migration:</p>
<pre><code class="hljs lang-bash">$ python manage.py migrate
</code></pre>
<p>Now, running our tests will show that the tables are in place, but we still have some work to do. The index and post pages don’t show our categories, so we’ll fix that. First, we’ll fix our post list:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">

        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>Next, we’ll take care of our post detail page:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span></span><span class="hljs-variable">{{ object.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ object.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        </span><span class="hljs-variable">{{ object.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ object.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ object.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h4</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"fb-comments"</span> <span class="hljs-attribute">data-href</span>=<span class="hljs-value">"http://</span></span></span><span class="hljs-variable">{{ post.site }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value"></span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span> <span class="hljs-attribute">data-width</span>=<span class="hljs-value">"470"</span> <span class="hljs-attribute">data-num-posts</span>=<span class="hljs-value">"10"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>Note that in both cases we include a link to the category URL.</p>
<p>Now, we should only have one failing test outstanding - the category page. For this, generic views aren’t sufficient as we need to limit the queryset to only show those posts with a specific category. Fortunately, we can extend Django’s generic views to add this functionality. First, we edit our URLconfs:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category
<span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView

urlpatterns = patterns(<span class="hljs-string">''</span>,
    <span class="hljs-comment"># Index</span>
    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
        model=Post,
        paginate_by=<span class="hljs-number">5</span>,
        )),

    <span class="hljs-comment"># Individual posts</span>
    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
        model=Post,
        )),

    <span class="hljs-comment"># Categories</span>
    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
        paginate_by=<span class="hljs-number">5</span>,
        model=Category,
        )),
)
</code></pre>
<p>Note we import a new view from <code>blogengine.views</code> called <code>CategoryListView</code>. Next, we create that listview:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post

<span class="hljs-comment"># Create your views here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
        <span class="hljs-keyword">try</span>:
            category = Category.objects.get(slug=slug)
            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
        <span class="hljs-keyword">except</span> Category.DoesNotExist:
            <span class="hljs-keyword">return</span> Post.objects.none()
</code></pre>
<p>This is quite simple. We import the <code>ListView</code>, as well as our models. Then we extend <code>ListView</code> by getting the slug from the request, fetching the appropriate category, and returning only those posts that have that category. If the category does not exist, we return the empty <code>Post</code> object list. We haven’t had to set the template manually as it is inherited from <code>ListView</code>.</p>
<p>If you run the tests, they should now pass:</p>
<pre><code class="hljs lang-bash">Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..............
----------------------------------------------------------------------
Ran <span class="hljs-number">14</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.083</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>So let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/ templates/
$ git commit -m <span class="hljs-string">'Categories are now shown'</span>
</code></pre>
<h2 id="tags">Tags</h2>
<p>Tags are fairly similar to categories, but more complex. The relationship they have is called <em>many-to-many</em> - in other words, a tag can be applied to many posts, and one post can have many tags. This is more difficult to model with a relational database. The usual way to do so is to create an intermediate table between the posts and tags, to identify mappings between the two. Fortunately, Django makes this quite easy.</p>
<p>Let’s write the tests for our tagging system. As with the categories, we’ll write the tests for creating and editing them first, and add in tests for them being visible later. First we’ll create a test for creating a new tag object:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()

        <span class="hljs-comment"># Add attributes</span>
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>

        <span class="hljs-comment"># Save it</span>
        tag.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
        only_tag = all_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_tag, tag)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_tag.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_tag.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre>
<p>Next, we’ll amend the test for creating a post to include tags:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()

        <span class="hljs-comment"># Set the attributes</span>
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Add the tag</span>
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)
        self.assertEquals(only_post.slug, <span class="hljs-string">'my-first-post'</span>)
        self.assertEquals(only_post.site.name, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.site.domain, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.pub_date.day, post.pub_date.day)
        self.assertEquals(only_post.pub_date.month, post.pub_date.month)
        self.assertEquals(only_post.pub_date.year, post.pub_date.year)
        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)
        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)
        self.assertEquals(only_post.pub_date.second, post.pub_date.second)
        self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
        self.assertEquals(only_post.author.email, <span class="hljs-string">'user@example.com'</span>)
        self.assertEquals(only_post.category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_post.category.description, <span class="hljs-string">'The Python programming language'</span>)

        <span class="hljs-comment"># Check tags</span>
        post_tags = only_post.tags.all()
        self.assertEquals(len(post_tags), <span class="hljs-number">1</span>)
        only_post_tag = post_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_post_tag, tag)
        self.assertEquals(only_post_tag.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_post_tag.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre>
<p>Note the difference in how we apply the tags. Because a post can have more than one tag, we can’t just define <code>post.tag</code> in the same way. Instead, we have <code>post.tags</code>, which you can think of as a list, and we use the <code>add</code> method to add a new tag. Note also that the post must already exist before we can add a tag.</p>
<p>We also need to create acceptance tests for creating, editing and deleting tags:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
            },
            follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new tag now in database</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/1/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
            }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check tag amended</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
        only_tag = all_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_tag.name, <span class="hljs-string">'perl'</span>)
        self.assertEquals(only_tag.description, <span class="hljs-string">'The Perl programming language'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check tag deleted</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">0</span>)
</code></pre>
<p>These tests are virtually identical to those for the <code>Category</code> objects, as we plan for our <code>Tag</code> objects to be very similar. Finally, we need to amend the acceptance tests for <code>Post</code> objects to include a tag:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'tags'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'tags'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.site = site
        post.author = author
        post.category = category
        post.save()
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post deleted</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)
</code></pre>
<p>Here we’re just adding tags to our <code>Post</code> objects.</p>
<p>Now it’s time to run our tests to make sure they fail as expected:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
E
======================================================================
ERROR: blogengine.tests (unittest.loader.ModuleImportFailure)
----------------------------------------------------------------------
ImportError: Failed to import <span class="hljs-built_in">test</span> module: blogengine.tests
Traceback (most recent call last):
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">254</span>, <span class="hljs-keyword">in</span> _find_tests
    module = self._get_module_from_name(name)
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _get_module_from_name
    __import__(name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">3</span>, <span class="hljs-keyword">in</span> &lt;module&gt;
    from blogengine.models import Post, Category, Tag
ImportError: cannot import name Tag


----------------------------------------------------------------------
Ran <span class="hljs-number">1</span> <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0.000</span>s

FAILED (errors=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>So here we can’t import our <code>Tag</code> model, because we haven’t created it. So, we’ll do that:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tag</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.slug:
            self.slug = slugify(unicode(self.name))
        super(Tag, self).save()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/tag/%s/"</span> % (self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name
</code></pre>
<p>Our <code>Tag</code> model is very much like our <code>Category</code> model, but we don’t need to change the <code>verbose_name_plural</code> value, and we amend the absolute URL to show it as a tag rather than a category.</p>
<p>We also need to amend our <code>Post</code> model to include a <code>tags</code> field:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-keyword">True</span>, null=<span class="hljs-keyword">True</span>)
    tags = models.ManyToManyField(Tag)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre>
<p>Note that <code>tags</code> is a <code>ManyToManyField</code>, and we pass through the model we wish to use, much like we did with the categories. The difference is that one tag can be applied to many posts and a post can have many tags, so we need an intermediate database table to handle the relationship between the two. With Django’s ORM we can handle this quickly and easily.</p>
<p>Run our tests and they should still fail:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.EE.EF.EE.EE......
======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">64</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_tag (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">41</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_tag
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">335</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: <span class="hljs-built_in">test</span>_delete_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">440</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">306</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">377</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">279</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line <span class="hljs-number">34</span>, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table
    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__
    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">256</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">18</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.981</span>s

FAILED (failures=<span class="hljs-number">1</span>, errors=<span class="hljs-number">7</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Again, we can easily see why they failed - the <code>blogengine_tag</code> table is not in place. So let’s create and run our migrations to fix that:</p>
<pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
$ python manage.py migrate
</code></pre>
<p>Now, we run our tests again:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.....F..F..F......
======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">256</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_delete_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">315</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_delete_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">289</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_tag
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">18</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.124</span>s

FAILED (failures=<span class="hljs-number">3</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>We can’t yet amend our tags in the admin, because we haven’t registered them. So we do that next:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostAdmin</span><span class="hljs-params">(admin.ModelAdmin)</span>:</span>
    prepopulated_fields = {<span class="hljs-string">"slug"</span>: (<span class="hljs-string">"title"</span>,)}
    exclude = (<span class="hljs-string">'author'</span>,)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_model</span><span class="hljs-params">(self, request, obj, form, change)</span>:</span>
        obj.author = request.user
        obj.save()

admin.site.register(models.Category)
admin.site.register(models.Tag)
admin.site.register(models.Post, PostAdmin)
</code></pre>
<p>Now, if we run our tests, they should pass:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..................
----------------------------------------------------------------------
Ran <span class="hljs-number">18</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.444</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Time to commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/
$ git commit -m <span class="hljs-string">'Implemented tags'</span>
</code></pre>
<p>Now, like with the categories beforehand, we want to be able to show the tags applied to a post at the base of it, and list all posts for a specific tag. So, first of all, we’ll amend our <code>PostViewTest</code> class to check for the tags:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'perl'</span>
        tag.description = <span class="hljs-string">'The Perl programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()
        post.tags.add(tag)

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post tag is in the response</span>
        post_tag = all_posts[<span class="hljs-number">0</span>].tags.all()[<span class="hljs-number">0</span>]
        self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'perl'</span>
        tag.description = <span class="hljs-string">'The Perl programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post tag is in the response</span>
        post_tag = all_posts[<span class="hljs-number">0</span>].tags.all()[<span class="hljs-number">0</span>]
        self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>We create a tag near the top, and check for the text in the page (note that to avoid false positives from the categories, we set the name of the tags to something different). We do this on both the index and post pages.</p>
<p>We also need to put a test in place for the tag-specific page:</p>
<pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_tag_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()
        post.tags.add(tag)

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the tag URL</span>
        tag_url = post.tags.all()[<span class="hljs-number">0</span>].get_absolute_url()

        <span class="hljs-comment"># Fetch the tag</span>
        response = self.client.get(tag_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the tag name is in the response</span>
        self.assertTrue(post.tags.all()[<span class="hljs-number">0</span>].name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>Again, this is virtually identical to the category page, adjusted to allow for the fact that we need to get a specific tag. If we now run our tests, they should fail as expected:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
................FFF
======================================================================
FAIL: <span class="hljs-built_in">test</span>_index (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">540</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_index
    self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_post_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">607</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_post_page
    self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_tag_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">714</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_tag_page
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">19</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.375</span>s

FAILED (failures=<span class="hljs-number">3</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>So, we need to implement the following things:</p>
<ul>
<li>Show tags on the index page</li>
<li>Show tags on the post pages</li>
<li>Create a page listing the posts with a specific tag</li>
</ul>
<p>As we have seen already with the categories, this is actually quite simple. First, we’ll sort out the tags on the index page:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        </span><span class="hljs-variable">{{ post.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">

        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">if</span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/</span></span></span><span class="hljs-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endif</span> %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>This is quite simple. We retrieve all the tags with <code>post.tags.all</code> and loop through them. We then do basically the same for the individual post pages:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span></span><span class="hljs-variable">{{ object.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ object.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        </span><span class="hljs-variable">{{ object.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ object.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ object.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"</span></span></span><span class="hljs-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span><span class="hljs-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml">

        <span class="hljs-tag">&lt;<span class="hljs-title">h4</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"fb-comments"</span> <span class="hljs-attribute">data-href</span>=<span class="hljs-value">"http://</span></span></span><span class="hljs-variable">{{ post.site }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value"></span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span> <span class="hljs-attribute">data-width</span>=<span class="hljs-value">"470"</span> <span class="hljs-attribute">data-num-posts</span>=<span class="hljs-value">"10"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>This should resolve two of our outstanding tests:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..................F
======================================================================
FAIL: <span class="hljs-built_in">test</span>_tag_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">714</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_tag_page
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">19</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.440</span>s

FAILED (failures=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>The final test is for the tag pages. As we saw with the categories, we can limit our querysets on specific pages. So we’ll extend the <code>ListView</code> generic view again to handle tags:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post, Tag

<span class="hljs-comment"># Create your views here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
        <span class="hljs-keyword">try</span>:
            category = Category.objects.get(slug=slug)
            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
        <span class="hljs-keyword">except</span> Category.DoesNotExist:
            <span class="hljs-keyword">return</span> Post.objects.none()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagListView</span><span class="hljs-params">(ListView)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
        <span class="hljs-keyword">try</span>:
            tag = Tag.objects.get(slug=slug)
            <span class="hljs-keyword">return</span> tag.post_set.all()
        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
            <span class="hljs-keyword">return</span> Post.objects.none()
</code></pre>
<p>Note that here, <code>Tag</code> objects have access to their assigned <code>Post</code> objects - we just use <code>post_set</code> to refer to them and get all of the posts associated with that tag. Next we’ll add the URLconfs:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category, Tag
<span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView

urlpatterns = patterns(<span class="hljs-string">''</span>,
    <span class="hljs-comment"># Index</span>
    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
        model=Post,
        paginate_by=<span class="hljs-number">5</span>,
        )),

    <span class="hljs-comment"># Individual posts</span>
    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
        model=Post,
        )),

    <span class="hljs-comment"># Categories</span>
    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
        paginate_by=<span class="hljs-number">5</span>,
        model=Category,
        )),

    <span class="hljs-comment"># Tags</span>
    url(<span class="hljs-string">r'^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagListView.as_view(
        paginate_by=<span class="hljs-number">5</span>,
        model=Tag,
        )),
)
</code></pre>
<p>We import the <code>Tag</code> model and the <code>TagListView</code> view, and use them to set up the tag page.</p>
<p>If we now run our tests again, they should pass:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
...................
----------------------------------------------------------------------
Ran <span class="hljs-number">19</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.473</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Well done! Time to commit:</p>
<pre><code class="hljs lang-bash">$ git add templates/ blogengine/
$ git commit -m <span class="hljs-string">'Tags are now shown'</span>
</code></pre>
<h2 id="rss-feed">RSS Feed</h2>
<p>For the final task today, we’ll implement an RSS feed for our posts. Django ships with a handy syndication framework that makes it easy to implement this kind of functionality.</p>
<p>As usual, we’ll create some tests first. In this case, we won’t be adding any new models, so we don’t need to test them. Instead we can jump straight into creating acceptance tests for our feed. For now we’ll just create one type of feed: a feed of all the blog posts. In a later instalment we’ll add feeds for categories and tags.</p>
<p>First of all, we’ll implement our test. Now, in order to test our feed, we need to have a solution in place for parsing an RSS feed. Django won’t do this natively, so we’ll install the <code>feedparser</code> Python module. Run the following commands:</p>
<pre><code class="hljs lang-bash">$ pip install feedparser
$ pip freeze &gt; requirements.txt
</code></pre>
<p>Once that’s done, feedparser should be available. You may wish to refer to the <a href="http://pythonhosted.org/feedparser/">documentation</a> as we go to help.</p>
<p>Let’s write our test for the RSS feed. First, we import feedparser near the top of the file:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> feedparser
</code></pre>
<p>Then we define a new class for our feed tests. Put this towards the end of the file - I put it just before the flat page tests:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeedTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_all_post_feed</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create a post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Add the tag</span>
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Fetch the feed</span>
        response = self.client.get(<span class="hljs-string">'/feeds/posts/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Parse the feed</span>
        feed = feedparser.parse(response.content)

        <span class="hljs-comment"># Check length</span>
        self.assertEquals(len(feed.entries), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Check post retrieved is the correct one</span>
        feed_post = feed.entries[<span class="hljs-number">0</span>]
        self.assertEquals(feed_post.title, post.title)
        self.assertEquals(feed_post.description, post.text)
</code></pre>
<p>Run the tests and you’ll see something like this:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..............F.....
======================================================================
FAIL: <span class="hljs-built_in">test</span>_all_post_feed (blogengine.tests.FeedTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">781</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_all_post_feed
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">20</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">6.743</span>s

FAILED (failures=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>We’re getting a 404 error because the post feed isn’t implemented. So let’s implement it. We’re going to use Django’s syndication framework, which will make it easy, but we need to enable it. Open up <code>django_tutorial_blog_ng/settings/py</code> and add the following under <code>INSTALLED_APPS</code>:</p>
<pre><code class="hljs lang-python">    <span class="hljs-string">'django.contrib.syndication'</span>,
</code></pre>
<p>Next, we need to enable the URLconf for this RSS feed. Open up <code>blogengine/urls.py and amend the import from</code>blogengine.views` near the top:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView, PostsFeed
</code></pre>
<p>Further down, add in the following code to define the URL for the feed:</p>
<pre><code class="hljs lang-python">    <span class="hljs-comment"># Post RSS feed</span>
    url(<span class="hljs-string">r'^feeds/posts/$'</span>, PostsFeed()),
</code></pre>
<p>Note that we imported the PostsFeed class, but that hasn’t yet been defined. So we need to do that. First of all, add this line near the top:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.contrib.syndication.views <span class="hljs-keyword">import</span> Feed
</code></pre>
<p>This imports the syndication views - yes, they’re another generic view! Our <code>PostsFeed</code> class is going to inherit from <code>Feed</code>. Next, we define the class:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostsFeed</span><span class="hljs-params">(Feed)</span>:</span>
    title = <span class="hljs-string">"RSS feed - posts"</span>
    link = <span class="hljs-string">"feeds/posts/"</span>
    description = <span class="hljs-string">"RSS feed - blog posts"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> Post.objects.order_by(<span class="hljs-string">'-pub_date'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_title</span><span class="hljs-params">(self, item)</span>:</span>
        <span class="hljs-keyword">return</span> item.title

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_description</span><span class="hljs-params">(self, item)</span>:</span>
        <span class="hljs-keyword">return</span> item.text
</code></pre>
<p>This is fairly straightforward. We define our title, link, and description for the feed inside the class definition. We define the <code>items</code> method which sets what items are returned by the RSS feed. We also define the <code>item_title</code> and <code>item_description</code> methods.</p>
<p>Now, if we run our tests, they should pass:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
....................
----------------------------------------------------------------------
Ran <span class="hljs-number">20</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">5.933</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Let’s commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/ django_tutorial_blog_ng/ requirements.txt
$ git commit -m <span class="hljs-string">'RSS feed implemented'</span>
</code></pre>
<p>And that’s enough for now. Don’t forget, you can get the code for this lesson by cloning the repository from <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">Github</a> and running <code>git checkout lesson-4</code> to switch to this lesson.</p>
<p>Next time we’ll:</p>
<ul>
<li>Implement a search system</li>
<li>Add feeds for categories and posts</li>
<li>Tidy up the user interface</li>
</ul>
<p>Hope to see you then!</p>

    </article>
    <article class="post">
        <p class="date">25th January 2014 11:38 am</p>
        <h1><a href="/blog/2014/01/25/my-first-yeoman-generator/">My First Yeoman Generator</a></h1>
        <p>At work I use the <a href="http://www.getskeleton.com/">Skeleton boilerplate</a> a lot - my boss, who handles most of the design work, likes it and generally uses it for his designs. I’ve also been using <a href="http://gruntjs.com/">Grunt</a> a lot lately, so it was inevitable that I’d probably start to look for a <a href="http://yeoman.io/">Yeoman</a> generator for working with it.</p>
<p>There was an existing Yeoman generator for Skeleton, but it didn’t really do what I wanted. I wanted something that:</p>
<ul>
<li>Included jQuery and Modernizr</li>
<li>Automatically concatenates and minifies all the JavaScript and CSS</li>
<li>Will automatically rebuild on changes</li>
<li>Includes LiveReload and a development server</li>
<li>Includes automatic deployment via FTP</li>
</ul>
<p>After looking through the documentation for Yeoman, it was actually quick and easy to throw together my own generator and put it up. It’s available <a href="https://npmjs.org/package/generator-skellington">here</a>, and the GitHub repository is <a href="https://github.com/matthewbdaly/generator-skellington">here</a>.</p>
<p>Future plans for it include:</p>
<ul>
<li>Adding auto-prefixing for CSS</li>
<li>Removing redundant CSS rules automatically</li>
<li>Possibly, alternate deployment methods</li>
</ul>
<p>Frustratingly, NPM seems to be playing up at present - it’s not picking up the README file, and the Yeoman site isn’t pulling it in. Any idea why, anyone?</p>

    </article>
    <article class="post">
        <p class="date">3rd January 2014 12:57 pm</p>
        <h1><a href="/blog/2014/01/03/django-blog-tutorial-the-next-generation-part-3/">Django Blog Tutorial - the Next Generation - Part 3</a></h1>
        <p>Hello again! In this instalment, we’re going to do the following:</p>
<ul>
<li>Add support for flat pages</li>
<li>Add support for multiple authors</li>
<li>Add a third-party comment system</li>
</ul>
<h2 id="flat-pages">Flat pages</h2>
<p>Django ships with a number of useful apps - we’ve already used the admin interface. The flat pages app is another very handy app that comes with Django, and we’ll use it to allow the blog author to create a handful of flat pages.</p>
<p>First of all, you’ll need to install the flatpages app. Edit the <code>INSTALLED_APPS</code> setting as follows:</p>
<pre><code class="hljs lang-python">INSTALLED_APPS = (
    <span class="hljs-string">'django.contrib.admin'</span>,
    <span class="hljs-string">'django.contrib.auth'</span>,
    <span class="hljs-string">'django.contrib.contenttypes'</span>,
    <span class="hljs-string">'django.contrib.sessions'</span>,
    <span class="hljs-string">'django.contrib.messages'</span>,
    <span class="hljs-string">'django.contrib.staticfiles'</span>,
    <span class="hljs-string">'south'</span>,
    <span class="hljs-string">'blogengine'</span>,
    <span class="hljs-string">'django.contrib.sites'</span>,
    <span class="hljs-string">'django.contrib.flatpages'</span>,
)
</code></pre>
<p>Note that we needed to enable the <code>sites</code> framework as well. You’ll also need to set the <code>SITE_ID</code> setting:</p>
<pre><code class="hljs lang-python">SITE_ID = <span class="hljs-number">1</span>
</code></pre>
<p>With that done, run <code>python manage.py syncdb</code> to create the required database tables. Now, let’s use the <code>sqlall</code> command to take a look at the database structure generated for the flat pages:</p>
<pre><code class="hljs lang-sql"><span class="hljs-operator"><span class="hljs-keyword">BEGIN</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">"django_flatpage_sites"</span> (
    <span class="hljs-string">"id"</span> <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>,
    <span class="hljs-string">"flatpage_id"</span> <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"site_id"</span> <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">"django_site"</span> (<span class="hljs-string">"id"</span>),
    <span class="hljs-keyword">UNIQUE</span> (<span class="hljs-string">"flatpage_id"</span>, <span class="hljs-string">"site_id"</span>)
)
;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">"django_flatpage"</span> (
    <span class="hljs-string">"id"</span> <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>,
    <span class="hljs-string">"url"</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"title"</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"content"</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"enable_comments"</span> bool <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"template_name"</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">70</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"registration_required"</span> bool <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
)
;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-string">"django_flatpage_sites_872c4601"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"django_flatpage_sites"</span> (<span class="hljs-string">"flatpage_id"</span>);</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-string">"django_flatpage_sites_99732b5c"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"django_flatpage_sites"</span> (<span class="hljs-string">"site_id"</span>);</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-string">"django_flatpage_c379dc61"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"django_flatpage"</span> (<span class="hljs-string">"url"</span>);</span>

<span class="hljs-operator"><span class="hljs-keyword">COMMIT</span>;</span>
</code></pre>
<p>As mentioned previously, all models in Django have an <code>id</code> attribute by default. Each flat page also has a URL, title, and content. </p>
<p>Also note the separate <code>django_flatpage_sites</code> table, which maps sites to flat pages. Django can run multiple sites from the same web app, and so flat pages must be allocated to a specific site. This relationship is a many-to-many relationship, so one flat page can appear on more than one site.</p>
<p>The other fields <a href="http://127.0.0.1:8000/admin/flatpages/flatpage/add/">are hidden by default in the admin</a> and can be ignored. Let’s have a go with Django’s handy shell to explore the flatpage. Run <code>python manage.py shell</code> and you’ll be able to interact with your Django application interactively:</p>
<pre><code class="hljs lang-python">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py shell
Python 2.7.6 (default, Nov 23 2013, 13:53:45)
[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
&gt;&gt;&gt; from django.contrib.flatpages.models import *
&gt;&gt;&gt; FlatPage
&lt;class 'django.contrib.flatpages.models.FlatPage'&gt;
&gt;&gt;&gt; from django.contrib.sites.models import Site
&gt;&gt;&gt; Site.objects.all()
[&lt;Site: example.com&gt;]
</code></pre>
<p>As you can see, <code>flatpages</code> is a Django app similar to the <code>blogengine</code> one, with its own models, as is <code>sites</code>. You can see that the <code>FlatPage</code> class is a model. We can create an instance of it and save it interactively:</p>
<pre><code class="hljs lang-python"><span class="hljs-prompt">&gt;&gt;&gt; </span>f = FlatPage()
<span class="hljs-prompt">&gt;&gt;&gt; </span>f.url = <span class="hljs-string">'/about/'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>f.title = <span class="hljs-string">'About me'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>f.content = <span class="hljs-string">'All about me'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>f.save()
<span class="hljs-prompt">&gt;&gt;&gt; </span>f.sites.add(Site.objects.all()[<span class="hljs-number">0</span>])
<span class="hljs-prompt">&gt;&gt;&gt; </span>f.save()
</code></pre>
<p>Note that because the relationship between the site and the flat page is a many-to-many relationship, we need to save it first, then use the <code>add</code> method to add the site to the list of sites.</p>
<p>We can retrieve it:</p>
<pre><code class="hljs lang-python"><span class="hljs-prompt">&gt;&gt;&gt; </span>FlatPage.objects.all()
[&lt;FlatPage: /about/ -- About me&gt;]
<span class="hljs-prompt">&gt;&gt;&gt; </span>FlatPage.objects.all()[<span class="hljs-number">0</span>]
&lt;FlatPage: /about/ -- About me&gt;
<span class="hljs-prompt">&gt;&gt;&gt; </span>FlatPage.objects.all()[<span class="hljs-number">0</span>].title
<span class="hljs-string">u'About me'</span>
</code></pre>
<p>This command is often handy for debugging problems with your models interactively. If you now run the server and visit the admin, you should notice that the Flatpages app is now visible there, and the ‘About me’ flat page is now shown in there.</p>
<p>Let’s also take a look at the SQL required for the <code>Site</code> model. Run <code>python manage.py sqlall sites</code>:</p>
<pre><code class="hljs lang-sql"><span class="hljs-operator"><span class="hljs-keyword">BEGIN</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">"django_site"</span> (
    <span class="hljs-string">"id"</span> <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>,
    <span class="hljs-string">"domain"</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">"name"</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
)
;</span>

<span class="hljs-operator"><span class="hljs-keyword">COMMIT</span>;</span>
</code></pre>
<p>Again, very simple - just a domain and a name.</p>
<p>So, now that we have a good idea of how the flat page system works, we can write a test for it. We don’t need to write unit tests for the model because Django already does that, but we do need to write an acceptance test to ensure we can create flat pages and they will be where we expect them to be. Add the following to the top of the test file:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.contrib.flatpages.models <span class="hljs-keyword">import</span> FlatPage
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site
</code></pre>
<p>Now, before we write this test, there’s some duplication to resolve. We have two tests that subclass <code>LiveServerTestCase</code>, and both have the same method, <code>setUp</code>. We can save ourselves some hassle by creating a new class containing this method and having both these tests inherit from it. We’ll do that now because the flat page test can also be based on it. Create the following class just after <code>PostTest</code>:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseAcceptanceTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span><span class="hljs-params">(self)</span>:</span>
        self.client = Client()
</code></pre>
<p>Then remove the setUp method from each of the two tests based on <code>LiveServerTestCase</code>, and change their parent class to <code>BaseAcceptanceTest</code>:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
</code></pre>
<p>With that done, run the tests and they should pass. Commit your changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/tests.py django_tutorial_blog_ng/settings.py
$ git commit -m <span class="hljs-string">'Added flatpages to installed apps'</span>
</code></pre>
<p>Now we can get started in earnest on our test for the flat pages:</p>
<pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlatPageViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_flat_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create flat page</span>
        page = FlatPage()
        page.url = <span class="hljs-string">'/about/'</span>
        page.title = <span class="hljs-string">'About me'</span>
        page.content = <span class="hljs-string">'All about me'</span>
        page.save()

        <span class="hljs-comment"># Add the site</span>
        page.sites.add(Site.objects.all()[<span class="hljs-number">0</span>])
        page.save()

        <span class="hljs-comment"># Check new page saved</span>
        all_pages = FlatPage.objects.all()
        self.assertEquals(len(all_pages), <span class="hljs-number">1</span>)
        only_page = all_pages[<span class="hljs-number">0</span>]
        self.assertEquals(only_page, page)

        <span class="hljs-comment"># Check data correct</span>
        self.assertEquals(only_page.url, <span class="hljs-string">'/about/'</span>)
        self.assertEquals(only_page.title, <span class="hljs-string">'About me'</span>)
        self.assertEquals(only_page.content, <span class="hljs-string">'All about me'</span>)

        <span class="hljs-comment"># Get URL</span>
        page_url = only_page.get_absolute_url()

        <span class="hljs-comment"># Get the page</span>
        response = self.client.get(page_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check title and content in response</span>
        self.assertTrue(<span class="hljs-string">'About me'</span> <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(<span class="hljs-string">'All about me'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>Let’s run our tests:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span>
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
......F..
======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_flat_page (blogengine.tests.FlatPageViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">272</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_flat_page
    self.assertEquals(response.status_code, <span class="hljs-number">200</span>)
AssertionError: <span class="hljs-number">404</span> != <span class="hljs-number">200</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">2.760</span>s

FAILED (failures=<span class="hljs-number">1</span>)
</code></pre>
<p>We can see why it’s failed - in our flat page test, the status code is 404, indicating the page was not found. This just means we haven’t put flat page support into our URLconf. So let’s fix that:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, include, url

<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
admin.autodiscover()

urlpatterns = patterns(<span class="hljs-string">''</span>,
    <span class="hljs-comment"># Examples:</span>
    <span class="hljs-comment"># url(r'^$', 'django_tutorial_blog_ng.views.home', name='home'),</span>
    <span class="hljs-comment"># url(r'^blog/', include('blog.urls')),</span>

    url(<span class="hljs-string">r'^admin/'</span>, include(admin.site.urls)),

    <span class="hljs-comment"># Blog URLs</span>
    url(<span class="hljs-string">r''</span>, include(<span class="hljs-string">'blogengine.urls'</span>)),

    <span class="hljs-comment"># Flat pages</span>
    url(<span class="hljs-string">r''</span>, include(<span class="hljs-string">'django.contrib.flatpages.urls'</span>)),
)
</code></pre>
<p>Let’s run our tests again:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span>
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
......E..
======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_flat_page (blogengine.tests.FlatPageViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">276</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_flat_page
    response = self.client.get(page_url)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/test/client.py"</span>, line <span class="hljs-number">473</span>, <span class="hljs-keyword">in</span> get
    response = super(Client, self).get(path, data=data, **extra)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/test/client.py"</span>, line <span class="hljs-number">280</span>, <span class="hljs-keyword">in</span> get
    <span class="hljs-built_in">return</span> self.request(**r)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/test/client.py"</span>, line <span class="hljs-number">444</span>, <span class="hljs-keyword">in</span> request
    six.reraise(*exc_info)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/handlers/base.py"</span>, line <span class="hljs-number">114</span>, <span class="hljs-keyword">in</span> get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/flatpages/views.py"</span>, line <span class="hljs-number">45</span>, <span class="hljs-keyword">in</span> flatpage
    <span class="hljs-built_in">return</span> render_flatpage(request, f)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/decorators.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> _wrapped_view
    response = view_func(request, *args, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/flatpages/views.py"</span>, line <span class="hljs-number">60</span>, <span class="hljs-keyword">in</span> render_flatpage
    t = loader.get_template(DEFAULT_TEMPLATE)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/template/loader.py"</span>, line <span class="hljs-number">138</span>, <span class="hljs-keyword">in</span> get_template
    template, origin = find_template(template_name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/template/loader.py"</span>, line <span class="hljs-number">131</span>, <span class="hljs-keyword">in</span> find_template
    raise TemplateDoesNotExist(name)
TemplateDoesNotExist: flatpages/default.html

----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.557</span>s

FAILED (errors=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Our test still fails, but we can easily see  why - the template <code>flatpages/default.html</code> doesn’t exist. So we create it:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span></span><span class="hljs-variable">{{ flatpage.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        </span><span class="hljs-variable">{{ flatpage.content<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>This template is based on the blog post one, and just changes a handful of variable names. Note that it can still inherit from the blogengine base template, and in this case we’re using that for the sake of consistency.</p>
<p>If you run your tests, you should now see that they pass, so we’ll commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add templates/ django_tutorial_blog_ng/ blogengine/
$ git commit -m <span class="hljs-string">'Implemented flat page support'</span>
</code></pre>
<h2 id="multiple-authors">Multiple authors</h2>
<p>Next we’ll add support for multiple authors. Now, Django already has a User model, and we’ll leverage that to represent the authors. But first we’ll write our test:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase, LiveServerTestCase, Client
<span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post
<span class="hljs-keyword">from</span> django.contrib.flatpages.models <span class="hljs-keyword">import</span> FlatPage
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">import</span> markdown

<span class="hljs-comment"># Create your tests here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostTest</span><span class="hljs-params">(TestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()

        <span class="hljs-comment"># Set the attributes</span>
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)
        self.assertEquals(only_post.slug, <span class="hljs-string">'my-first-post'</span>)
        self.assertEquals(only_post.pub_date.day, post.pub_date.day)
        self.assertEquals(only_post.pub_date.month, post.pub_date.month)
        self.assertEquals(only_post.pub_date.year, post.pub_date.year)
        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)
        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)
        self.assertEquals(only_post.pub_date.second, post.pub_date.second)
        self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
        self.assertEquals(only_post.author.email, <span class="hljs-string">'user@example.com'</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseAcceptanceTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span><span class="hljs-params">(self)</span>:</span>
        self.client = Client()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    fixtures = [<span class="hljs-string">'users.json'</span>]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Get login page</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)

        <span class="hljs-comment"># Check response code</span>
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log in' in response</span>
        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Log the user in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log out' in response</span>
        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log out' in response</span>
        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Log out</span>
        self.client.logout()

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log in' in response</span>
        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlatPageViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_flat_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create flat page</span>
        page = FlatPage()
        page.url = <span class="hljs-string">'/about/'</span>
        page.title = <span class="hljs-string">'About me'</span>
        page.content = <span class="hljs-string">'All about me'</span>
        page.save()

        <span class="hljs-comment"># Add the site</span>
        page.sites.add(Site.objects.all()[<span class="hljs-number">0</span>])
        page.save()

        <span class="hljs-comment"># Check new page saved</span>
        all_pages = FlatPage.objects.all()
        self.assertEquals(len(all_pages), <span class="hljs-number">1</span>)
        only_page = all_pages[<span class="hljs-number">0</span>]
        self.assertEquals(only_page, page)

        <span class="hljs-comment"># Check data correct</span>
        self.assertEquals(only_page.url, <span class="hljs-string">'/about/'</span>)
        self.assertEquals(only_page.title, <span class="hljs-string">'About me'</span>)
        self.assertEquals(only_page.content, <span class="hljs-string">'All about me'</span>)

        <span class="hljs-comment"># Get URL</span>
        page_url = str(only_page.get_absolute_url())

        <span class="hljs-comment"># Get the page</span>
        response = self.client.get(page_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check title and content in response</span>
        self.assertTrue(<span class="hljs-string">'About me'</span> <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(<span class="hljs-string">'All about me'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>Here we create a <code>User</code> object to represent the author. Note the <code>create_user</code> convenience method for creating new users quickly and easily.</p>
<p>We’re going to exclude the author field from the admin - instead it’s going to be automatically populated based on the session data, so that when a user creates a post they are automatically set as the author. We therefore don’t need to make any changes for the acceptance tests for posts - our changes to the unit tests for the <code>Post</code> model are sufficient.</p>
<p>Run the tests, and they should fail:</p>
<pre><code class="hljs lang-python">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py test
Creating test database <span class="hljs-keyword">for</span> alias <span class="hljs-string">'default'</span>...
E........
======================================================================
ERROR: test_create_post (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">45</span>, <span class="hljs-keyword">in</span> test_create_post
    self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
AttributeError: <span class="hljs-string">'Post'</span> object has no attribute <span class="hljs-string">'author'</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.620</span>s

FAILED (errors=<span class="hljs-number">1</span>)
Destroying test database <span class="hljs-keyword">for</span> alias <span class="hljs-string">'default'</span>...
</code></pre>
<p>Let’s add the missing <code>author</code> attribute:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre>
<p>Next, create the migrations:</p>
<pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
</code></pre>
<p>You’ll be prompted to either quit or provide a default author ID - select option 2 to provide the ID, then enter 1, which should be your own user account ID. Then run the migrations:</p>
<pre><code class="hljs lang-bash">$ python manage.py migrate
</code></pre>
<p>Let’s run our tests again:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span>
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.F.F.....
======================================================================
FAIL: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">118</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: <span class="hljs-built_in">test</span>_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">154</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_edit_post
    self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">3.390</span>s

FAILED (failures=<span class="hljs-number">2</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Our test still fails because the author field isn’t set automatically. So we’ll amend the admin to automatically set the author when the <code>Post</code> object is saved:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostAdmin</span><span class="hljs-params">(admin.ModelAdmin)</span>:</span>
    prepopulated_fields = {<span class="hljs-string">"slug"</span>: (<span class="hljs-string">"title"</span>,)}
    exclude = (<span class="hljs-string">'author'</span>,)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_model</span><span class="hljs-params">(self, request, obj, form, change)</span>:</span>
        obj.author = request.user
        obj.save()

admin.site.register(models.Post, PostAdmin)
</code></pre>
<p>This tells the admin to exclude the <code>author</code> field from any form for a post, and when the model is saved, to set the author to the user making the HTTP request. Now run the tests, and they should pass:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span>
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.........
----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">4.086</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Time to commit again:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/
$ git commit -m <span class="hljs-string">'Added author field'</span>
</code></pre>
<h2 id="comments">Comments</h2>
<p>The <a href="http://matthewdaly.co.uk/blog/2012/03/29/yet-another-tutorial-for-building-a-blog-using-python-and-django-part-4/">previous version of this tutorial</a> implemented comments using Django’s own comment system. However, this has since been deprecated from Django and turned into <a href="https://github.com/django/django-contrib-comments">a separate project</a>. So we have two options for how to implement comments:</p>
<ul>
<li>We can use <a href="http://django-contrib-comments.readthedocs.org/en/latest/">the comments system</a></li>
<li>We can use a third-party comments system</li>
</ul>
<p>Now, if you want to use the Django comment system, you can do so, and it shouldn’t be too hard to puzzle out how to implement it using the documentation and my prior post. However, in my humble opinion, using a third-party comment system is the way to go for blog comments - they make it extremely easy for people to log in with multiple services without you having to write lots of additional code. They also make it significantly easier to moderate comments, and they’re generally pretty good at handling comment spam.</p>
<p>Some of the available providers include:</p>
<ul>
<li><a href="http://disqus.com/">Disqus</a></li>
<li><a href="http://intensedebate.com/">IntenseDebate</a></li>
<li><a href="https://developers.facebook.com/docs/plugins/comments/">Facebook</a></li>
</ul>
<p>For demonstration purposes, we’ll use Facebook comments, but this shouldn’t require much work to adapt it to the other providers.</p>
<p>First of all, we need to include the Facebook JavaScript SDK:</p>
<pre><code class="hljs lang-django"><span class="xml">        <span class="hljs-comment">&lt;!-- Add your site or application content here --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fb-root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, s, id)</span> </span>{
            <span class="hljs-keyword">var</span> js, fjs = d.getElementsByTagName(s)[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">if</span> (d.getElementById(id)) <span class="hljs-keyword">return</span>;
                js = d.createElement(s); js.id = id;
                js.src = <span class="hljs-string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span>;
                fjs.parentNode.insertBefore(js, fjs);
            }(<span class="hljs-built_in">document</span>, <span class="hljs-string">'script'</span>, <span class="hljs-string">'facebook-jssdk'</span>));</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-inner"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-navbar"</span> <span class="hljs-attribute">data-toggle</span>=<span class="hljs-value">"collapse"</span> <span class="hljs-attribute">data-target</span>=<span class="hljs-value">".nav-collapse"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"brand"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/"</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav-collapse collapse"</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span></span>
</code></pre>
<p>Now, the Facebook comment system requires that you pass through the absolute page URL when initialising the comments. At present we can’t do that without hard-coding the domain name in our template, which we want to avoid. So, we need to add a site field to each post to identify the site it’s associated with.</p>
<p>As usual, we update our tests first:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase, LiveServerTestCase, Client
<span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post
<span class="hljs-keyword">from</span> django.contrib.flatpages.models <span class="hljs-keyword">import</span> FlatPage
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">import</span> markdown

<span class="hljs-comment"># Create your tests here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostTest</span><span class="hljs-params">(TestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()

        <span class="hljs-comment"># Set the attributes</span>
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)
        self.assertEquals(only_post.slug, <span class="hljs-string">'my-first-post'</span>)
        self.assertEquals(only_post.site.name, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.site.domain, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.pub_date.day, post.pub_date.day)
        self.assertEquals(only_post.pub_date.month, post.pub_date.month)
        self.assertEquals(only_post.pub_date.year, post.pub_date.year)
        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)
        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)
        self.assertEquals(only_post.pub_date.second, post.pub_date.second)
        self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
        self.assertEquals(only_post.author.email, <span class="hljs-string">'user@example.com'</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseAcceptanceTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span><span class="hljs-params">(self)</span>:</span>
        self.client = Client()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    fixtures = [<span class="hljs-string">'users.json'</span>]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Get login page</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)

        <span class="hljs-comment"># Check response code</span>
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log in' in response</span>
        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Log the user in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log out' in response</span>
        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log out' in response</span>
        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Log out</span>
        self.client.logout()

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check 'Log in' in response</span>
        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-keyword">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.site = site
        post.author = author
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-keyword">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlatPageViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_flat_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create flat page</span>
        page = FlatPage()
        page.url = <span class="hljs-string">'/about/'</span>
        page.title = <span class="hljs-string">'About me'</span>
        page.content = <span class="hljs-string">'All about me'</span>
        page.save()

        <span class="hljs-comment"># Add the site</span>
        page.sites.add(Site.objects.all()[<span class="hljs-number">0</span>])
        page.save()

        <span class="hljs-comment"># Check new page saved</span>
        all_pages = FlatPage.objects.all()
        self.assertEquals(len(all_pages), <span class="hljs-number">1</span>)
        only_page = all_pages[<span class="hljs-number">0</span>]
        self.assertEquals(only_page, page)

        <span class="hljs-comment"># Check data correct</span>
        self.assertEquals(only_page.url, <span class="hljs-string">'/about/'</span>)
        self.assertEquals(only_page.title, <span class="hljs-string">'About me'</span>)
        self.assertEquals(only_page.content, <span class="hljs-string">'All about me'</span>)

        <span class="hljs-comment"># Get URL</span>
        page_url = str(only_page.get_absolute_url())

        <span class="hljs-comment"># Get the page</span>
        response = self.client.get(page_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check title and content in response</span>
        self.assertTrue(<span class="hljs-string">'About me'</span> <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(<span class="hljs-string">'All about me'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre>
<p>All we’ve done here is to add the <code>site</code> attribute when creating a new post using the Django database API, and when we create one via the admin, we add an additional <code>site</code> aparameter to the HTTP POST request with a value of 1. Run the tests and they should fail:</p>
<pre><code class="hljs lang-bash">Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
E........
======================================================================
ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">46</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post
    self.assertEquals(only_post.site.name, <span class="hljs-string">'example.com'</span>)
AttributeError: <span class="hljs-string">'Post'</span> object has no attribute <span class="hljs-string">'site'</span>

----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">4.313</span>s

FAILED (errors=<span class="hljs-number">1</span>)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>So we need to add the <code>site</code> attribute to the <code>Post</code> model. Let’s do that:</p>
<pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-keyword">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre>
<p>Now create and run the migrations - you’ll be prompted to create a default value for the site attribute as well:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py schemamigration --auto blogengine
 ? The field <span class="hljs-string">'Post.site'</span> does not have a default specified, yet is NOT NULL.
 ? Since you are adding this field, you MUST specify a default
 ? value to use <span class="hljs-keyword">for</span> existing rows. Would you like to:
 ?  <span class="hljs-number">1</span>. Quit now, and add a default to the field <span class="hljs-keyword">in</span> models.py
 ?  <span class="hljs-number">2</span>. Specify a one-off value to use <span class="hljs-keyword">for</span> existing columns now
 ? Please select a choice: <span class="hljs-number">2</span>
 ? Please enter Python code <span class="hljs-keyword">for</span> your one-off default value.
 ? The datetime module is available, so you can <span class="hljs-keyword">do</span> e.g. datetime.date.today()
 &gt;&gt;&gt; <span class="hljs-number">1</span>
 + Added field site on blogengine.Post
Created <span class="hljs-number">0005</span>_auto__add_field_post_site.py. You can now apply this migration with: ./manage.py migrate blogengine
(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py migrate
Running migrations <span class="hljs-keyword">for</span> blogengine:
 - Migrating forwards to <span class="hljs-number">0005</span>_auto__add_field_post_site.
 &gt; blogengine:<span class="hljs-number">0005</span>_auto__add_field_post_site
 - Loading initial data <span class="hljs-keyword">for</span> blogengine.
Installed <span class="hljs-number">0</span> object(s) from <span class="hljs-number">0</span> fixture(s)
</code></pre>
<p>Our tests should then pass:</p>
<pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span>
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.........
----------------------------------------------------------------------
Ran <span class="hljs-number">9</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">4.261</span>s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre>
<p>Now we can include our full page URL on the post detail page:</p>
<pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template_tag">{% <span class="hljs-keyword">extends</span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">load</span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">block</span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span></span><span class="hljs-variable">{{ object.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span></span><span class="hljs-variable">{{ object.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
        </span><span class="hljs-variable">{{ object.text<span class="hljs-filter">|custom</span>_markdown }}</span><span class="xml">

        <span class="hljs-tag">&lt;<span class="hljs-title">h4</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"fb-comments"</span> <span class="hljs-attribute">data-href</span>=<span class="hljs-value">"http://</span></span></span><span class="hljs-variable">{{ post.site }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value"></span></span></span><span class="hljs-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span> <span class="hljs-attribute">data-width</span>=<span class="hljs-value">"470"</span> <span class="hljs-attribute">data-num-posts</span>=<span class="hljs-value">"10"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    </span><span class="hljs-template_tag">{% <span class="hljs-keyword">endblock</span> %}</span><span class="xml"></span>
</code></pre>
<p>If you want to customise the comments, take a look at <a href="https://developers.facebook.com/docs/plugins/comments/">the documentation for Facebook Comments</a>.</p>
<p>With that done, we can commit our changes:</p>
<pre><code class="hljs lang-bash">$ git add blogengine/ templates/
$ git commit -m <span class="hljs-string">'Implemented Facebook comments'</span>
</code></pre>
<p>And that wraps up this lesson. As usual, you can easily switch to today’s lesson with <code>git checkout lesson-3</code>. Next time we’ll implement categories and tags, and create an RSS feed for our blog posts.</p>

    </article>
        </div>
        <div class="col-md-4">
            <h1>Recent Posts</h1>
            <p><a href="/blog/2015/02/15/switching-to-my-own-static-site-generator/">Switching to My Own Static Site Generator</a></p>
            <p><a href="/blog/2014/12/31/building-a-chat-server-with-node-dot-js-and-redis/">Building a Chat Server With Node.js and Redis</a></p>
            <p><a href="/blog/2014/12/28/my-first-grunt-plugin/">My First Grunt Plugin</a></p>
            <p><a href="/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/">Building a URL Shortener With Node.js and Redis</a></p>
            <p><a href="/blog/2014/10/19/my-django-web-server-setup/">My Django Web Server Setup</a></p>
            <section id="github-profile">
            </section>
            <h4>My GitHub repositories</h4>
            <ul id="github-repos">
                <li>Loading repositories...</li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
             <ul class="pager">
                <li><a href="/posts/2/">Newer</a></li>

                <li><a href="/posts/4/">Older</a></li>
             </ul>
        </div>
    </div>
</div>
        <footer>
            <div class="container">
                <div class="col-md-12">
                    <p class="copyright">Copyright &copy; Matthew Daly 2015.</p>
                </div>
            </div>
        </footer>
        <script type="text/javascript" src="/static/js/all.min.js"></script>
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');
        </script>
    </body>
</html>
